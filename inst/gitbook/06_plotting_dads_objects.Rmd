---
title: "`plot.dads`"
author: "Thomas Guillerme (guillert@tcd.ie)"
date: "`r Sys.Date()`"
bibliography: [../References.bib, ../packages.bib]
output:
  html_document: default
  pdf_document: default
---

```{r, echo = FALSE}
library(rgl)
knitr::knit_hooks$set(webgl = hook_webgl)
```

`"dads"` objects can be directly plotted in `dads` using the S3 `plot.dads` function (or just `plot(x)` if `x` is of class `"dads"`).


# Plotting traits

`"dads"` `"traits"` objects are covered in the [traits section](#maketraits).
You can use `plot.dads` to plot them by choosing which specific trait to plot using the `trait` argument (default is 1):

```{r}
## Making a list of three traits
list_of_traits <- make.traits(process = c(no.process, BM.process, OU.process), trait.names = c("No process (normal)", "Brownian motion", "Ornstein-Uhlenbeck"))
## Plotting each trait separately
par(mfrow = c(2, 2))
plot(list_of_traits, trait = 1)
## Using different colours options
plot(list_of_traits, trait = 2, col = c("red", "purple", "pink"))
## Not using the default plot name
plot(list_of_traits, trait = 3, main = "OU process")
```

<!-- TODO: add trait labels and handling colours! -->

You can also control the number of replicates in the simulation by using the `simulations` option (the default is 50).
Bigger numbers leads to more time but smoother looking plots while smaller ones are more stochastic:

```{r}
par(mfrow = c(1,2))
plot(list_of_traits, trait = 2, simulations = 10, main = "10 BM simulations")
plot(list_of_traits, trait = 2, simulations = 1000, main = "1k BM simulations")
```


# Plotting dads results

If `dads` is used to plot only a tree (and outputs a `"phylo"` object), you can use the function `plot.phylo` from the `ape` package to plot your tree.
You'll find all the tree plotting option in the `?plot.phylo` manual page.

```{r}
## A simple pure birth tree
my_tree <- dads(stop.rule = list(max.taxa = 20))
plot(my_tree, main = "Plotting a \"phylo\" object")
```

However, if you also simulated a trait along with the tree you can use the `plot.dads` function to plot both the tree and the trait:

```{r}
## A simple pure birth tree with a BM process
my_tree <- dads(stop.rule = list(max.taxa = 20), traits = make.traits())
## Playing with the default options
plot(my_tree, main = "A tree and traits")
```

By default, elements are coloured as follows: nodes and tips are points and coloured in blue if they are tips (light blue if they are fossils) and nodes are in orange.
Branches linking them are grey lines.
You can of course change this colour palette to something of you preference by calling the normal arguments that can be passed to `points` or `lines`. For example `pch` for the point type or `lty` for the line type.
If there is an ambiguity between the argument names (for example, `cex` for both lines and points), you can specify it by prefixing the argument by the function name.
For example `cex = 2` will make both the points and lines twice bigger but `cex.points = 2` will make _only_ the points twice bigger.

```{r}
## Playing with some more options
plot(my_tree, main = "A tree and traits", points.cex = 2, pch = 19, col = c("red", "purple", "pink"), lwd = 1/3, lty = 3)
```





<!-- 
test_that("plot.dads works for traits", {
    
    list_of_traits <- make.traits(process = c(no.process, BM.process, OU.process), trait.names = c("No process (normal)", "Brownian motion", "Ornstein-Uhlenbeck"))
    ## Right output
    expect_null(plot.dads(list_of_traits))
    expect_null(plot.dads(list_of_traits, trait = 2))
    expect_null(plot.dads(list_of_traits, trait = 3))
})

test_that("plot.dads works for dads", {
    
    ## Simple example    
    test <- dads(stop.rule = list("max.living" = 10), traits = make.traits())
    ## Default plot
    expect_null(plot(test))
    ## Other options
    expect_null(plot(test, main = "what?", xlim = c(0, test$tree$root.time), col = c(tips = "pink", nodes = "red", edges = "purple"), ylab = "data"))

    ## A more complex trait
    complex_traits <- make.traits(process = c(BM.process, BM.process), n = c(2,3), process.args = list(list(Sigma = diag(2)), list(Sigma = matrix(1/3, 3, 3))), trait.names = c("bib", "bob"))
    test <- dads(stop.rule = list("max.living" = 10), traits = complex_traits)
    expect_null(plot(test, trait = 3))

    ## A big tree
    set.seed(12)
    big_test <- dads(bd.params = list(speciation = 1, extinction = 1/3), stop.rule = list(max.taxa = 1000), traits = make.traits())
    expect_null(plot(big_test, cex = 0.5))

    list_of_traits <- make.traits(process = c(no.process, BM.process, OU.process), trait.names = c("No process (normal)", "Brownian motion", "Ornstein-Uhlenbeck"))
    ## Right output
    expect_null(plot.dads(list_of_traits))
    expect_null(plot.dads(list_of_traits, trait = 2))
    expect_null(plot.dads(list_of_traits, trait = 3))
})


test_that("example works", {
    ## Specifying a trait process
    my_trait <- make.traits()
    ## Plotting a trait process
    expect_null(plot(my_trait, main = "A Brownian Motion"))

    ## Simulating a tree with ten taxa
    my_tree <- dads(stop.rule = list(max.taxa = 10))
    ## Plotting a simple birth death tree (using ape::plot.phylo)
    expect_is(plot(my_tree, main = "A pure birth tree"), "list")

    ## Simulating a tree with traits
    my_data <- dads(stop.rule = list(max.taxa = 10),
                    traits    = my_trait)
    ## Plotting the tree and traits
    expect_null(plot(my_data))

    ## Specifying a 3D trait process
    my_3D_trait <- make.traits(n = 3)
    ## Simulating a birth death tree with that trait
    my_data <- dads(bd.params = list(extinction = 0.2),
                    stop.rule = list(max.living = 50),
                    traits    = my_3D_trait)

    ## Plotting the second trait and the tree (default)
    ## The colours are purple for nodes and blue for tips
    expect_null(plot(my_data, trait = 2, col = c("purple", "blue"),
         edges = "pink", tips.nodes = "black"))

    ## Plotting the first and third trait correlation
    ## The colours are a heat map based on the elements age
    expect_null(plot(my_data, trait = c(1, 3), col = terrain.colors,
         edges = "grey", tips.nodes = "black"))
    
    ## Plotting the first and third trait correlation in 3D
    expect_null(plot(my_data, trait = c(1,3), col = rainbow,
         edges = "grey", tips.nodes = "black", use.3D = TRUE))

    ## Plotting all traits in 3D (without branch lengths)
    expect_null(plot(my_data, trait = c(1:3), col = heat.colors,
         edges = "grey", tips.nodes = "black", use.3D = TRUE, type = "s", radius = 0.1))
}) -->