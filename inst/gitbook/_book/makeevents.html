<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Making events with make.events() | dads manual</title>
  <meta name="description" content="dads R package vignette" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Making events with make.events() | dads manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="dads R package vignette" />
  <meta name="github-repo" content="TGuillerme/dads" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Making events with make.events() | dads manual" />
  
  <meta name="twitter:description" content="dads R package vignette" />
  

<meta name="author" content="Thomas Guillerme (guillert@tcd.ie), Alex Slavenko (email) and others" />


<meta name="date" content="2021-01-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="makemodifiers.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">dads manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> <code>dads</code>: disparity and diversity simulations.</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-dads"><i class="fa fa-check"></i><b>1.1</b> What is <code>dads</code>?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#modular"><i class="fa fa-check"></i><b>1.1.1</b> Modular?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-and-running-the-package"><i class="fa fa-check"></i><b>1.2</b> Installing and running the package</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#help"><i class="fa fa-check"></i><b>1.3</b> Help</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-does-dads-work"><i class="fa fa-check"></i><b>1.4</b> How does <code>dads</code> work?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting started</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#the-simplest-of-all-analysis-simulating-diversity-only"><i class="fa fa-check"></i><b>2.1</b> The simplest of all analysis: simulating diversity only</a><ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#changing-the-birth-death-parameters"><i class="fa fa-check"></i><b>2.1.1</b> Changing the birth-death parameters</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#slightly-more-complex-simulating-disparity-and-diversity"><i class="fa fa-check"></i><b>2.2</b> Slightly more complex: simulating disparity and diversity</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#slightly-more-more-complex-simulating-linked-disparity-and-diversity"><i class="fa fa-check"></i><b>2.3</b> Slightly more more complex: simulating linked disparity and diversity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="maketraits.html"><a href="maketraits.html"><i class="fa fa-check"></i><b>3</b> Making trait processes with <code>make.traits()</code></a><ul>
<li class="chapter" data-level="3.1" data-path="maketraits.html"><a href="maketraits.html#the-process-process"><i class="fa fa-check"></i><b>3.1</b> The process (<code>process</code>)</a></li>
<li class="chapter" data-level="3.2" data-path="maketraits.html"><a href="maketraits.html#the-number-of-traits-n-and-the-starting-values-start"><i class="fa fa-check"></i><b>3.2</b> The number of traits <code>n</code> and the starting values <code>start</code></a></li>
<li class="chapter" data-level="3.3" data-path="maketraits.html"><a href="maketraits.html#extra-argument-for-the-processes-with-process.args"><i class="fa fa-check"></i><b>3.3</b> Extra argument for the processes with <code>process.args</code></a></li>
<li class="chapter" data-level="3.4" data-path="maketraits.html"><a href="maketraits.html#naming-the-traits-with-trait.names"><i class="fa fa-check"></i><b>3.4</b> Naming the traits with <code>trait.names</code></a></li>
<li class="chapter" data-level="3.5" data-path="maketraits.html"><a href="maketraits.html#combining-multiple-traits-with-add"><i class="fa fa-check"></i><b>3.5</b> Combining multiple traits with <code>add</code></a></li>
<li class="chapter" data-level="3.6" data-path="maketraits.html"><a href="maketraits.html#testing-the-traits-with-test"><i class="fa fa-check"></i><b>3.6</b> Testing the traits with <code>test</code></a></li>
<li class="chapter" data-level="3.7" data-path="maketraits.html"><a href="maketraits.html#templates-for-making-your-very-own-process"><i class="fa fa-check"></i><b>3.7</b> Templates for making your very own process</a><ul>
<li class="chapter" data-level="3.7.1" data-path="maketraits.html"><a href="maketraits.html#a-simple-brownian-motion-process-template"><i class="fa fa-check"></i><b>3.7.1</b> A simple Brownian Motion process template</a></li>
<li class="chapter" data-level="3.7.2" data-path="maketraits.html"><a href="maketraits.html#a-simple-ornstein-uhlenbeck-process-template"><i class="fa fa-check"></i><b>3.7.2</b> A simple Ornstein-Uhlenbeck process template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="makemodifiers.html"><a href="makemodifiers.html"><i class="fa fa-check"></i><b>4</b> Making modifiers with <code>make.modifiers()</code></a><ul>
<li class="chapter" data-level="4.1" data-path="makemodifiers.html"><a href="makemodifiers.html#the-branch-length-function-branch.length"><i class="fa fa-check"></i><b>4.1</b> The branch length function (<code>branch.length</code>)</a><ul>
<li class="chapter" data-level="4.1.1" data-path="makemodifiers.html"><a href="makemodifiers.html#allowarguments"><i class="fa fa-check"></i><b>4.1.1</b> The allowed arguments</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="makemodifiers.html"><a href="makemodifiers.html#the-selection-function-selection"><i class="fa fa-check"></i><b>4.2</b> The selection function (<code>selection</code>)</a></li>
<li class="chapter" data-level="4.3" data-path="makemodifiers.html"><a href="makemodifiers.html#the-speciation-function-speciation"><i class="fa fa-check"></i><b>4.3</b> The speciation function (<code>speciation</code>)</a></li>
<li class="chapter" data-level="4.4" data-path="makemodifiers.html"><a href="makemodifiers.html#summarymodifiers"><i class="fa fa-check"></i><b>4.4</b> Summary of the inputs and outputs for the <code>branch.length</code>, <code>selection</code> and <code>speciation</code> modifiers</a></li>
<li class="chapter" data-level="4.5" data-path="makemodifiers.html"><a href="makemodifiers.html#the-condition-and-modify-functions-condition-and-modify"><i class="fa fa-check"></i><b>4.5</b> The condition and modify functions (<code>condition</code> and <code>modify</code>)</a></li>
<li class="chapter" data-level="4.6" data-path="makemodifiers.html"><a href="makemodifiers.html#combining-and-editing-modifiers-add"><i class="fa fa-check"></i><b>4.6</b> Combining and editing modifiers (<code>add</code>)</a></li>
<li class="chapter" data-level="4.7" data-path="makemodifiers.html"><a href="makemodifiers.html#testing-modifiers-test"><i class="fa fa-check"></i><b>4.7</b> Testing modifiers (<code>test</code>)</a></li>
<li class="chapter" data-level="4.8" data-path="makemodifiers.html"><a href="makemodifiers.html#demo-runnable"><i class="fa fa-check"></i><b>4.8</b> Demo runnable</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="makeevents.html"><a href="makeevents.html"><i class="fa fa-check"></i><b>5</b> Making events with <code>make.events()</code></a><ul>
<li class="chapter" data-level="5.1" data-path="makeevents.html"><a href="makeevents.html#conditions"><i class="fa fa-check"></i><b>5.1</b> Conditions</a></li>
<li class="chapter" data-level="5.2" data-path="makeevents.html"><a href="makeevents.html#modifications"><i class="fa fa-check"></i><b>5.2</b> Modifications</a></li>
<li class="chapter" data-level="5.3" data-path="makeevents.html"><a href="makeevents.html#some-events-examples"><i class="fa fa-check"></i><b>5.3</b> Some events examples</a><ul>
<li class="chapter" data-level="5.3.1" data-path="makeevents.html"><a href="makeevents.html#random-mass-extinction-after-some-time"><i class="fa fa-check"></i><b>5.3.1</b> Random mass extinction after some time</a></li>
<li class="chapter" data-level="5.3.2" data-path="makeevents.html"><a href="makeevents.html#extinction-based-on-a-trait-value-after-some-time"><i class="fa fa-check"></i><b>5.3.2</b> Extinction based on a trait value after some time</a></li>
<li class="chapter" data-level="5.3.3" data-path="makeevents.html"><a href="makeevents.html#adding-a-background-extinction-after-reaching-a-number-of-living-taxa"><i class="fa fa-check"></i><b>5.3.3</b> Adding a background extinction after reaching a number of living taxa</a></li>
<li class="chapter" data-level="5.3.4" data-path="makeevents.html"><a href="makeevents.html#reducing-speciation-after-some-time"><i class="fa fa-check"></i><b>5.3.4</b> Reducing speciation after some time</a></li>
<li class="chapter" data-level="5.3.5" data-path="makeevents.html"><a href="makeevents.html#changing-trait-process-after-some-time"><i class="fa fa-check"></i><b>5.3.5</b> Changing trait process after some time</a></li>
<li class="chapter" data-level="5.3.6" data-path="makeevents.html"><a href="makeevents.html#changing-trait-correlation-after-reaching-a-trait-value"><i class="fa fa-check"></i><b>5.3.6</b> Changing trait correlation after reaching a trait value</a></li>
<li class="chapter" data-level="5.3.7" data-path="makeevents.html"><a href="makeevents.html#event-for-changing-a-modifier"><i class="fa fa-check"></i><b>5.3.7</b> Event for changing a modifier</a></li>
<li class="chapter" data-level="5.3.8" data-path="makeevents.html"><a href="makeevents.html#changing-branch-length-when-reaching-n-taxa"><i class="fa fa-check"></i><b>5.3.8</b> Changing branch length when reaching n taxa</a></li>
<li class="chapter" data-level="5.3.9" data-path="makeevents.html"><a href="makeevents.html#founding-event-a-subtree-with-no-fossils"><i class="fa fa-check"></i><b>5.3.9</b> Founding event: a subtree with no fossils</a></li>
<li class="chapter" data-level="5.3.10" data-path="makeevents.html"><a href="makeevents.html#founding-event-with-traits"><i class="fa fa-check"></i><b>5.3.10</b> Founding event with traits</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/TGuillerme/dads/" target="blank">Project GitHub page</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">dads manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="makeevents" class="section level1">
<h1><span class="header-section-number">5</span> Making events with <code>make.events()</code></h1>
<div id="conditions" class="section level2">
<h2><span class="header-section-number">5.1</span> Conditions</h2>
</div>
<div id="modifications" class="section level2">
<h2><span class="header-section-number">5.2</span> Modifications</h2>
</div>
<div id="some-events-examples" class="section level2">
<h2><span class="header-section-number">5.3</span> Some events examples</h2>
<div id="random-mass-extinction-after-some-time" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Random mass extinction after some time</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="co">## Simulation parameters</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb93-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb93-4" data-line-number="4"></a>
<a class="sourceLine" id="cb93-5" data-line-number="5"><span class="co">## 80% mass extinction at time 4</span></a>
<a class="sourceLine" id="cb93-6" data-line-number="6">mass_extinction &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb93-7" data-line-number="7">                      <span class="dt">target =</span> <span class="st">&quot;taxa&quot;</span>,</a>
<a class="sourceLine" id="cb93-8" data-line-number="8">                      <span class="dt">condition =</span> <span class="kw">time.condition</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb93-9" data-line-number="9">                      <span class="dt">modification =</span> <span class="kw">random.extinction</span>(<span class="fl">0.8</span>))</a>
<a class="sourceLine" id="cb93-10" data-line-number="10"></a>
<a class="sourceLine" id="cb93-11" data-line-number="11"><span class="co">## Running the simulations</span></a>
<a class="sourceLine" id="cb93-12" data-line-number="12"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb93-13" data-line-number="13">results &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb93-14" data-line-number="14">                <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb93-15" data-line-number="15">                <span class="dt">events    =</span> mass_extinction)</a>
<a class="sourceLine" id="cb93-16" data-line-number="16"><span class="co">## Plotting the results</span></a>
<a class="sourceLine" id="cb93-17" data-line-number="17"><span class="kw">plot</span>(results, <span class="dt">show.tip.label =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb93-18" data-line-number="18"><span class="kw">axisPhylo</span>()</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
</div>
<div id="extinction-based-on-a-trait-value-after-some-time" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Extinction based on a trait value after some time</h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="co">## Simulation parameters</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb94-4" data-line-number="4"></a>
<a class="sourceLine" id="cb94-5" data-line-number="5"><span class="co">## Extinction of any tips with trait &lt; 1 at time 4</span></a>
<a class="sourceLine" id="cb94-6" data-line-number="6">trait_extinction &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb94-7" data-line-number="7">                      <span class="dt">target =</span> <span class="st">&quot;taxa&quot;</span>,</a>
<a class="sourceLine" id="cb94-8" data-line-number="8">                      <span class="dt">condition =</span> <span class="kw">time.condition</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb94-9" data-line-number="9">                      <span class="dt">modification =</span> <span class="kw">trait.extinction</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb94-10" data-line-number="10"></a>
<a class="sourceLine" id="cb94-11" data-line-number="11"><span class="co">## Running the simulations</span></a>
<a class="sourceLine" id="cb94-12" data-line-number="12"><span class="kw">set.seed</span>(<span class="dv">7</span>)</a>
<a class="sourceLine" id="cb94-13" data-line-number="13">results &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb94-14" data-line-number="14">                <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb94-15" data-line-number="15">                <span class="dt">traits    =</span> <span class="kw">make.traits</span>(),</a>
<a class="sourceLine" id="cb94-16" data-line-number="16">                <span class="dt">events    =</span> trait_extinction)</a>
<a class="sourceLine" id="cb94-17" data-line-number="17"><span class="co">## Plotting the results</span></a>
<a class="sourceLine" id="cb94-18" data-line-number="18"><span class="kw">plot</span>(results)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
</div>
<div id="adding-a-background-extinction-after-reaching-a-number-of-living-taxa" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Adding a background extinction after reaching a number of living taxa</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="co">## Simulation parameters</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.living =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb95-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb95-4" data-line-number="4"></a>
<a class="sourceLine" id="cb95-5" data-line-number="5"><span class="co">## Adding an extinction parameter after 30 taxa</span></a>
<a class="sourceLine" id="cb95-6" data-line-number="6">background_extinction &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb95-7" data-line-number="7">                      <span class="dt">condition    =</span> <span class="kw">taxa.condition</span>(<span class="dv">30</span>),</a>
<a class="sourceLine" id="cb95-8" data-line-number="8">                      <span class="dt">target       =</span> <span class="st">&quot;bd.params&quot;</span>,</a>
<a class="sourceLine" id="cb95-9" data-line-number="9">                      <span class="dt">modification =</span> <span class="kw">update.bd.params</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="st">&quot;extinction&quot;</span>))</a>
<a class="sourceLine" id="cb95-10" data-line-number="10"></a>
<a class="sourceLine" id="cb95-11" data-line-number="11"><span class="co">## Running the simulations</span></a>
<a class="sourceLine" id="cb95-12" data-line-number="12"><span class="kw">set.seed</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb95-13" data-line-number="13">results &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb95-14" data-line-number="14">                <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb95-15" data-line-number="15">                <span class="dt">events    =</span> background_extinction)</a>
<a class="sourceLine" id="cb95-16" data-line-number="16"><span class="co">## Plotting the results</span></a>
<a class="sourceLine" id="cb95-17" data-line-number="17"><span class="kw">plot</span>(results)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
</div>
<div id="reducing-speciation-after-some-time" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Reducing speciation after some time</h3>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="co">## Simulation parameters</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb96-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb96-4" data-line-number="4"></a>
<a class="sourceLine" id="cb96-5" data-line-number="5"><span class="co">## Reducing speciation after reaching time 2</span></a>
<a class="sourceLine" id="cb96-6" data-line-number="6">reduced_speciation &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb96-7" data-line-number="7">                      <span class="dt">condition    =</span> <span class="kw">time.condition</span>(<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb96-8" data-line-number="8">                      <span class="dt">target       =</span> <span class="st">&quot;bd.params&quot;</span>,</a>
<a class="sourceLine" id="cb96-9" data-line-number="9">                      <span class="dt">modification =</span> <span class="kw">update.bd.params</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="st">&quot;speciation&quot;</span>))</a>
<a class="sourceLine" id="cb96-10" data-line-number="10"></a>
<a class="sourceLine" id="cb96-11" data-line-number="11"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb96-12" data-line-number="12">no_event &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb96-13" data-line-number="13">                 <span class="dt">stop.rule =</span> stop.rule)</a>
<a class="sourceLine" id="cb96-14" data-line-number="14"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb96-15" data-line-number="15">reduced_speciation_event &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb96-16" data-line-number="16">                                 <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb96-17" data-line-number="17">                                 <span class="dt">events    =</span> reduced_speciation)</a>
<a class="sourceLine" id="cb96-18" data-line-number="18"></a>
<a class="sourceLine" id="cb96-19" data-line-number="19"><span class="co">## Plot both trees</span></a>
<a class="sourceLine" id="cb96-20" data-line-number="20"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb96-21" data-line-number="21"><span class="kw">plot</span>(no_event, <span class="dt">main =</span> <span class="st">&quot;No event&quot;</span>)</a>
<a class="sourceLine" id="cb96-22" data-line-number="22"><span class="kw">axisPhylo</span>()</a>
<a class="sourceLine" id="cb96-23" data-line-number="23"><span class="kw">plot</span>(reduced_speciation_event, <span class="dt">main =</span> <span class="st">&quot;Reduced speciation after time 2&quot;</span>)</a>
<a class="sourceLine" id="cb96-24" data-line-number="24"><span class="kw">axisPhylo</span>()</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="changing-trait-process-after-some-time" class="section level3">
<h3><span class="header-section-number">5.3.5</span> Changing trait process after some time</h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="co">## Simulation parameters</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb97-4" data-line-number="4">traits    &lt;-<span class="st"> </span><span class="kw">make.traits</span>()</a>
<a class="sourceLine" id="cb97-5" data-line-number="5"></a>
<a class="sourceLine" id="cb97-6" data-line-number="6"><span class="co">## Create an event to change the trait process</span></a>
<a class="sourceLine" id="cb97-7" data-line-number="7">change_process &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb97-8" data-line-number="8">                  <span class="dt">condition    =</span> <span class="kw">time.condition</span>(<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb97-9" data-line-number="9">                  <span class="dt">target       =</span> <span class="st">&quot;traits&quot;</span>,</a>
<a class="sourceLine" id="cb97-10" data-line-number="10">                  <span class="dt">modification =</span> <span class="kw">update.traits</span>(<span class="dt">process =</span> OU.process))</a>
<a class="sourceLine" id="cb97-11" data-line-number="11"></a>
<a class="sourceLine" id="cb97-12" data-line-number="12"><span class="co">## Run the simulations</span></a>
<a class="sourceLine" id="cb97-13" data-line-number="13"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb97-14" data-line-number="14">no_change &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb97-15" data-line-number="15">                  <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb97-16" data-line-number="16">                  <span class="dt">traits    =</span> traits)</a>
<a class="sourceLine" id="cb97-17" data-line-number="17"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb97-18" data-line-number="18">process_change &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb97-19" data-line-number="19">                       <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb97-20" data-line-number="20">                       <span class="dt">traits    =</span> traits,</a>
<a class="sourceLine" id="cb97-21" data-line-number="21">                       <span class="dt">events    =</span> change_process)</a>
<a class="sourceLine" id="cb97-22" data-line-number="22"><span class="co">## Plot the results</span></a>
<a class="sourceLine" id="cb97-23" data-line-number="23"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb97-24" data-line-number="24"><span class="kw">plot</span>(no_change, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb97-25" data-line-number="25"><span class="kw">plot</span>(process_change, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">7</span>))</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
</div>
<div id="changing-trait-correlation-after-reaching-a-trait-value" class="section level3">
<h3><span class="header-section-number">5.3.6</span> Changing trait correlation after reaching a trait value</h3>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="co">## Set the parameters</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.taxa =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb98-4" data-line-number="4"></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="co">## A correlated trait</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6">traits &lt;-<span class="st"> </span><span class="kw">make.traits</span>(<span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">process.args =</span> <span class="kw">list</span>(<span class="dt">Sigma =</span> <span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb98-7" data-line-number="7"></a>
<a class="sourceLine" id="cb98-8" data-line-number="8"><span class="co">## Event changing a trait correlation</span></a>
<a class="sourceLine" id="cb98-9" data-line-number="9">cor_change &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb98-10" data-line-number="10">    <span class="dt">condition    =</span> <span class="kw">trait.condition</span>(<span class="dv">3</span>, <span class="dt">absolute =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb98-11" data-line-number="11">    <span class="dt">target       =</span> <span class="st">&quot;traits&quot;</span>,</a>
<a class="sourceLine" id="cb98-12" data-line-number="12">    <span class="dt">modification =</span> <span class="kw">update.traits</span>(<span class="dt">process.args =</span> <span class="kw">list</span>(<span class="dt">Sigma =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>),<span class="dv">2</span>,<span class="dv">2</span>))))</a>
<a class="sourceLine" id="cb98-13" data-line-number="13"></a>
<a class="sourceLine" id="cb98-14" data-line-number="14"><span class="co">## Run the simulations</span></a>
<a class="sourceLine" id="cb98-15" data-line-number="15"><span class="kw">set.seed</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb98-16" data-line-number="16">no_event &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb98-17" data-line-number="17">                 <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb98-18" data-line-number="18">                 <span class="dt">traits    =</span> traits)</a>
<a class="sourceLine" id="cb98-19" data-line-number="19"><span class="kw">set.seed</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb98-20" data-line-number="20">change_correlation &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb98-21" data-line-number="21">                           <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb98-22" data-line-number="22">                           <span class="dt">traits    =</span> traits,</a>
<a class="sourceLine" id="cb98-23" data-line-number="23">                           <span class="dt">events    =</span> cor_change)</a>
<a class="sourceLine" id="cb98-24" data-line-number="24"></a>
<a class="sourceLine" id="cb98-25" data-line-number="25"><span class="co">## Visual testing</span></a>
<a class="sourceLine" id="cb98-26" data-line-number="26"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb98-27" data-line-number="27"><span class="kw">plot</span>(no_event, <span class="dt">trait =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb98-28" data-line-number="28"><span class="kw">plot</span>(change_correlation, <span class="dt">trait =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="co">## 3D plot</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="kw">plot</span>(change_correlation, <span class="dt">trait =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>), <span class="dt">use.3D =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<script>/*
* Copyright (C) 2009 Apple Inc. All Rights Reserved.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions
* are met:
* 1. Redistributions of source code must retain the above copyright
*    notice, this list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright
*    notice, this list of conditions and the following disclaimer in the
*    documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
* EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
* PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* Copyright (2016) Duncan Murdoch - fixed CanvasMatrix4.ortho,
* cleaned up.
*/
/*
CanvasMatrix4 class
This class implements a 4x4 matrix. It has functions which
duplicate the functionality of the OpenGL matrix stack and
glut functions.
IDL:
[
Constructor(in CanvasMatrix4 matrix),           // copy passed matrix into new CanvasMatrix4
Constructor(in sequence<float> array)           // create new CanvasMatrix4 with 16 floats (row major)
Constructor()                                   // create new CanvasMatrix4 with identity matrix
]
interface CanvasMatrix4 {
attribute float m11;
attribute float m12;
attribute float m13;
attribute float m14;
attribute float m21;
attribute float m22;
attribute float m23;
attribute float m24;
attribute float m31;
attribute float m32;
attribute float m33;
attribute float m34;
attribute float m41;
attribute float m42;
attribute float m43;
attribute float m44;
void load(in CanvasMatrix4 matrix);                 // copy the values from the passed matrix
void load(in sequence<float> array);                // copy 16 floats into the matrix
sequence<float> getAsArray();                       // return the matrix as an array of 16 floats
WebGLFloatArray getAsCanvasFloatArray();           // return the matrix as a WebGLFloatArray with 16 values
void makeIdentity();                                // replace the matrix with identity
void transpose();                                   // replace the matrix with its transpose
void invert();                                      // replace the matrix with its inverse
void translate(in float x, in float y, in float z); // multiply the matrix by passed translation values on the right
void scale(in float x, in float y, in float z);     // multiply the matrix by passed scale values on the right
void rotate(in float angle,                         // multiply the matrix by passed rotation values on the right
in float x, in float y, in float z);    // (angle is in degrees)
void multRight(in CanvasMatrix matrix);             // multiply the matrix by the passed matrix on the right
void multLeft(in CanvasMatrix matrix);              // multiply the matrix by the passed matrix on the left
void ortho(in float left, in float right,           // multiply the matrix by the passed ortho values on the right
in float bottom, in float top,
in float near, in float far);
void frustum(in float left, in float right,         // multiply the matrix by the passed frustum values on the right
in float bottom, in float top,
in float near, in float far);
void perspective(in float fovy, in float aspect,    // multiply the matrix by the passed perspective values on the right
in float zNear, in float zFar);
void lookat(in float eyex, in float eyey, in float eyez,    // multiply the matrix by the passed lookat
in float ctrx, in float ctry, in float ctrz,    // values on the right
in float upx, in float upy, in float upz);
}
*/
CanvasMatrix4 = function(m)
{
if (typeof m == 'object') {
if ("length" in m && m.length >= 16) {
this.load(m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7], m[8], m[9], m[10], m[11], m[12], m[13], m[14], m[15]);
return;
}
else if (m instanceof CanvasMatrix4) {
this.load(m);
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.load = function()
{
if (arguments.length == 1 && typeof arguments[0] == 'object') {
var matrix = arguments[0];
if ("length" in matrix && matrix.length == 16) {
this.m11 = matrix[0];
this.m12 = matrix[1];
this.m13 = matrix[2];
this.m14 = matrix[3];
this.m21 = matrix[4];
this.m22 = matrix[5];
this.m23 = matrix[6];
this.m24 = matrix[7];
this.m31 = matrix[8];
this.m32 = matrix[9];
this.m33 = matrix[10];
this.m34 = matrix[11];
this.m41 = matrix[12];
this.m42 = matrix[13];
this.m43 = matrix[14];
this.m44 = matrix[15];
return;
}
if (arguments[0] instanceof CanvasMatrix4) {
this.m11 = matrix.m11;
this.m12 = matrix.m12;
this.m13 = matrix.m13;
this.m14 = matrix.m14;
this.m21 = matrix.m21;
this.m22 = matrix.m22;
this.m23 = matrix.m23;
this.m24 = matrix.m24;
this.m31 = matrix.m31;
this.m32 = matrix.m32;
this.m33 = matrix.m33;
this.m34 = matrix.m34;
this.m41 = matrix.m41;
this.m42 = matrix.m42;
this.m43 = matrix.m43;
this.m44 = matrix.m44;
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.getAsArray = function()
{
return [
this.m11, this.m12, this.m13, this.m14,
this.m21, this.m22, this.m23, this.m24,
this.m31, this.m32, this.m33, this.m34,
this.m41, this.m42, this.m43, this.m44
];
};
CanvasMatrix4.prototype.getAsWebGLFloatArray = function()
{
return new WebGLFloatArray(this.getAsArray());
};
CanvasMatrix4.prototype.makeIdentity = function()
{
this.m11 = 1;
this.m12 = 0;
this.m13 = 0;
this.m14 = 0;
this.m21 = 0;
this.m22 = 1;
this.m23 = 0;
this.m24 = 0;
this.m31 = 0;
this.m32 = 0;
this.m33 = 1;
this.m34 = 0;
this.m41 = 0;
this.m42 = 0;
this.m43 = 0;
this.m44 = 1;
};
CanvasMatrix4.prototype.transpose = function()
{
var tmp = this.m12;
this.m12 = this.m21;
this.m21 = tmp;
tmp = this.m13;
this.m13 = this.m31;
this.m31 = tmp;
tmp = this.m14;
this.m14 = this.m41;
this.m41 = tmp;
tmp = this.m23;
this.m23 = this.m32;
this.m32 = tmp;
tmp = this.m24;
this.m24 = this.m42;
this.m42 = tmp;
tmp = this.m34;
this.m34 = this.m43;
this.m43 = tmp;
};
CanvasMatrix4.prototype.invert = function()
{
// Calculate the 4x4 determinant
// If the determinant is zero,
// then the inverse matrix is not unique.
var det = this._determinant4x4();
if (Math.abs(det) < 1e-8)
return null;
this._makeAdjoint();
// Scale the adjoint matrix to get the inverse
this.m11 /= det;
this.m12 /= det;
this.m13 /= det;
this.m14 /= det;
this.m21 /= det;
this.m22 /= det;
this.m23 /= det;
this.m24 /= det;
this.m31 /= det;
this.m32 /= det;
this.m33 /= det;
this.m34 /= det;
this.m41 /= det;
this.m42 /= det;
this.m43 /= det;
this.m44 /= det;
};
CanvasMatrix4.prototype.translate = function(x,y,z)
{
if (x === undefined)
x = 0;
if (y === undefined)
y = 0;
if (z === undefined)
z = 0;
var matrix = new CanvasMatrix4();
matrix.m41 = x;
matrix.m42 = y;
matrix.m43 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.scale = function(x,y,z)
{
if (x === undefined)
x = 1;
if (z === undefined) {
if (y === undefined) {
y = x;
z = x;
}
else
z = 1;
}
else if (y === undefined)
y = x;
var matrix = new CanvasMatrix4();
matrix.m11 = x;
matrix.m22 = y;
matrix.m33 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.rotate = function(angle,x,y,z)
{
// angles are in degrees. Switch to radians
angle = angle / 180 * Math.PI;
angle /= 2;
var sinA = Math.sin(angle);
var cosA = Math.cos(angle);
var sinA2 = sinA * sinA;
// normalize
var length = Math.sqrt(x * x + y * y + z * z);
if (length === 0) {
// bad vector, just use something reasonable
x = 0;
y = 0;
z = 1;
} else if (length != 1) {
x /= length;
y /= length;
z /= length;
}
var mat = new CanvasMatrix4();
// optimize case where axis is along major axis
if (x == 1 && y === 0 && z === 0) {
mat.m11 = 1;
mat.m12 = 0;
mat.m13 = 0;
mat.m21 = 0;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 2 * sinA * cosA;
mat.m31 = 0;
mat.m32 = -2 * sinA * cosA;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y == 1 && z === 0) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 0;
mat.m13 = -2 * sinA * cosA;
mat.m21 = 0;
mat.m22 = 1;
mat.m23 = 0;
mat.m31 = 2 * sinA * cosA;
mat.m32 = 0;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y === 0 && z == 1) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 2 * sinA * cosA;
mat.m13 = 0;
mat.m21 = -2 * sinA * cosA;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 0;
mat.m31 = 0;
mat.m32 = 0;
mat.m33 = 1;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else {
var x2 = x*x;
var y2 = y*y;
var z2 = z*z;
mat.m11 = 1 - 2 * (y2 + z2) * sinA2;
mat.m12 = 2 * (x * y * sinA2 + z * sinA * cosA);
mat.m13 = 2 * (x * z * sinA2 - y * sinA * cosA);
mat.m21 = 2 * (y * x * sinA2 - z * sinA * cosA);
mat.m22 = 1 - 2 * (z2 + x2) * sinA2;
mat.m23 = 2 * (y * z * sinA2 + x * sinA * cosA);
mat.m31 = 2 * (z * x * sinA2 + y * sinA * cosA);
mat.m32 = 2 * (z * y * sinA2 - x * sinA * cosA);
mat.m33 = 1 - 2 * (x2 + y2) * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
}
this.multRight(mat);
};
CanvasMatrix4.prototype.multRight = function(mat)
{
var m11 = (this.m11 * mat.m11 + this.m12 * mat.m21 +
this.m13 * mat.m31 + this.m14 * mat.m41);
var m12 = (this.m11 * mat.m12 + this.m12 * mat.m22 +
this.m13 * mat.m32 + this.m14 * mat.m42);
var m13 = (this.m11 * mat.m13 + this.m12 * mat.m23 +
this.m13 * mat.m33 + this.m14 * mat.m43);
var m14 = (this.m11 * mat.m14 + this.m12 * mat.m24 +
this.m13 * mat.m34 + this.m14 * mat.m44);
var m21 = (this.m21 * mat.m11 + this.m22 * mat.m21 +
this.m23 * mat.m31 + this.m24 * mat.m41);
var m22 = (this.m21 * mat.m12 + this.m22 * mat.m22 +
this.m23 * mat.m32 + this.m24 * mat.m42);
var m23 = (this.m21 * mat.m13 + this.m22 * mat.m23 +
this.m23 * mat.m33 + this.m24 * mat.m43);
var m24 = (this.m21 * mat.m14 + this.m22 * mat.m24 +
this.m23 * mat.m34 + this.m24 * mat.m44);
var m31 = (this.m31 * mat.m11 + this.m32 * mat.m21 +
this.m33 * mat.m31 + this.m34 * mat.m41);
var m32 = (this.m31 * mat.m12 + this.m32 * mat.m22 +
this.m33 * mat.m32 + this.m34 * mat.m42);
var m33 = (this.m31 * mat.m13 + this.m32 * mat.m23 +
this.m33 * mat.m33 + this.m34 * mat.m43);
var m34 = (this.m31 * mat.m14 + this.m32 * mat.m24 +
this.m33 * mat.m34 + this.m34 * mat.m44);
var m41 = (this.m41 * mat.m11 + this.m42 * mat.m21 +
this.m43 * mat.m31 + this.m44 * mat.m41);
var m42 = (this.m41 * mat.m12 + this.m42 * mat.m22 +
this.m43 * mat.m32 + this.m44 * mat.m42);
var m43 = (this.m41 * mat.m13 + this.m42 * mat.m23 +
this.m43 * mat.m33 + this.m44 * mat.m43);
var m44 = (this.m41 * mat.m14 + this.m42 * mat.m24 +
this.m43 * mat.m34 + this.m44 * mat.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.multLeft = function(mat)
{
var m11 = (mat.m11 * this.m11 + mat.m12 * this.m21 +
mat.m13 * this.m31 + mat.m14 * this.m41);
var m12 = (mat.m11 * this.m12 + mat.m12 * this.m22 +
mat.m13 * this.m32 + mat.m14 * this.m42);
var m13 = (mat.m11 * this.m13 + mat.m12 * this.m23 +
mat.m13 * this.m33 + mat.m14 * this.m43);
var m14 = (mat.m11 * this.m14 + mat.m12 * this.m24 +
mat.m13 * this.m34 + mat.m14 * this.m44);
var m21 = (mat.m21 * this.m11 + mat.m22 * this.m21 +
mat.m23 * this.m31 + mat.m24 * this.m41);
var m22 = (mat.m21 * this.m12 + mat.m22 * this.m22 +
mat.m23 * this.m32 + mat.m24 * this.m42);
var m23 = (mat.m21 * this.m13 + mat.m22 * this.m23 +
mat.m23 * this.m33 + mat.m24 * this.m43);
var m24 = (mat.m21 * this.m14 + mat.m22 * this.m24 +
mat.m23 * this.m34 + mat.m24 * this.m44);
var m31 = (mat.m31 * this.m11 + mat.m32 * this.m21 +
mat.m33 * this.m31 + mat.m34 * this.m41);
var m32 = (mat.m31 * this.m12 + mat.m32 * this.m22 +
mat.m33 * this.m32 + mat.m34 * this.m42);
var m33 = (mat.m31 * this.m13 + mat.m32 * this.m23 +
mat.m33 * this.m33 + mat.m34 * this.m43);
var m34 = (mat.m31 * this.m14 + mat.m32 * this.m24 +
mat.m33 * this.m34 + mat.m34 * this.m44);
var m41 = (mat.m41 * this.m11 + mat.m42 * this.m21 +
mat.m43 * this.m31 + mat.m44 * this.m41);
var m42 = (mat.m41 * this.m12 + mat.m42 * this.m22 +
mat.m43 * this.m32 + mat.m44 * this.m42);
var m43 = (mat.m41 * this.m13 + mat.m42 * this.m23 +
mat.m43 * this.m33 + mat.m44 * this.m43);
var m44 = (mat.m41 * this.m14 + mat.m42 * this.m24 +
mat.m43 * this.m34 + mat.m44 * this.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.ortho = function(left, right, bottom, top, near, far)
{
var tx = (left + right) / (left - right);
var ty = (top + bottom) / (bottom - top);
var tz = (far + near) / (near - far);
var matrix = new CanvasMatrix4();
matrix.m11 = 2 / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = 0;
matrix.m32 = 0;
matrix.m33 = -2 / (far - near);
matrix.m34 = 0;
matrix.m41 = tx;
matrix.m42 = ty;
matrix.m43 = tz;
matrix.m44 = 1;
this.multRight(matrix);
};
CanvasMatrix4.prototype.frustum = function(left, right, bottom, top, near, far)
{
var matrix = new CanvasMatrix4();
var A = (right + left) / (right - left);
var B = (top + bottom) / (top - bottom);
var C = -(far + near) / (far - near);
var D = -(2 * far * near) / (far - near);
matrix.m11 = (2 * near) / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 * near / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = A;
matrix.m32 = B;
matrix.m33 = C;
matrix.m34 = -1;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = D;
matrix.m44 = 0;
this.multRight(matrix);
};
CanvasMatrix4.prototype.perspective = function(fovy, aspect, zNear, zFar)
{
var top = Math.tan(fovy * Math.PI / 360) * zNear;
var bottom = -top;
var left = aspect * bottom;
var right = aspect * top;
this.frustum(left, right, bottom, top, zNear, zFar);
};
CanvasMatrix4.prototype.lookat = function(eyex, eyey, eyez, centerx, centery, centerz, upx, upy, upz)
{
var matrix = new CanvasMatrix4();
// Make rotation matrix
// Z vector
var zx = eyex - centerx;
var zy = eyey - centery;
var zz = eyez - centerz;
var mag = Math.sqrt(zx * zx + zy * zy + zz * zz);
if (mag) {
zx /= mag;
zy /= mag;
zz /= mag;
}
// Y vector
var yx = upx;
var yy = upy;
var yz = upz;
// X vector = Y cross Z
xx =  yy * zz - yz * zy;
xy = -yx * zz + yz * zx;
xz =  yx * zy - yy * zx;
// Recompute Y = Z cross X
yx = zy * xz - zz * xy;
yy = -zx * xz + zz * xx;
yx = zx * xy - zy * xx;
// cross product gives area of parallelogram, which is < 1.0 for
// non-perpendicular unit-length vectors; so normalize x, y here
mag = Math.sqrt(xx * xx + xy * xy + xz * xz);
if (mag) {
xx /= mag;
xy /= mag;
xz /= mag;
}
mag = Math.sqrt(yx * yx + yy * yy + yz * yz);
if (mag) {
yx /= mag;
yy /= mag;
yz /= mag;
}
matrix.m11 = xx;
matrix.m12 = xy;
matrix.m13 = xz;
matrix.m14 = 0;
matrix.m21 = yx;
matrix.m22 = yy;
matrix.m23 = yz;
matrix.m24 = 0;
matrix.m31 = zx;
matrix.m32 = zy;
matrix.m33 = zz;
matrix.m34 = 0;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = 0;
matrix.m44 = 1;
matrix.translate(-eyex, -eyey, -eyez);
this.multRight(matrix);
};
// Support functions
CanvasMatrix4.prototype._determinant2x2 = function(a, b, c, d)
{
return a * d - b * c;
};
CanvasMatrix4.prototype._determinant3x3 = function(a1, a2, a3, b1, b2, b3, c1, c2, c3)
{
return a1 * this._determinant2x2(b2, b3, c2, c3) -
b1 * this._determinant2x2(a2, a3, c2, c3) +
c1 * this._determinant2x2(a2, a3, b2, b3);
};
CanvasMatrix4.prototype._determinant4x4 = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
return a1 * this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) -
b1 * this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) +
c1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) -
d1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
};
CanvasMatrix4.prototype._makeAdjoint = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
// Row column labeling reversed since we transpose rows & columns
this.m11  =   this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);
this.m21  = - this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);
this.m31  =   this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);
this.m41  = - this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
this.m12  = - this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);
this.m22  =   this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);
this.m32  = - this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);
this.m42  =   this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);
this.m13  =   this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);
this.m23  = - this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);
this.m33  =   this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);
this.m43  = - this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);
this.m14  = - this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);
this.m24  =   this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);
this.m34  = - this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);
this.m44  =   this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);
};</script>
<script>// To generate the help pages for this library, use
// jsdoc --destination ../../../doc/rglwidgetClass --template ~/node_modules/jsdoc-baseline rglClass.src.js
// To validate, use
// setwd(".../inst/htmlwidgets/lib/rglClass")
// hints <- js::jshint(readLines("rglClass.src.js"))
// hints[, c("line", "reason")]
/**
* The class of an rgl widget
* @class
*/
rglwidgetClass = function() {
this.canvas = null;
this.userMatrix = new CanvasMatrix4();
this.types = [];
this.prMatrix = new CanvasMatrix4();
this.mvMatrix = new CanvasMatrix4();
this.vp = null;
this.prmvMatrix = null;
this.origs = null;
this.gl = null;
this.scene = null;
this.select = {state: "inactive", subscene: null, region: {p1: {x:0, y:0}, p2: {x:0, y:0}}};
this.drawing = false;
};
/**
* Multiply matrix by vector
* @returns {number[]}
* @param M {number[][]} Left operand
* @param v {number[]} Right operand
*/
rglwidgetClass.prototype.multMV = function(M, v) {
return [ M.m11 * v[0] + M.m12 * v[1] + M.m13 * v[2] + M.m14 * v[3],
M.m21 * v[0] + M.m22 * v[1] + M.m23 * v[2] + M.m24 * v[3],
M.m31 * v[0] + M.m32 * v[1] + M.m33 * v[2] + M.m34 * v[3],
M.m41 * v[0] + M.m42 * v[1] + M.m43 * v[2] + M.m44 * v[3]
];
};
/**
* Multiply row vector by Matrix
* @returns {number[]}
* @param v {number[]} left operand
* @param M {number[][]} right operand
*/
rglwidgetClass.prototype.multVM = function(v, M) {
return [ M.m11 * v[0] + M.m21 * v[1] + M.m31 * v[2] + M.m41 * v[3],
M.m12 * v[0] + M.m22 * v[1] + M.m32 * v[2] + M.m42 * v[3],
M.m13 * v[0] + M.m23 * v[1] + M.m33 * v[2] + M.m43 * v[3],
M.m14 * v[0] + M.m24 * v[1] + M.m34 * v[2] + M.m44 * v[3]
];
};
/**
* Euclidean length of a vector
* @returns {number}
* @param v {number[]}
*/
rglwidgetClass.prototype.vlen = function(v) {
return Math.sqrt(this.dotprod(v, v));
};
/**
* Dot product of two vectors
* @instance rglwidgetClass
* @returns {number}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.dotprod = function(a, b) {
return a[0]*b[0] + a[1]*b[1] + a[2]*b[2];
};
/**
* Cross product of two vectors
* @returns {number[]}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.xprod = function(a, b) {
return [a[1]*b[2] - a[2]*b[1],
a[2]*b[0] - a[0]*b[2],
a[0]*b[1] - a[1]*b[0]];
};
/**
* Bind vectors or matrices by columns
* @returns {number[][]}
* @param a {number[]|number[][]}
* @param b {number[]|number[][]}
*/
rglwidgetClass.prototype.cbind = function(a, b) {
if (b.length < a.length)
b = this.repeatToLen(b, a.length);
else if (a.length < b.length)
a = this.repeatToLen(a, b.length);
return a.map(function(currentValue, index, array) {
return currentValue.concat(b[index]);
});
};
/**
* Swap elements
* @returns {any[]}
* @param a {any[]}
* @param i {number} Element to swap
* @param j {number} Other element to swap
*/
rglwidgetClass.prototype.swap = function(a, i, j) {
var temp = a[i];
a[i] = a[j];
a[j] = temp;
};
/**
* Flatten a matrix into a vector
* @returns {any[]}
* @param a {any[][]}
*/
rglwidgetClass.prototype.flatten = function(arr, result) {
var value;
if (typeof result === "undefined") result = [];
for (var i = 0, length = arr.length; i < length; i++) {
value = arr[i];
if (Array.isArray(value)) {
this.flatten(value, result);
} else {
result.push(value);
}
}
return result;
};
/**
* set element of 1d or 2d array as if it was flattened.
* Column major, zero based!
* @returns {any[]|any[][]}
* @param {any[]|any[][]} a - array
* @param {number} i - element
* @param {any} value
*/
rglwidgetClass.prototype.setElement = function(a, i, value) {
if (Array.isArray(a[0])) {
var dim = a.length,
col = Math.floor(i/dim),
row = i % dim;
a[row][col] = value;
} else {
a[i] = value;
}
};
/**
* Transpose an array
* @returns {any[][]}
* @param {any[][]} a
*/
rglwidgetClass.prototype.transpose = function(a) {
var newArray = [],
n = a.length,
m = a[0].length,
i;
for(i = 0; i < m; i++){
newArray.push([]);
}
for(i = 0; i < n; i++){
for(var j = 0; j < m; j++){
newArray[j].push(a[i][j]);
}
}
return newArray;
};
/**
* Calculate sum of squares of a numeric vector
* @returns {number}
* @param {number[]} x
*/
rglwidgetClass.prototype.sumsq = function(x) {
var result = 0, i;
for (i=0; i < x.length; i++)
result += x[i]*x[i];
return result;
};
/**
* Convert a matrix to a CanvasMatrix4
* @returns {CanvasMatrix4}
* @param {number[][]|number[]} mat
*/
rglwidgetClass.prototype.toCanvasMatrix4 = function(mat) {
if (mat instanceof CanvasMatrix4)
return mat;
var result = new CanvasMatrix4();
mat = this.flatten(this.transpose(mat));
result.load(mat);
return result;
};
/**
* Convert an R-style numeric colour string to an rgb vector
* @returns {number[]}
* @param {string} s
*/
rglwidgetClass.prototype.stringToRgb = function(s) {
s = s.replace("#", "");
var bigint = parseInt(s, 16);
return [((bigint >> 16) & 255)/255,
((bigint >> 8) & 255)/255,
(bigint & 255)/255];
};
/**
* Take a component-by-component product of two 3 vectors
* @returns {number[]}
* @param {number[]} x
* @param {number[]} y
*/
rglwidgetClass.prototype.componentProduct = function(x, y) {
if (typeof y === "undefined") {
this.alertOnce("Bad arg to componentProduct");
}
var result = new Float32Array(3), i;
for (i = 0; i<3; i++)
result[i] = x[i]*y[i];
return result;
};
/**
* Get next higher power of two
* @returns { number }
* @param { number } value - input value
*/
rglwidgetClass.prototype.getPowerOfTwo = function(value) {
var pow = 1;
while(pow<value) {
pow *= 2;
}
return pow;
};
/**
* Unique entries
* @returns { any[] }
* @param { any[] } arr - An array
*/
rglwidgetClass.prototype.unique = function(arr) {
arr = [].concat(arr);
return arr.filter(function(value, index, self) {
return self.indexOf(value) === index;
});
};
/**
* Shallow compare of arrays
* @returns { boolean }
* @param { any[] } a - An array
* @param { any[] } b - Another array
*/
rglwidgetClass.prototype.equalArrays = function(a, b) {
return a === b || (a && b &&
a.length === b.length &&
a.every(function(v, i) {return v === b[i];}));
};
/**
* Repeat an array to a desired length
* @returns {any[]}
* @param {any | any[]} arr The input array
* @param {number} len The desired output length
*/
rglwidgetClass.prototype.repeatToLen = function(arr, len) {
arr = [].concat(arr);
while (arr.length < len/2)
arr = arr.concat(arr);
return arr.concat(arr.slice(0, len - arr.length));
};
/**
* Give a single alert message, not to be repeated.
* @param {string} msg  The message to give.
*/
rglwidgetClass.prototype.alertOnce = function(msg) {
if (typeof this.alerted !== "undefined")
return;
this.alerted = true;
alert(msg);
};
rglwidgetClass.prototype.f_is_lit = 1;
rglwidgetClass.prototype.f_is_smooth = 2;
rglwidgetClass.prototype.f_has_texture = 4;
rglwidgetClass.prototype.f_depth_sort = 8;
rglwidgetClass.prototype.f_fixed_quads = 16;
rglwidgetClass.prototype.f_is_transparent = 32;
rglwidgetClass.prototype.f_is_lines = 64;
rglwidgetClass.prototype.f_sprites_3d = 128;
rglwidgetClass.prototype.f_sprite_3d = 256;
rglwidgetClass.prototype.f_is_subscene = 512;
rglwidgetClass.prototype.f_is_clipplanes = 1024;
rglwidgetClass.prototype.f_fixed_size = 2048;
rglwidgetClass.prototype.f_is_points = 4096;
rglwidgetClass.prototype.f_is_twosided = 8192;
rglwidgetClass.prototype.f_fat_lines = 16384;
rglwidgetClass.prototype.f_is_brush = 32768;
/**
* Which list does a particular id come from?
* @returns { string }
* @param {number} id The id to look up.
*/
rglwidgetClass.prototype.whichList = function(id) {
var obj = this.getObj(id),
flags = obj.flags;
if (obj.type === "light")
return "lights";
if (flags & this.f_is_subscene)
return "subscenes";
if (flags & this.f_is_clipplanes)
return "clipplanes";
if (flags & this.f_is_transparent)
return "transparent";
return "opaque";
};
/**
* Get an object by id number.
* @returns { Object }
* @param {number} id
*/
rglwidgetClass.prototype.getObj = function(id) {
if (typeof id !== "number") {
this.alertOnce("getObj id is "+typeof id);
}
return this.scene.objects[id];
};
/**
* Get ids of a particular type from a subscene or the whole scene
* @returns { number[] }
* @param {string} type What type of object?
* @param {number} subscene  Which subscene?  If not given, find in the whole scene
*/
rglwidgetClass.prototype.getIdsByType = function(type, subscene) {
var
result = [], i, self = this;
if (typeof subscene === "undefined") {
Object.keys(this.scene.objects).forEach(
function(key) {
key = parseInt(key, 10);
if (self.getObj(key).type === type)
result.push(key);
});
} else {
ids = this.getObj(subscene).objects;
for (i=0; i < ids.length; i++) {
if (this.getObj(ids[i]).type === type) {
result.push(ids[i]);
}
}
}
return result;
};
/**
* Get a particular material property for an id
* @returns { any }
* @param {number} id  Which object?
* @param {string} property Which material property?
*/
rglwidgetClass.prototype.getMaterial = function(id, property) {
var obj = this.getObj(id), mat;
if (typeof obj.material === "undefined")
console.error("material undefined");
mat = obj.material[property];
if (typeof mat === "undefined")
mat = this.scene.material[property];
return mat;
};
/**
* Is a particular id in a subscene?
* @returns { boolean }
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.inSubscene = function(id, subscene) {
return this.getObj(subscene).objects.indexOf(id) > -1;
};
/**
* Add an id to a subscene.
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.addToSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
ids = [id],
obj = this.getObj(id), i;
if (typeof obj != "undefined" && typeof (obj.newIds) !== "undefined") {
ids = ids.concat(obj.newIds);
}
thesub.objects = [].concat(thesub.objects);
for (i = 0; i < ids.length; i++) {
id = ids[i];
if (thesub.objects.indexOf(id) == -1) {
thelist = this.whichList(id);
thesub.objects.push(id);
thesub[thelist].push(id);
}
}
};
/**
* Delete an id from a subscene
* @param { number } id - the id to add
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.delFromSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
obj = this.getObj(id),
ids = [id], i;
if (typeof obj !== "undefined" && typeof (obj.newIds) !== "undefined")
ids = ids.concat(obj.newIds);
thesub.objects = [].concat(thesub.objects); // It might be a scalar
for (j=0; j<ids.length;j++) {
id = ids[j];
i = thesub.objects.indexOf(id);
if (i > -1) {
thesub.objects.splice(i, 1);
thelist = this.whichList(id);
i = thesub[thelist].indexOf(id);
thesub[thelist].splice(i, 1);
}
}
};
/**
* Set the ids in a subscene
* @param { number[] } ids - the ids to set
* @param { number } subsceneid - the id of the subscene
*/
rglwidgetClass.prototype.setSubsceneEntries = function(ids, subsceneid) {
var sub = this.getObj(subsceneid);
sub.objects = ids;
this.initSubscene(subsceneid);
};
/**
* Get the ids in a subscene
* @returns {number[]}
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getSubsceneEntries = function(subscene) {
return this.getObj(subscene).objects;
};
/**
* Get the ids of the subscenes within a subscene
* @returns { number[] }
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getChildSubscenes = function(subscene) {
return this.getObj(subscene).subscenes;
};
/**
* Start drawing
* @returns { boolean } Previous state
*/
rglwidgetClass.prototype.startDrawing = function() {
var value = this.drawing;
this.drawing = true;
return value;
};
/**
* Stop drawing and check for context loss
* @param { boolean } saved - Previous state
*/
rglwidgetClass.prototype.stopDrawing = function(saved) {
this.drawing = saved;
if (!saved && this.gl && this.gl.isContextLost())
this.restartCanvas();
};
/**
* Generate the vertex shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getVertexShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userVertexShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
nclipplanes = this.countClipplanes(),
fixed_size = flags & this.f_fixed_size,
is_points = flags & this.f_is_points,
is_twosided = flags & this.f_is_twosided,
fat_lines = flags & this.f_fat_lines,
is_brush = flags & this.f_is_brush,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
result = "  /* ****** "+type+" object "+id+" vertex shader ****** */\n"+
"  attribute vec3 aPos;\n"+
"  attribute vec4 aCol;\n"+
" uniform mat4 mvMatrix;\n"+
" uniform mat4 prMatrix;\n"+
" varying vec4 vCol;\n"+
" varying vec4 vPosition;\n";
if ((is_lit && !fixed_quads && !is_brush) || sprite_3d)
result = result + "  attribute vec3 aNorm;\n"+
" uniform mat4 normMatrix;\n"+
" varying vec3 vNormal;\n";
if (has_texture || type === "text")
result = result + " attribute vec2 aTexcoord;\n"+
" varying vec2 vTexcoord;\n";
if (fixed_size)
result = result + "  uniform vec2 textScale;\n";
if (fixed_quads)
result = result + "  attribute vec2 aOfs;\n";
else if (sprite_3d)
result = result + "  uniform vec3 uOrig;\n"+
"  uniform float uSize;\n"+
"  uniform mat4 usermat;\n";
if (is_twosided)
result = result + "  attribute vec3 aPos1;\n"+
"  attribute vec3 aPos2;\n"+
"  varying float normz;\n";
if (fat_lines) {
result = result +   "  attribute vec3 aNext;\n"+
"  attribute vec2 aPoint;\n"+
"  varying vec2 vPoint;\n"+
"  varying float vLength;\n"+
"  uniform float uAspect;\n"+
"  uniform float uLwd;\n";
}
result = result + "  void main(void) {\n";
if ((nclipplanes || (!fixed_quads && !sprite_3d)) && !is_brush)
result = result + "    vPosition = mvMatrix * vec4(aPos, 1.);\n";
if (!fixed_quads && !sprite_3d && !is_brush)
result = result + "    gl_Position = prMatrix * vPosition;\n";
if (is_points) {
var size = this.getMaterial(id, "size");
result = result + "    gl_PointSize = "+size.toFixed(1)+";\n";
}
result = result + "    vCol = aCol;\n";
if (is_lit && !fixed_quads && !sprite_3d && !is_brush)
result = result + "    vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n";
if (has_texture || type == "text")
result = result + "    vTexcoord = aTexcoord;\n";
if (fixed_size)
result = result + "    vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w;\n"+
"   gl_Position = pos + vec4(aOfs*textScale, 0.,0.);\n";
if (type == "sprites" && !fixed_size)
result = result + "    vec4 pos = mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w + vec4(aOfs, 0., 0.);\n"+
"   gl_Position = prMatrix*pos;\n";
if (sprite_3d)
result = result + "   vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n"+
"   vec4 pos = mvMatrix * vec4(uOrig, 1.);\n"+
"   vPosition = pos/pos.w + vec4(uSize*(vec4(aPos, 1.)*usermat).xyz,0.);\n"+
"   gl_Position = prMatrix * vPosition;\n";
if (is_twosided)
result = result + "   vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n"+
"   pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n"+
"   vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n"+
"   pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n"+
"   normz = pos1.x*pos2.y - pos1.y*pos2.x;\n";
if (fat_lines) 
/* This code was inspired by Matt Deslauriers' code in https://mattdesl.svbtle.com/drawing-lines-is-hard */
result = result + "   vec2 aspectVec = vec2(uAspect, 1.0);\n"+
"   mat4 projViewModel = prMatrix * mvMatrix;\n"+
"   vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n"+
"   currentProjected = currentProjected/currentProjected.w;\n"+
"   vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n"+
"   vec2 currentScreen = currentProjected.xy * aspectVec;\n"+
"   vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n"+
"   float len = uLwd;\n"+
"   vec2 dir = vec2(1.0, 0.0);\n"+
"   vPoint = aPoint;\n"+
"   vLength = length(nextScreen - currentScreen)/2.0;\n"+
"   vLength = vLength/(vLength + len);\n"+
"   if (vLength > 0.0) {\n"+
"     dir = normalize(nextScreen - currentScreen);\n"+
"   }\n"+
"   vec2 normal = vec2(-dir.y, dir.x);\n"+
"   dir.x /= uAspect;\n"+
"   normal.x /= uAspect;\n"+
"   vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n"+
"   gl_Position = currentProjected + offset;\n";
if (is_brush)
result = result + "   gl_Position = vec4(aPos, 1.);\n";
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Generate the fragment shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getFragmentShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userFragmentShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
is_twosided = (flags & this.f_is_twosided) > 0,
fat_lines = flags & this.f_fat_lines,
is_transparent = flags & this.f_is_transparent,
nclipplanes = this.countClipplanes(), i,
texture_format, nlights,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
if (has_texture)
texture_format = this.getMaterial(id, "textype");
result = "/* ****** "+type+" object "+id+" fragment shader ****** */\n"+
"#ifdef GL_ES\n"+
"#ifdef GL_FRAGMENT_PRECISION_HIGH\n"+
"  precision highp float;\n"+
"#else\n"+
"  precision mediump float;\n"+
"#endif\n"+
"#endif\n"+
"  varying vec4 vCol; // carries alpha\n"+
"  varying vec4 vPosition;\n";
if (has_texture || type === "text")
result = result + "  varying vec2 vTexcoord;\n"+
" uniform sampler2D uSampler;\n";
if (is_lit && !fixed_quads)
result = result + "  varying vec3 vNormal;\n";
for (i = 0; i < nclipplanes; i++)
result = result + "  uniform vec4 vClipplane"+i+";\n";
if (is_lit) {
nlights = this.countLights();
if (nlights)
result = result + "  uniform mat4 mvMatrix;\n";
else
is_lit = false;
}
if (is_lit) {
result = result + "   uniform vec3 emission;\n"+
"   uniform float shininess;\n";
for (i=0; i < nlights; i++) {
result = result + "   uniform vec3 ambient" + i + ";\n"+
"   uniform vec3 specular" + i +"; // light*material\n"+
"   uniform vec3 diffuse" + i + ";\n"+
"   uniform vec3 lightDir" + i + ";\n"+
"   uniform bool viewpoint" + i + ";\n"+
"   uniform bool finite" + i + ";\n";
}
}
if (is_twosided)
result = result + "   uniform bool front;\n"+
"   varying float normz;\n";
if (fat_lines)
result = result + "   varying vec2 vPoint;\n"+
"   varying float vLength;\n";
result = result + "  void main(void) {\n";
if (fat_lines) {
result = result + "    vec2 point = vPoint;\n"+
"    bool neg = point.y < 0.0;\n"+
"    point.y = neg ? "+
"      (point.y + vLength)/(1.0 - vLength) :\n"+
"     -(point.y - vLength)/(1.0 - vLength);\n";
if (is_transparent && type == "linestrip")
result = result+"    if (neg && length(point) <= 1.0) discard;\n";
result = result + "    point.y = min(point.y, 0.0);\n"+
"    if (length(point) > 1.0) discard;\n";
}
for (i=0; i < nclipplanes;i++)
result = result + "    if (dot(vPosition, vClipplane"+i+") < 0.0) discard;\n";
if (fixed_quads) {
result = result +   "    vec3 n = vec3(0., 0., 1.);\n";
} else if (is_lit) {
result = result +   "    vec3 n = normalize(vNormal);\n";
}
if (is_twosided) {
result = result +   "    if ((normz <= 0.) != front) discard;\n";
}
if (is_lit) {
result = result + "    vec3 eye = normalize(-vPosition.xyz);\n"+
"   vec3 lightdir;\n"+
"   vec4 colDiff;\n"+
"   vec3 halfVec;\n"+
"   vec4 lighteffect = vec4(emission, 0.);\n"+
"   vec3 col;\n"+
"   float nDotL;\n";
if (!fixed_quads) {
result = result +   "   n = -faceforward(n, n, eye);\n";
}
for (i=0; i < nlights; i++) {
result = result + "   colDiff = vec4(vCol.rgb * diffuse" + i + ", vCol.a);\n"+
"   lightdir = lightDir" + i + ";\n"+
"   if (!viewpoint" + i +")\n"+
"     lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n"+
"   if (!finite" + i + ") {\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   } else {\n"+
"     lightdir = normalize(lightdir - vPosition.xyz);\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   }\n"+
"    col = ambient" + i + ";\n"+
"   nDotL = dot(n, lightdir);\n"+
"   col = col + max(nDotL, 0.) * colDiff.rgb;\n"+
"   col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular" + i + ";\n"+
"   lighteffect = lighteffect + vec4(col, colDiff.a);\n";
}
} else {
result = result +   "   vec4 colDiff = vCol;\n"+
"    vec4 lighteffect = colDiff;\n";
}
if (type === "text")
result = result +   "    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n";
if (has_texture) {
result = result + {
rgb:            "   vec4 textureColor = lighteffect*vec4(texture2D(uSampler, vTexcoord).rgb, 1.);\n",
rgba:           "   vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n",
alpha:          "   vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.), textureColor.rgb)/3.;\n"+
"   textureColor =  vec4(lighteffect.rgb, lighteffect.a*luminance);\n",
luminance:      "   vec4 textureColor = vec4(lighteffect.rgb*dot(texture2D(uSampler, vTexcoord).rgb, vec3(1.,1.,1.))/3., lighteffect.a);\n",
"luminance.alpha":"    vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n"+
"   textureColor = vec4(lighteffect.rgb*luminance, lighteffect.a*textureColor.a);\n"
}[texture_format]+
"   gl_FragColor = textureColor;\n";
} else if (type === "text") {
result = result +   "    if (textureColor.a < 0.1)\n"+
"     discard;\n"+
"   else\n"+
"     gl_FragColor = textureColor;\n";
} else
result = result +   "   gl_FragColor = lighteffect;\n";
//if (fat_lines)
//  result = result +   "   gl_FragColor = vec4(0.0, abs(point.x), abs(point.y), 1.0);"
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Call gl functions to create and compile shader
* @returns {Object}
* @param { number } shaderType - gl code for shader type
* @param { string } code - code for the shader
*/
rglwidgetClass.prototype.getShader = function(shaderType, code) {
var gl = this.gl, shader;
shader = gl.createShader(shaderType);
gl.shaderSource(shader, code);
gl.compileShader(shader);
if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS) && !gl.isContextLost())
alert(gl.getShaderInfoLog(shader));
return shader;
};
/**
* Handle a texture after its image has been loaded
* @param { Object } texture - the gl texture object
* @param { Object } textureCanvas - the canvas holding the image
*/
rglwidgetClass.prototype.handleLoadedTexture = function(texture, textureCanvas) {
var gl = this.gl || this.initGL();
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureCanvas);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);
gl.generateMipmap(gl.TEXTURE_2D);
gl.bindTexture(gl.TEXTURE_2D, null);
};
/**
* Get maximum dimension of texture in current browser.
* @returns {number}
*/
rglwidgetClass.prototype.getMaxTexSize = function() {
var gl = this.gl || this.initGL();  
return Math.min(4096, gl.getParameter(gl.MAX_TEXTURE_SIZE));
};
/**
* Load an image to a texture
* @param { string } uri - The image location
* @param { Object } texture - the gl texture object
*/
rglwidgetClass.prototype.loadImageToTexture = function(uri, texture) {
var canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
image = new Image(),
self = this;
image.onload = function() {
var w = image.width,
h = image.height,
canvasX = self.getPowerOfTwo(w),
canvasY = self.getPowerOfTwo(h),
gl = self.gl || self.initGL(),
maxTexSize = self.getMaxTexSize();
while (canvasX > 1 && canvasY > 1 && (canvasX > maxTexSize || canvasY > maxTexSize)) {
canvasX /= 2;
canvasY /= 2;
}
canvas.width = canvasX;
canvas.height = canvasY;
ctx.imageSmoothingEnabled = true;
ctx.drawImage(image, 0, 0, canvasX, canvasY);
self.handleLoadedTexture(texture, canvas);
self.drawScene();
};
image.src = uri;
};
/**
* Draw text to the texture canvas
* @returns { Object } object with text measurements
* @param { string } text - the text
* @param { number } cex - expansion
* @param { string } family - font family
* @param { number } font - font number
*/
rglwidgetClass.prototype.drawTextToCanvas = function(text, cex, family, font) {
var canvasX, canvasY,
textY,
scaling = 20,
textColour = "white",
backgroundColour = "rgba(0,0,0,0)",
canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
i, textHeight = 0, textHeights = [], width, widths = [], 
offsetx, offsety = 0, line, lines = [], offsetsx = [],
offsetsy = [], lineoffsetsy = [], fontStrings = [],
maxTexSize = this.getMaxTexSize(),
getFontString = function(i) {
textHeights[i] = scaling*cex[i];
var fontString = textHeights[i] + "px",
family0 = family[i],
font0 = font[i];
if (family0 === "sans")
family0 = "sans-serif";
else if (family0 === "mono")
family0 = "monospace";
fontString = fontString + " " + family0;
if (font0 === 2 || font0 === 4)
fontString = "bold " + fontString;
if (font0 === 3 || font0 === 4)
fontString = "italic " + fontString;
return fontString;
};
cex = this.repeatToLen(cex, text.length);
family = this.repeatToLen(family, text.length);
font = this.repeatToLen(font, text.length);
canvasX = 1;
line = -1;
offsetx = maxTexSize;
for (i = 0; i < text.length; i++)  {
ctx.font = fontStrings[i] = getFontString(i);
width = widths[i] = ctx.measureText(text[i]).width;
if (offsetx + width > maxTexSize) {
line += 1;
offsety = lineoffsetsy[line] = offsety + 2*textHeight;
if (offsety > maxTexSize)
console.error("Too many strings for texture.");
textHeight = 0;
offsetx = 0;
}
textHeight = Math.max(textHeight, textHeights[i]);
offsetsx[i] = offsetx;
offsetx += width;
canvasX = Math.max(canvasX, offsetx);
lines[i] = line;
}
offsety = lineoffsetsy[line] = offsety + 2*textHeight;
for (i = 0; i < text.length; i++) {
offsetsy[i] = lineoffsetsy[lines[i]];
}
canvasX = this.getPowerOfTwo(canvasX);
canvasY = this.getPowerOfTwo(offsety);
canvas.width = canvasX;
canvas.height = canvasY;
ctx.fillStyle = backgroundColour;
ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
ctx.textBaseline = "alphabetic";
for(i = 0; i < text.length; i++) {
ctx.font = fontStrings[i];
ctx.fillStyle = textColour;
ctx.textAlign = "left";
ctx.fillText(text[i], offsetsx[i],  offsetsy[i]);
}
return {canvasX:canvasX, canvasY:canvasY,
widths:widths, textHeights:textHeights,
offsetsx:offsetsx, offsetsy:offsetsy};
};
/**
* Set the gl viewport and scissor test
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setViewport = function(id) {
var gl = this.gl || this.initGL(),
vp = this.getObj(id).par3d.viewport,
x = vp.x*this.canvas.width,
y = vp.y*this.canvas.height,
width = vp.width*this.canvas.width,
height = vp.height*this.canvas.height;
this.vp = {x:x, y:y, width:width, height:height};
gl.viewport(x, y, width, height);
gl.scissor(x, y, width, height);
gl.enable(gl.SCISSOR_TEST);
};
/**
* Set the projection matrix for a subscene
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setprMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.projection;
if (embedding === "replace")
this.prMatrix.makeIdentity();
else
this.setprMatrix(subscene.parent);
if (embedding === "inherit")
return;
// This is based on the Frustum::enclose code from geom.cpp
var bbox = subscene.par3d.bbox,
scale = subscene.par3d.scale,
ranges = [(bbox[1]-bbox[0])*scale[0]/2,
(bbox[3]-bbox[2])*scale[1]/2,
(bbox[5]-bbox[4])*scale[2]/2],
radius = Math.sqrt(this.sumsq(ranges))*1.1; // A bit bigger to handle labels
if (radius <= 0) radius = 1;
var observer = subscene.par3d.observer,
distance = observer[2],
FOV = subscene.par3d.FOV, ortho = FOV === 0,
t = ortho ? 1 : Math.tan(FOV*Math.PI/360),
near = distance - radius,
far = distance + radius,
hlen,
aspect = this.vp.width/this.vp.height,
z = subscene.par3d.zoom,
userProjection = subscene.par3d.userProjection;
if (far < 0.0)
far = 1.0;
if (near < far/100.0)
near = far/100.0;
hlen = t*near;
if (ortho) {
if (aspect > 1)
this.prMatrix.ortho(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.ortho(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
} else {
if (aspect > 1)
this.prMatrix.frustum(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.frustum(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
}
this.prMatrix.multRight(userProjection);
};
/**
* Set the model-view matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmvMatrix = function(id) {
var observer = this.getObj(id).par3d.observer;
this.mvMatrix.makeIdentity();
this.setmodelMatrix(id);
this.mvMatrix.translate(-observer[0], -observer[1], -observer[2]);
};
/**
* Set the model matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmodelMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.model;
if (embedding !== "inherit") {
var scale = subscene.par3d.scale,
bbox = subscene.par3d.bbox,
center = [(bbox[0]+bbox[1])/2,
(bbox[2]+bbox[3])/2,
(bbox[4]+bbox[5])/2];
this.mvMatrix.translate(-center[0], -center[1], -center[2]);
this.mvMatrix.scale(scale[0], scale[1], scale[2]);
this.mvMatrix.multRight( subscene.par3d.userMatrix );
}
if (embedding !== "replace")
this.setmodelMatrix(subscene.parent);
};
/**
* Set the normals matrix for a subscene
* @param { number } subsceneid - id of the subscene
*/
rglwidgetClass.prototype.setnormMatrix = function(subsceneid) {
var self = this,
recurse = function(id) {
var sub = self.getObj(id),
embedding = sub.embeddings.model;
if (embedding !== "inherit") {
var scale = sub.par3d.scale;
self.normMatrix.scale(1/scale[0], 1/scale[1], 1/scale[2]);
self.normMatrix.multRight(sub.par3d.userMatrix);
}
if (embedding !== "replace")
recurse(sub.parent);
};
self.normMatrix.makeIdentity();
recurse(subsceneid);
};
/**
* Set the combined projection-model-view matrix
*/
rglwidgetClass.prototype.setprmvMatrix = function() {
this.prmvMatrix = new CanvasMatrix4( this.mvMatrix );
this.prmvMatrix.multRight( this.prMatrix );
};
/**
* Count clipping planes in a scene
* @returns {number}
*/
rglwidgetClass.prototype.countClipplanes = function() {
return this.countObjs("clipplanes");
};
/**
* Count lights in a scene
* @returns { number }
*/
rglwidgetClass.prototype.countLights = function() {
return this.countObjs("light");
};
/**
* Count objects of specific type in a scene
* @returns { number }
* @param { string } type - Type of object to count
*/
rglwidgetClass.prototype.countObjs = function(type) {
var self = this,
bound = 0;
Object.keys(this.scene.objects).forEach(
function(key) {
if (self.getObj(parseInt(key, 10)).type === type)
bound = bound + 1;
});
return bound;
};
/**
* Initialize a subscene
* @param { number } id - id of subscene.
*/
rglwidgetClass.prototype.initSubscene = function(id) {
var sub = this.getObj(id),
i, obj;
if (sub.type !== "subscene")
return;
sub.par3d.userMatrix = this.toCanvasMatrix4(sub.par3d.userMatrix);
sub.par3d.userProjection = this.toCanvasMatrix4(sub.par3d.userProjection);
sub.par3d.userProjection.transpose();
sub.par3d.listeners = [].concat(sub.par3d.listeners);
sub.backgroundId = undefined;
sub.subscenes = [];
sub.clipplanes = [];
sub.transparent = [];
sub.opaque = [];
sub.lights = [];
for (i=0; i < sub.objects.length; i++) {
obj = this.getObj(sub.objects[i]);
if (typeof obj === "undefined") {
sub.objects.splice(i, 1);
i--;
} else if (obj.type === "background")
sub.backgroundId = obj.id;
else
sub[this.whichList(obj.id)].push(obj.id);
}
};
/**
* Copy object
* @param { number } id - id of object to copy
* @param { string } reuse - Document id of scene to reuse
*/
rglwidgetClass.prototype.copyObj = function(id, reuse) {
var obj = this.getObj(id),
prev = document.getElementById(reuse);
if (prev !== null) {
prev = prev.rglinstance;
var
prevobj = prev.getObj(id),
fields = ["flags", "type",
"colors", "vertices", "centers",
"normals", "offsets",
"texts", "cex", "family", "font", "adj",
"material",
"radii",
"texcoords",
"userMatrix", "ids",
"dim",
"par3d", "userMatrix",
"viewpoint", "finite",
"pos"],
i;
for (i = 0; i < fields.length; i++) {
if (typeof prevobj[fields[i]] !== "undefined")
obj[fields[i]] = prevobj[fields[i]];
}
} else
console.warn("copyObj failed");
};
/**
* Update the triangles used to display a plane
* @param { number } id - id of the plane
* @param { Object } bbox - bounding box in which to display the plane
*/
rglwidgetClass.prototype.planeUpdateTriangles = function(id, bbox) {
var perms = [[0,0,1], [1,2,2], [2,1,0]],
x, xrow, elem, A, d, nhits, i, j, k, u, v, w, intersect, which, v0, v2, vx, reverse,
face1 = [], face2 = [], normals = [],
obj = this.getObj(id),
nPlanes = obj.normals.length;
obj.bbox = bbox;
obj.vertices = [];
obj.initialized = false;
for (elem = 0; elem < nPlanes; elem++) {
//    Vertex Av = normal.getRecycled(elem);
x = [];
A = obj.normals[elem];
d = obj.offsets[elem][0];
nhits = 0;
for (i=0; i<3; i++)
for (j=0; j<2; j++)
for (k=0; k<2; k++) {
u = perms[0][i];
v = perms[1][i];
w = perms[2][i];
if (A[w] !== 0.0) {
intersect = -(d + A[u]*bbox[j+2*u] + A[v]*bbox[k+2*v])/A[w];
if (bbox[2*w] < intersect && intersect < bbox[1+2*w]) {
xrow = [];
xrow[u] = bbox[j+2*u];
xrow[v] = bbox[k+2*v];
xrow[w] = intersect;
x.push(xrow);
face1[nhits] = j + 2*u;
face2[nhits] = k + 2*v;
nhits++;
}
}
}
if (nhits > 3) {
/* Re-order the intersections so the triangles work */
for (i=0; i<nhits-2; i++) {
which = 0; /* initialize to suppress warning */
for (j=i+1; j<nhits; j++) {
if (face1[i] == face1[j] || face1[i] == face2[j] ||
face2[i] == face1[j] || face2[i] == face2[j] ) {
which = j;
break;
}
}
if (which > i+1) {
this.swap(x, i+1, which);
this.swap(face1, i+1, which);
this.swap(face2, i+1, which);
}
}
}
if (nhits >= 3) {
/* Put in order so that the normal points out the FRONT of the faces */
v0 = [x[0][0] - x[1][0] , x[0][1] - x[1][1], x[0][2] - x[1][2]];
v2 = [x[2][0] - x[1][0] , x[2][1] - x[1][1], x[2][2] - x[1][2]];
/* cross-product */
vx = this.xprod(v0, v2);
reverse = this.dotprod(vx, A) > 0;
for (i=0; i<nhits-2; i++) {
obj.vertices.push(x[0]);
normals.push(A);
for (j=1; j<3; j++) {
obj.vertices.push(x[i + (reverse ? 3-j : j)]);
normals.push(A);
}
}
}
}
obj.pnormals = normals;
};
rglwidgetClass.prototype.getAdj = function (pos, offset, text) {
switch(pos) {
case 1: return [0.5, 1 + offset];
case 2: return [1 + offset/text.length, 0.5];
case 3: return [0.5, -offset];
case 4: return [-offset/text.length, 0.5];
}
}
/**
* Initialize object for display
* @param { number } id - id of object to initialize
*/
rglwidgetClass.prototype.initObj = function(id) {
var obj = this.getObj(id),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
is_transparent = obj.is_transparent,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
is_brush = flags & this.f_is_brush,
gl = this.gl || this.initGL(),
polygon_offset,
texinfo, drawtype, nclipplanes, f, nrows, oldrows,
i,j,v,v1,v2, mat, uri, matobj, pass, passes, pmode,
dim, nx, nz, attr;
if (typeof id !== "number") {
this.alertOnce("initObj id is "+typeof id);
}
obj.initialized = true;
if (type === "bboxdeco" || type === "subscene")
return;
if (type === "light") {
obj.ambient = new Float32Array(obj.colors[0].slice(0,3));
obj.diffuse = new Float32Array(obj.colors[1].slice(0,3));
obj.specular = new Float32Array(obj.colors[2].slice(0,3));
obj.lightDir = new Float32Array(obj.vertices[0]);
return;
}
if (type === "clipplanes") {
obj.vClipplane = this.flatten(this.cbind(obj.normals, obj.offsets));
return;
}
if (type === "background" && typeof obj.ids !== "undefined") {
obj.quad = this.flatten([].concat(obj.ids));
return;
}
polygon_offset = this.getMaterial(id, "polygon_offset");
if (polygon_offset[0] != 0 || polygon_offset[1] != 0)
obj.polygon_offset = polygon_offset;
if (is_transparent) {
depth_sort = ["triangles", "quads", "surface",
"spheres", "sprites", "text"].indexOf(type) >= 0;
}
if (is_brush)
this.initSelection(id);
if (typeof obj.vertices === "undefined")
obj.vertices = [];
v = obj.vertices;
obj.vertexCount = v.length;
if (!obj.vertexCount) return;
if (is_twosided) {
if (typeof obj.userAttributes === "undefined")
obj.userAttributes = {};
v1 = Array(v.length);
v2 = Array(v.length);
if (obj.type == "triangles" || obj.type == "quads") {
if (obj.type == "triangles")
nrow = 3;
else
nrow = 4;
for (i=0; i<Math.floor(v.length/nrow); i++)
for (j=0; j<nrow; j++) {
v1[nrow*i + j] = v[nrow*i + ((j+1) % nrow)];
v2[nrow*i + j] = v[nrow*i + ((j+2) % nrow)];
}
} else if (obj.type == "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz && j+1 < nx) {
v2[j + nx*i] = v[j + nx*(i+1)];
v1[j + nx*i] = v[j+1 + nx*(i+1)];
} else if (i+1 < nz) {
v2[j + nx*i] = v[j-1 + nx*i];
v1[j + nx*i] = v[j + nx*(i+1)];
} else {
v2[j + nx*i] = v[j + nx*(i-1)];
v1[j + nx*i] = v[j-1 + nx*(i-1)];
}
}
}
}
obj.userAttributes.aPos1 = v1;
obj.userAttributes.aPos2 = v2;
}
if (!sprites_3d) {
if (gl.isContextLost()) return;
obj.prog = gl.createProgram();
gl.attachShader(obj.prog, this.getShader( gl.VERTEX_SHADER,
this.getVertexShader(id) ));
gl.attachShader(obj.prog, this.getShader( gl.FRAGMENT_SHADER,
this.getFragmentShader(id) ));
//  Force aPos to location 0, aCol to location 1
gl.bindAttribLocation(obj.prog, 0, "aPos");
gl.bindAttribLocation(obj.prog, 1, "aCol");
gl.linkProgram(obj.prog);
var linked = gl.getProgramParameter(obj.prog, gl.LINK_STATUS);
if (!linked) {
// An error occurred while linking
var lastError = gl.getProgramInfoLog(obj.prog);
console.warn("Error in program linking:" + lastError);
gl.deleteProgram(obj.prog);
return;
}
}
if (type === "text") {
texinfo = this.drawTextToCanvas(obj.texts,
this.flatten(obj.cex),
this.flatten(obj.family),
this.flatten(obj.family));
}
if (fixed_quads && !sprites_3d) {
obj.ofsLoc = gl.getAttribLocation(obj.prog, "aOfs");
}
if (sprite_3d) {
obj.origLoc = gl.getUniformLocation(obj.prog, "uOrig");
obj.sizeLoc = gl.getUniformLocation(obj.prog, "uSize");
obj.usermatLoc = gl.getUniformLocation(obj.prog, "usermat");
}
if (has_texture || type == "text") {
if (!obj.texture)
obj.texture = gl.createTexture();
obj.texLoc = gl.getAttribLocation(obj.prog, "aTexcoord");
obj.sampler = gl.getUniformLocation(obj.prog, "uSampler");
}
if (has_texture) {
mat = obj.material;
if (typeof mat.uri !== "undefined")
uri = mat.uri;
else if (typeof mat.uriElementId === "undefined") {
matobj = this.getObj(mat.uriId);
if (typeof matobj !== "undefined") {
uri = matobj.material.uri;
} else {
uri = "";
}
} else
uri = document.getElementById(mat.uriElementId).rglinstance.getObj(mat.uriId).material.uri;
this.loadImageToTexture(uri, obj.texture);
}
if (type === "text") {
this.handleLoadedTexture(obj.texture, this.textureCanvas);
}
var stride = 3, nc, cofs, nofs, radofs, oofs, tofs, vnew, fnew,
nextofs = -1, pointofs = -1, alias, colors, key, selection, filter, adj, pos, offset;
obj.alias = undefined;
colors = obj.colors;
j = this.scene.crosstalk.id.indexOf(id);
if (j >= 0) {
key = this.scene.crosstalk.key[j];
options = this.scene.crosstalk.options[j];
colors = colors.slice(0); 
for (i = 0; i < v.length; i++)
colors[i] = obj.colors[i % obj.colors.length].slice(0);
if ( (selection = this.scene.crosstalk.selection) &&
(selection.length || !options.selectedIgnoreNone) )
for (i = 0; i < v.length; i++) {
if (!selection.includes(key[i])) {
if (options.deselectedColor)
colors[i] = options.deselectedColor.slice(0);
colors[i][3] = colors[i][3]*options.deselectedFade;   /* default: mostly transparent if not selected */
} else if (options.selectedColor)
colors[i] = options.selectedColor.slice(0);
}
if ( (filter = this.scene.crosstalk.filter) )
for (i = 0; i < v.length; i++) 
if (!filter.includes(key[i])) {
if (options.filteredColor)
colors[i] = options.filteredColor.slice(0);
colors[i][3] = colors[i][3]*options.filteredFade;   /* default: completely hidden if filtered */
}
}  
nc = obj.colorCount = colors.length;
if (nc > 1) {
cofs = stride;
stride = stride + 4;
v = this.cbind(v, colors);
} else {
cofs = -1;
obj.onecolor = this.flatten(colors);
}
if (typeof obj.normals !== "undefined") {
nofs = stride;
stride = stride + 3;
v = this.cbind(v, typeof obj.pnormals !== "undefined" ? obj.pnormals : obj.normals);
} else
nofs = -1;
if (typeof obj.radii !== "undefined") {
radofs = stride;
stride = stride + 1;
// FIXME:  always concat the radii?
if (obj.radii.length === v.length) {
v = this.cbind(v, obj.radii);
} else if (obj.radii.length === 1) {
v = v.map(function(row, i, arr) { return row.concat(obj.radii[0]);});
}
} else
radofs = -1;
// Add default indices
f = Array(v.length);
for (i = 0; i < v.length; i++)
f[i] = i;
obj.f = [f,f];
if (type == "sprites" && !sprites_3d) {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
fnew = new Array(4*v.length);
alias = new Array(v.length);
var rescale = fixed_size ? 72 : 1,
size = obj.radii, s = rescale*size[0]/2;
last = v.length;
f = obj.f[0];
for (i=0; i < v.length; i++) {
if (size.length > 1)
s = rescale*size[i]/2;
vnew[i]  = v[i].concat([0,0,-s,-s]);
fnew[4*i] = f[i];
vnew[last]= v[i].concat([1,0, s,-s]);
fnew[4*i+1] = last++;
vnew[last]= v[i].concat([1,1, s, s]);
fnew[4*i+2] = last++;
vnew[last]= v[i].concat([0,1,-s, s]);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (type === "text") {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
f = obj.f[0];
fnew = new Array(4*f.length);
alias = new Array(v.length);
last = v.length;
adj = this.flatten(obj.adj);
if (typeof obj.pos !== "undefined") {
pos = this.flatten(obj.pos);
offset = adj[0];
}
for (i=0; i < v.length; i++) {
if (typeof pos !== "undefined")
adj = this.getAdj(pos[i % pos.length], offset, obj.texts[i]);
vnew[i]  = v[i].concat([0,-0.5]).concat(adj);
fnew[4*i] = f[i];
vnew[last] = v[i].concat([1,-0.5]).concat(adj);
fnew[4*i+1] = last++;
vnew[last] = v[i].concat([1, 1.5]).concat(adj);
fnew[4*i+2] = last++;
vnew[last] = v[i].concat([0, 1.5]).concat(adj);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
for (j=0; j < 4; j++) {
v1 = vnew[fnew[4*i+j]];
v1[tofs+2] = 2*(v1[tofs]-v1[tofs+2])*texinfo.widths[i];
v1[tofs+3] = 2*(v1[tofs+1]-v1[tofs+3])*texinfo.textHeights[i];
v1[tofs] = (texinfo.offsetsx[i] + v1[tofs]*texinfo.widths[i])/texinfo.canvasX;
v1[tofs+1] = 1.0-(texinfo.offsetsy[i] -
v1[tofs+1]*texinfo.textHeights[i])/texinfo.canvasY;
vnew[fnew[4*i+j]] = v1;
}
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (typeof obj.texcoords !== "undefined") {
tofs = stride;
stride += 2;
oofs = -1;
v = this.cbind(v, obj.texcoords);
} else {
tofs = -1;
oofs = -1;
}
obj.alias = alias;
if (typeof obj.userAttributes !== "undefined") {
obj.userAttribOffsets = {};
obj.userAttribLocations = {};
obj.userAttribSizes = {};
for (attr in obj.userAttributes) {
obj.userAttribLocations[attr] = gl.getAttribLocation(obj.prog, attr);
if (obj.userAttribLocations[attr] >= 0) { // Attribute may not have been used
obj.userAttribOffsets[attr] = stride;
v = this.cbind(v, obj.userAttributes[attr]);
stride = v[0].length;
obj.userAttribSizes[attr] = stride - obj.userAttribOffsets[attr];
}
}
}
if (typeof obj.userUniforms !== "undefined") {
obj.userUniformLocations = {};
for (attr in obj.userUniforms)
obj.userUniformLocations[attr] = gl.getUniformLocation(obj.prog, attr);
}
if (sprites_3d) {
obj.userMatrix = new CanvasMatrix4(obj.userMatrix);
obj.objects = this.flatten([].concat(obj.ids));
is_lit = false;
for (i=0; i < obj.objects.length; i++)
this.initObj(obj.objects[i]);
}
if (is_lit && !fixed_quads) {
obj.normLoc = gl.getAttribLocation(obj.prog, "aNorm");
}
nclipplanes = this.countClipplanes();
if (nclipplanes && !sprites_3d) {
obj.clipLoc = [];
for (i=0; i < nclipplanes; i++)
obj.clipLoc[i] = gl.getUniformLocation(obj.prog,"vClipplane" + i);
}
if (is_lit) {
obj.emissionLoc = gl.getUniformLocation(obj.prog, "emission");
obj.emission = new Float32Array(this.stringToRgb(this.getMaterial(id, "emission")));
obj.shininessLoc = gl.getUniformLocation(obj.prog, "shininess");
obj.shininess = this.getMaterial(id, "shininess");
obj.nlights = this.countLights();
obj.ambientLoc = [];
obj.ambient = new Float32Array(this.stringToRgb(this.getMaterial(id, "ambient")));
obj.specularLoc = [];
obj.specular = new Float32Array(this.stringToRgb(this.getMaterial(id, "specular")));
obj.diffuseLoc = [];
obj.lightDirLoc = [];
obj.viewpointLoc = [];
obj.finiteLoc = [];
for (i=0; i < obj.nlights; i++) {
obj.ambientLoc[i] = gl.getUniformLocation(obj.prog, "ambient" + i);
obj.specularLoc[i] = gl.getUniformLocation(obj.prog, "specular" + i);
obj.diffuseLoc[i] = gl.getUniformLocation(obj.prog, "diffuse" + i);
obj.lightDirLoc[i] = gl.getUniformLocation(obj.prog, "lightDir" + i);
obj.viewpointLoc[i] = gl.getUniformLocation(obj.prog, "viewpoint" + i);
obj.finiteLoc[i] = gl.getUniformLocation(obj.prog, "finite" + i);
}
}
obj.passes = is_twosided + 1;
obj.pmode = new Array(obj.passes);
for (pass = 0; pass < obj.passes; pass++) {
if (type === "triangles" || type === "quads" || type === "surface")
pmode = this.getMaterial(id, (pass === 0) ? "front" : "back");
else pmode = "filled";
obj.pmode[pass] = pmode;
}
obj.f.length = obj.passes;
for (pass = 0; pass < obj.passes; pass++) {
f = fnew = obj.f[pass];
pmode = obj.pmode[pass];
if (pmode === "culled")
f = [];
else if (pmode === "points") {
// stay with default
} else if ((type === "quads" || type === "text" ||
type === "sprites") && !sprites_3d) {
nrows = Math.floor(obj.vertexCount/4);
if (pmode === "filled") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[4*i];
fnew[6*i+1] = f[4*i + 1];
fnew[6*i+2] = f[4*i + 2];
fnew[6*i+3] = f[4*i];
fnew[6*i+4] = f[4*i + 2];
fnew[6*i+5] = f[4*i + 3];
}
} else {
fnew = Array(8*nrows);
for (i=0; i < nrows; i++) {
fnew[8*i] = f[4*i];
fnew[8*i+1] = f[4*i + 1];
fnew[8*i+2] = f[4*i + 1];
fnew[8*i+3] = f[4*i + 2];
fnew[8*i+4] = f[4*i + 2];
fnew[8*i+5] = f[4*i + 3];
fnew[8*i+6] = f[4*i + 3];
fnew[8*i+7] = f[4*i];
}
}
} else if (type === "triangles") {
nrows = Math.floor(obj.vertexCount/3);
if (pmode === "filled") {
fnew = Array(3*nrows);
for (i=0; i < fnew.length; i++) {
fnew[i] = f[i];
}
} else if (pmode === "lines") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[3*i];
fnew[6*i + 1] = f[3*i + 1];
fnew[6*i + 2] = f[3*i + 1];
fnew[6*i + 3] = f[3*i + 2];
fnew[6*i + 4] = f[3*i + 2];
fnew[6*i + 5] = f[3*i];
}
}
} else if (type === "spheres") {
// default
} else if (type === "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
if (pmode === "filled") {
fnew = [];
for (j=0; j<nx-1; j++) {
for (i=0; i<nz-1; i++) {
fnew.push(f[j + nx*i],
f[j + nx*(i+1)],
f[j + 1 + nx*(i+1)],
f[j + nx*i],
f[j + 1 + nx*(i+1)],
f[j + 1 + nx*i]);
}
}
} else if (pmode === "lines") {
fnew = [];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz)
fnew.push(f[j + nx*i],
f[j + nx*(i+1)]);
if (j+1 < nx)
fnew.push(f[j + nx*i],
f[j+1 + nx*i]);
}
}
}
}
obj.f[pass] = fnew;
if (depth_sort) {
drawtype = "DYNAMIC_DRAW";
} else {
drawtype = "STATIC_DRAW";
}
}
if (fat_lines) {
alias = undefined;
obj.nextLoc = gl.getAttribLocation(obj.prog, "aNext");
obj.pointLoc = gl.getAttribLocation(obj.prog, "aPoint");
obj.aspectLoc = gl.getUniformLocation(obj.prog, "uAspect");
obj.lwdLoc = gl.getUniformLocation(obj.prog, "uLwd");
// Expand vertices to turn each segment into a pair of triangles
for (pass = 0; pass < obj.passes; pass++) {
f = obj.f[pass];    
oldrows = f.length;
if (obj.pmode[pass] === "lines") 
break;
}
if (type === "linestrip") 
nrows = 4*(oldrows - 1); 
else
nrows = 2*oldrows;
vnew = new Array(nrows);
fnew = new Array(1.5*nrows);
var fnext = new Array(nrows),
fpt = new Array(nrows), 
pt, start, gap = type === "linestrip" ? 3 : 1;
// We're going to turn each pair of vertices into 4 new ones, with the "next" and "pt" attributes
// added.
// We do this by copying the originals in the first pass, adding the new attributes, then in a 
// second pass add new vertices at the end.
for (i = 0; i < v.length; i++) {
vnew[i] = v[i].concat([0,0,0,0,0]); 
}
nextofs = stride;
pointofs = stride + 3;
stride = stride + 5;
// Now add the extras
last = v.length - 1;
ind = 0;
alias = new Array(f.length);
for (i = 0; i < f.length; i++)
alias[i] = [];
for (i = 0; i < f.length - 1; i++) {
if (type !== "linestrip" && i % 2 == 1)
continue;
k = ++last;
vnew[k] = vnew[f[i]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i+1]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = -1;
fnew[ind] = k;
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+1] = last;
alias[f[i]].push(last-1, last);
last++;
k = last;
vnew[k] = vnew[f[i+1]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = 1;
fnew[ind+2] = k;
fnew[ind+3] = fnew[ind+1];
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+4] = last;
fnew[ind+5] = fnew[ind+2];
ind += 6;
alias[f[i+1]].push(last-1, last);
}
vnew.length = last+1;
v = vnew;
obj.vertexCount = v.length;
if (typeof alias !== "undefined" && typeof obj.alias !== "undefined") {  // Already have aliases from previous section?
var oldalias = obj.alias, newalias = Array(obj.alias.length);
for (i = 0; i < newalias.length; i++) {
newalias[i] = oldalias[i].slice();
for (j = 0; j < oldalias[i].length; j++)
Array.prototype.push.apply(newalias[i], alias[oldalias[j]]); // pushes each element 
}
obj.alias = newalias;
} else
obj.alias = alias;
for (pass = 0; pass < obj.passes; pass++)
if (type === "lines" || type === "linestrip" || obj.pmode[pass] == "lines") {
obj.f[pass] = fnew;
}
if (depth_sort) 
drawtype = "DYNAMIC_DRAW";
else
drawtype = "STATIC_DRAW";
}
for (pass = 0; pass < obj.passes; pass++) {
if (obj.vertexCount > 65535) {
if (this.index_uint) {
obj.f[pass] = new Uint32Array(obj.f[pass]);
obj.index_uint = true;
} else
this.alertOnce("Object has "+obj.vertexCount+" vertices, not supported in this browser.");
} else {
obj.f[pass] = new Uint16Array(obj.f[pass]);
obj.index_uint = false;
}
}
if (stride !== v[0].length) {
this.alertOnce("problem in stride calculation");
}
obj.vOffsets = {vofs:0, cofs:cofs, nofs:nofs, radofs:radofs, oofs:oofs, tofs:tofs,
nextofs:nextofs, pointofs:pointofs, stride:stride};
obj.values = new Float32Array(this.flatten(v));
if (type !== "spheres" && !sprites_3d) {
obj.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW); //
obj.ibuf = Array(obj.passes);
obj.ibuf[0] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[0]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[0], gl[drawtype]);
if (is_twosided) {
obj.ibuf[1] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[1]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[1], gl[drawtype]);
}
}
if (!sprites_3d) {
obj.mvMatLoc = gl.getUniformLocation(obj.prog, "mvMatrix");
obj.prMatLoc = gl.getUniformLocation(obj.prog, "prMatrix");
}
if (fixed_size) {
obj.textScaleLoc = gl.getUniformLocation(obj.prog, "textScale");
}
if (is_lit && !sprites_3d) {
obj.normMatLoc = gl.getUniformLocation(obj.prog, "normMatrix");
}
if (is_twosided) {
obj.frontLoc = gl.getUniformLocation(obj.prog, "front");
}
};
/**
* Set gl depth test based on object's material
* @param { number } id - object to use
*/
rglwidgetClass.prototype.setDepthTest = function(id) {
var gl = this.gl || this.initGL(),
tests = {never: gl.NEVER,
less:  gl.LESS,
equal: gl.EQUAL,
lequal:gl.LEQUAL,
greater: gl.GREATER,
notequal: gl.NOTEQUAL,
gequal: gl.GEQUAL,
always: gl.ALWAYS},
test = tests[this.getMaterial(id, "depth_test")];
gl.depthFunc(test);
};
rglwidgetClass.prototype.mode4type = {points : "POINTS",
linestrip : "LINE_STRIP",
abclines : "LINES",
lines : "LINES",
sprites : "TRIANGLES",
planes : "TRIANGLES",
text : "TRIANGLES",
quads : "TRIANGLES",
surface : "TRIANGLES",
triangles : "TRIANGLES"};
/**
* Sort objects from back to front
* @returns { number[] }
* @param { Object } obj - object to sort
*/
rglwidgetClass.prototype.depthSort = function(obj) {
var n = obj.centers.length,
depths = new Float32Array(n),
result = new Array(n),
compare = function(i,j) { return depths[j] - depths[i]; },
z, w;
for(i=0; i<n; i++) {
z = this.prmvMatrix.m13*obj.centers[i][0] +
this.prmvMatrix.m23*obj.centers[i][1] +
this.prmvMatrix.m33*obj.centers[i][2] +
this.prmvMatrix.m43;
w = this.prmvMatrix.m14*obj.centers[i][0] +
this.prmvMatrix.m24*obj.centers[i][1] +
this.prmvMatrix.m34*obj.centers[i][2] +
this.prmvMatrix.m44;
depths[i] = z/w;
result[i] = i;
}
result.sort(compare);
return result;
};
rglwidgetClass.prototype.disableArrays = function(obj, enabled) {
var gl = this.gl || this.initGL(),
objLocs = ["normLoc", "texLoc", "ofsLoc", "pointLoc", "nextLoc"],
thisLocs = ["posLoc", "colLoc"], i, attr;
for (i = 0; i < objLocs.length; i++) 
if (enabled[objLocs[i]]) gl.disableVertexAttribArray(obj[objLocs[i]]);
for (i = 0; i < thisLocs.length; i++)
if (enabled[thisLocs[i]]) gl.disableVertexAttribArray(this[objLocs[i]]);
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.disableVertexAttribArray( obj.userAttribLocations[attr] );
}
}
}
/**
* Draw an object in a subscene
* @param { number } id - object to draw
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawObj = function(id, subsceneid) {
var obj = this.getObj(id),
subscene = this.getObj(subsceneid),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
is_transparent = flags & this.f_is_transparent,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
is_points = flags & this.f_is_points,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
gl = this.gl || this.initGL(),
mat,
sphereMV, baseofs, ofs, sscale, i, count, light,
pass, mode, pmode, attr,
enabled = {};
if (typeof id !== "number") {
this.alertOnce("drawObj id is "+typeof id);
}
if (type === "planes") {
if (obj.bbox !== subscene.par3d.bbox || !obj.initialized) {
this.planeUpdateTriangles(id, subscene.par3d.bbox);
}
}
if (!obj.initialized)
this.initObj(id);
if (type === "clipplanes") {
count = obj.offsets.length;
var IMVClip = [];
for (i=0; i < count; i++) {
IMVClip[i] = this.multMV(this.invMatrix, obj.vClipplane.slice(4*i, 4*(i+1)));
}
obj.IMVClip = IMVClip;
return;
}
if (type === "light" || type === "bboxdeco" || !obj.vertexCount)
return;
if (!is_transparent &&
obj.someHidden) {
is_transparent = true;
depth_sort = ["triangles", "quads", "surface",
"spheres", "sprites", "text"].indexOf(type) >= 0;
}        
this.setDepthTest(id);
if (sprites_3d) {
var norigs = obj.vertices.length,
savenorm = new CanvasMatrix4(this.normMatrix);
this.origs = obj.vertices;
this.usermat = new Float32Array(obj.userMatrix.getAsArray());
this.radii = obj.radii;
this.normMatrix = subscene.spriteNormmat;
for (this.iOrig=0; this.iOrig < norigs; this.iOrig++) {
for (i=0; i < obj.objects.length; i++) {
this.drawObj(obj.objects[i], subsceneid);
}
}
this.normMatrix = savenorm;
return;
} else {
gl.useProgram(obj.prog);
}
if (typeof obj.polygon_offset !== "undefined") {
gl.polygonOffset(obj.polygon_offset[0],
obj.polygon_offset[1]);
gl.enable(gl.POLYGON_OFFSET_FILL);
}
if (sprite_3d) {
gl.uniform3fv(obj.origLoc, new Float32Array(this.origs[this.iOrig]));
if (this.radii.length > 1) {
gl.uniform1f(obj.sizeLoc, this.radii[this.iOrig][0]);
} else {
gl.uniform1f(obj.sizeLoc, this.radii[0][0]);
}
gl.uniformMatrix4fv(obj.usermatLoc, false, this.usermat);
}
if (type === "spheres") {
gl.bindBuffer(gl.ARRAY_BUFFER, this.sphere.buf);
} else {
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
}
gl.uniformMatrix4fv( obj.prMatLoc, false, new Float32Array(this.prMatrix.getAsArray()) );
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(this.mvMatrix.getAsArray()) );
var clipcheck = 0,
clipplaneids = subscene.clipplanes,
clip, j;
for (i=0; i < clipplaneids.length; i++) {
clip = this.getObj(clipplaneids[i]);
for (j=0; j < clip.offsets.length; j++) {
gl.uniform4fv(obj.clipLoc[clipcheck + j], clip.IMVClip[j]);
}
clipcheck += clip.offsets.length;
}
if (typeof obj.clipLoc !== "undefined")
for (i=clipcheck; i < obj.clipLoc.length; i++)
gl.uniform4f(obj.clipLoc[i], 0,0,0,0);
if (is_lit) {
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(this.normMatrix.getAsArray()) );
gl.uniform3fv( obj.emissionLoc, obj.emission);
gl.uniform1f( obj.shininessLoc, obj.shininess);
for (i=0; i < subscene.lights.length; i++) {
light = this.getObj(subscene.lights[i]);
if (!light.initialized) this.initObj(subscene.lights[i]);
gl.uniform3fv( obj.ambientLoc[i], this.componentProduct(light.ambient, obj.ambient));
gl.uniform3fv( obj.specularLoc[i], this.componentProduct(light.specular, obj.specular));
gl.uniform3fv( obj.diffuseLoc[i], light.diffuse);
gl.uniform3fv( obj.lightDirLoc[i], light.lightDir);
gl.uniform1i( obj.viewpointLoc[i], light.viewpoint);
gl.uniform1i( obj.finiteLoc[i], light.finite);
}
for (i=subscene.lights.length; i < obj.nlights; i++) {
gl.uniform3f( obj.ambientLoc[i], 0,0,0);
gl.uniform3f( obj.specularLoc[i], 0,0,0);
gl.uniform3f( obj.diffuseLoc[i], 0,0,0);
}
}
if (fixed_size) {
gl.uniform2f( obj.textScaleLoc, 0.75/this.vp.width, 0.75/this.vp.height);
}
gl.enableVertexAttribArray( this.posLoc );
enabled.posLoc = true;
var nc = obj.colorCount;
count = obj.vertexCount;
if (type === "spheres") {
subscene = this.getObj(subsceneid);
var scale = subscene.par3d.scale,
scount = count, indices;
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.enableVertexAttribArray(obj.normLoc );
enabled.normLoc = true;
gl.vertexAttribPointer(obj.normLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.disableVertexAttribArray( this.colLoc );
var sphereNorm = new CanvasMatrix4();
sphereNorm.scale(scale[0], scale[1], scale[2]);
sphereNorm.multRight(this.normMatrix);
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(sphereNorm.getAsArray()) );
if (nc == 1) {
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
}
if (has_texture) {
gl.enableVertexAttribArray( obj.texLoc );
enabled.texLoc = true;
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,
4*this.sphere.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (depth_sort)
indices = this.depthSort(obj);
for (i = 0; i < scount; i++) {
sphereMV = new CanvasMatrix4();
if (depth_sort) {
baseofs = indices[i]*obj.vOffsets.stride;
} else {
baseofs = i*obj.vOffsets.stride;
}
ofs = baseofs + obj.vOffsets.radofs;
sscale = obj.values[ofs];
sphereMV.scale(sscale/scale[0], sscale/scale[1], sscale/scale[2]);
sphereMV.translate(obj.values[baseofs],
obj.values[baseofs+1],
obj.values[baseofs+2]);
sphereMV.multRight(this.mvMatrix);
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(sphereMV.getAsArray()) );
if (nc > 1) {
ofs = baseofs + obj.vOffsets.cofs;
gl.vertexAttrib4f( this.colLoc, obj.values[ofs],
obj.values[ofs+1],
obj.values[ofs+2],
obj.values[ofs+3] );
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.sphere.ibuf);
gl.drawElements(gl.TRIANGLES, this.sphere.sphereCount, gl.UNSIGNED_SHORT, 0);
}
this.disableArrays(obj, enabled);
if (typeof obj.polygon_offset !== "undefined") 
gl.disable(gl.POLYGON_OFFSET_FILL);
return;
} else {
if (obj.colorCount === 1) {
gl.disableVertexAttribArray( this.colLoc );
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
} else {
gl.enableVertexAttribArray( this.colLoc );
enabled.colLoc = true;
gl.vertexAttribPointer(this.colLoc, 4, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.cofs);
}
}
if (is_lit && obj.vOffsets.nofs > 0) {
gl.enableVertexAttribArray( obj.normLoc );
enabled.normLoc = true;
gl.vertexAttribPointer(obj.normLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nofs);
}
if (has_texture || type === "text") {
gl.enableVertexAttribArray( obj.texLoc );
enabled.texLoc = true;
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (fixed_quads) {
gl.enableVertexAttribArray( obj.ofsLoc );
enabled.ofsLoc = true;
gl.vertexAttribPointer(obj.ofsLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.oofs);
}
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.enableVertexAttribArray( obj.userAttribLocations[attr] );
gl.vertexAttribPointer( obj.userAttribLocations[attr], obj.userAttribSizes[attr],
gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.userAttribOffsets[attr]);
}
}
if (typeof obj.userUniforms !== "undefined") {
for (attr in obj.userUniformLocations) {
var loc = obj.userUniformLocations[attr];
if (loc !== null) {
var uniform = obj.userUniforms[attr];
if (typeof uniform.length === "undefined")
gl.uniform1f(loc, uniform);
else if (typeof uniform[0].length === "undefined") {
uniform = new Float32Array(uniform);
switch(uniform.length) {
case 2: gl.uniform2fv(loc, uniform); break;
case 3: gl.uniform3fv(loc, uniform); break;
case 4: gl.uniform4fv(loc, uniform); break;
default: console.warn("bad uniform length");
}
} else if (uniform.length == 4 && uniform[0].length == 4)
gl.uniformMatrix4fv(loc, false, new Float32Array(uniform.getAsArray()));
else
console.warn("unsupported uniform matrix");
}
}
}
for (pass = 0; pass < obj.passes; pass++) {
pmode = obj.pmode[pass];
if (pmode === "culled")
continue;
mode = fat_lines && (is_lines || pmode == "lines") ? "TRIANGLES" : this.mode4type[type];
if (depth_sort && pmode == "filled") {// Don't try depthsorting on wireframe or points
var faces = this.depthSort(obj),
nfaces = faces.length,
frowsize = Math.floor(obj.f[pass].length/nfaces);
if (type !== "spheres") {
var f = obj.index_uint ? new Uint32Array(obj.f[pass].length) : new Uint16Array(obj.f[pass].length);
for (i=0; i<nfaces; i++) {
for (j=0; j<frowsize; j++) {
f[frowsize*i + j] = obj.f[pass][frowsize*faces[i] + j];
}
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.DYNAMIC_DRAW);
}
}
if (is_twosided)
gl.uniform1i(obj.frontLoc, pass !== 0);
if (type !== "spheres") 
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
if (type === "sprites" || type === "text" || type === "quads") {
count = count * 6/4;
} else if (type === "surface") {
count = obj.f[pass].length;
}
count = obj.f[pass].length;
if (!is_lines && pmode === "lines" && !fat_lines) {
mode = "LINES";
} else if (pmode === "points") {
mode = "POINTS";
}
if ((is_lines || pmode === "lines") && fat_lines) {
gl.enableVertexAttribArray(obj.pointLoc);
enabled.pointLoc = true;
gl.vertexAttribPointer(obj.pointLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.pointofs);
gl.enableVertexAttribArray(obj.nextLoc );
enabled.nextLoc = true;
gl.vertexAttribPointer(obj.nextLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nextofs);
gl.uniform1f(obj.aspectLoc, this.vp.width/this.vp.height);
gl.uniform1f(obj.lwdLoc, this.getMaterial(id, "lwd")/this.vp.height);
}
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*obj.vOffsets.stride,  4*obj.vOffsets.vofs);
gl.drawElements(gl[mode], count, obj.index_uint ? gl.UNSIGNED_INT : gl.UNSIGNED_SHORT, 0);
this.disableArrays(obj, enabled);
}
if (typeof obj.polygon_offset !== "undefined") 
gl.disable(gl.POLYGON_OFFSET_FILL);
};
/**
* Draw the background for a subscene
* @param { number } id - id of background object
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawBackground = function(id, subsceneid) {
var gl = this.gl || this.initGL(),
obj = this.getObj(id),
bg, i;
if (!obj.initialized)
this.initObj(id);
if (obj.colors.length) {
bg = obj.colors[0];
gl.clearColor(bg[0], bg[1], bg[2], bg[3]);
gl.depthMask(true);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
}
if (typeof obj.quad !== "undefined") {
this.prMatrix.makeIdentity();
this.mvMatrix.makeIdentity();
gl.disable(gl.BLEND);
gl.disable(gl.DEPTH_TEST);
gl.depthMask(false);
for (i=0; i < obj.quad.length; i++)
this.drawObj(obj.quad[i], subsceneid);
}
};
/**
* Draw a subscene
* @param { number } subsceneid - id of subscene
* @param { boolean } opaquePass - is this the opaque drawing pass?
*/
rglwidgetClass.prototype.drawSubscene = function(subsceneid, opaquePass) {
var gl = this.gl || this.initGL(),
sub = this.getObj(subsceneid),
objects = this.scene.objects,
subids = sub.objects,
subscene_has_faces = false,
subscene_needs_sorting = false,
flags, i, obj;
if (sub.par3d.skipRedraw)
return;
for (i=0; i < subids.length; i++) {
obj = objects[subids[i]];
flags = obj.flags;
if (typeof flags !== "undefined") {
subscene_has_faces |= (flags & this.f_is_lit)
& !(flags & this.f_fixed_quads);
obj.is_transparent = (flags & this.f_is_transparent) || obj.someHidden;
subscene_needs_sorting |= (flags & this.f_depth_sort) || obj.is_transparent;
}
}
this.setViewport(subsceneid);
if (typeof sub.backgroundId !== "undefined" && opaquePass)
this.drawBackground(sub.backgroundId, subsceneid);
if (subids.length) {
this.setprMatrix(subsceneid);
this.setmvMatrix(subsceneid);
if (subscene_has_faces) {
this.setnormMatrix(subsceneid);
if ((sub.flags & this.f_sprites_3d) &&
typeof sub.spriteNormmat === "undefined") {
sub.spriteNormmat = new CanvasMatrix4(this.normMatrix);
}
}
if (subscene_needs_sorting)
this.setprmvMatrix();
var clipids = sub.clipplanes;
if (typeof clipids === "undefined") {
console.warn("bad clipids");
}
if (clipids.length > 0) {
this.invMatrix = new CanvasMatrix4(this.mvMatrix);
this.invMatrix.invert();
for (i = 0; i < clipids.length; i++)
this.drawObj(clipids[i], subsceneid);
}
subids = sub.opaque.concat(sub.transparent);
if (opaquePass) {
gl.enable(gl.DEPTH_TEST);
gl.depthMask(true);
gl.disable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
if (!this.getObj(subids[i]).is_transparent) 
this.drawObj(subids[i], subsceneid);
}
} else {
gl.depthMask(false);
gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA,
gl.ONE, gl.ONE);
gl.enable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
if (this.getObj(subids[i]).is_transparent)
this.drawObj(subids[i], subsceneid);
}
}
subids = sub.subscenes;
for (i = 0; i < subids.length; i++) {
this.drawSubscene(subids[i], opaquePass);
}
}
};
/**
* Respond to brush change
*/
rglwidgetClass.prototype.selectionChanged = function() {
var i, j, k, id, subid = this.select.subscene, subscene,
objids, obj,
p1 = this.select.region.p1, p2 = this.select.region.p2,
filter, selection = [], handle, keys, xmin, x, xmax, ymin, y, ymax, z, v,
someHidden;
if (!subid)
return;
subscene = this.getObj(subid);
objids = subscene.objects;
filter = this.scene.crosstalk.filter;
this.setmvMatrix(subid);
this.setprMatrix(subid);
this.setprmvMatrix();
xmin = Math.min(p1.x, p2.x);
xmax = Math.max(p1.x, p2.x);
ymin = Math.min(p1.y, p2.y);
ymax = Math.max(p1.y, p2.y);
for (i = 0; i < objids.length; i++) {
id = objids[i];
j = this.scene.crosstalk.id.indexOf(id);
if (j >= 0) {
keys = this.scene.crosstalk.key[j];
obj = this.getObj(id);
someHidden = false;
for (k = 0; k < keys.length; k++) {
if (filter && filter.indexOf(keys[k]) < 0) {
someHidden = true;
continue;
}
v = [].concat(obj.vertices[k]).concat(1.0);
v = this.multVM(v, this.prmvMatrix);
x = v[0]/v[3];
y = v[1]/v[3];
z = v[2]/v[3];
if (xmin <= x && x <= xmax && ymin <= y && y <= ymax && -1.0 <= z && z <= 1.0) {
selection.push(keys[k]);
} else
someHidden = true;
}
obj.someHidden = someHidden && (filter || selection.length);
obj.initialized = false;
/* Who should we notify?  Only shared data in the current subscene, or everyone? */
if (!this.equalArrays(selection, this.scene.crosstalk.selection)) {
handle = this.scene.crosstalk.sel_handle[j];
handle.set(selection, {rglSubsceneId: this.select.subscene});
}
}
}
};
/**
* Respond to selection or filter change from crosstalk
* @param { Object } event - crosstalk event
* @param { boolean } filter - filter or selection?
*/
rglwidgetClass.prototype.selection = function(event, filter) {
var i, j, ids, obj, keys, crosstalk = this.scene.crosstalk,
selection, someHidden;
// Record the message and find out if this event makes some objects have mixed values:
crosstalk = this.scene.crosstalk;
if (filter) {
filter = crosstalk.filter = event.value;
selection = crosstalk.selection;
} else {  
selection = crosstalk.selection = event.value;
filter = crosstalk.filter;
}
ids = crosstalk.id;
for (i = 0; i < ids.length ; i++) {
obj = this.getObj(ids[i]);
obj.initialized = false;
keys = crosstalk.key[i];
someHidden = false;
for (j = 0; j < keys.length && !someHidden; j++) {
if ((filter && filter.indexOf(keys[j]) < 0) ||
(selection.length && selection.indexOf(keys[j]) < 0))
someHidden = true;
}
obj.someHidden = someHidden;
}
this.drawScene();
};
/**
* Clear the selection brush
* @param { number } except - Subscene that should ignore this request
*/
rglwidgetClass.prototype.clearBrush = function(except) {
if (this.select.subscene != except) {
this.select.state = "inactive";
this.delFromSubscene(this.scene.brushId, this.select.subscene);
}
this.drawScene();
};
/**
* Compute mouse coordinates relative to current canvas
* @returns { Object }
* @param { Object } event - event object from mouse click
*/
rglwidgetClass.prototype.relMouseCoords = function(event) {
var totalOffsetX = 0,
totalOffsetY = 0,
currentElement = this.canvas;
do {
totalOffsetX += currentElement.offsetLeft;
totalOffsetY += currentElement.offsetTop;
currentElement = currentElement.offsetParent;
}
while(currentElement);
var canvasX = event.pageX - totalOffsetX,
canvasY = event.pageY - totalOffsetY;
return {x:canvasX, y:canvasY};
};
/**
* Set mouse handlers for the scene
*/
rglwidgetClass.prototype.setMouseHandlers = function() {
var self = this, activeSubscene, handler,
handlers = {}, drag = 0;
handlers.rotBase = 0;
this.screenToVector = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
radius = Math.max(width, height)/2.0,
cx = width/2.0,
cy = height/2.0,
px = (x-cx)/radius,
py = (y-cy)/radius,
plen = Math.sqrt(px*px+py*py);
if (plen > 1.e-6) {
px = px/plen;
py = py/plen;
}
var angle = (Math.SQRT2 - plen)/Math.SQRT2*Math.PI/2,
z = Math.sin(angle),
zlen = Math.sqrt(1.0 - z*z);
px = px * zlen;
py = py * zlen;
return [px, py, z];
};
handlers.trackballdown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.rotBase = this.screenToVector(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.trackballmove = function(x,y) {
var rotCurrent = this.screenToVector(x,y),
rotBase = handlers.rotBase,
dot = rotBase[0]*rotCurrent[0] +
rotBase[1]*rotCurrent[1] +
rotBase[2]*rotCurrent[2],
angle = Math.acos( dot/this.vlen(rotBase)/this.vlen(rotCurrent) )*180.0/Math.PI,
axis = this.xprod(rotBase, rotCurrent),
objects = this.scene.objects,
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
l = activeModel.par3d.listeners,
i;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(angle, axis[0], axis[1], axis[2]);
}
this.drawScene();
};
handlers.trackballend = 0;
this.clamp = function(x, lo, hi) {
return Math.max(lo, Math.min(x, hi));
};
this.screenToPolar = function(x,y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
r = Math.min(width, height)/2,
dx = this.clamp(x - width/2, -r, r),
dy = this.clamp(y - height/2, -r, r);
return [Math.asin(dx/r), Math.asin(-dy/r)];
};
handlers.polardown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.dragBase = this.screenToPolar(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
activeSub.camBase = [-Math.atan2(activeSub.saveMat.m13, activeSub.saveMat.m11),
Math.atan2(activeSub.saveMat.m32, activeSub.saveMat.m22)];
}
};
handlers.polarmove = function(x,y) {
var dragCurrent = this.screenToPolar(x,y),
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
objects = this.scene.objects,
l = activeModel.par3d.listeners,
i, changepos = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
for (j=0; j<2; j++)
changepos[j] = -(dragCurrent[j] - handlers.dragBase[j]);
activeSub.par3d.userMatrix.makeIdentity();
activeSub.par3d.userMatrix.rotate(changepos[0]*180/Math.PI, 0,-1,0);
activeSub.par3d.userMatrix.multRight(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(changepos[1]*180/Math.PI, -1,0,0);
}
this.drawScene();
};
handlers.polarend = 0;
handlers.axisdown = function(x,y) {
handlers.rotBase = this.screenToVector(x, this.canvas.height/2);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.axismove = function(x,y) {
var rotCurrent = this.screenToVector(x, this.canvas.height/2),
rotBase = handlers.rotBase,
angle = (rotCurrent[0] - rotBase[0])*180/Math.PI,
rotMat = new CanvasMatrix4();
rotMat.rotate(angle, handlers.axis[0], handlers.axis[1], handlers.axis[2]);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(activeSub.saveMat);
activeSub.par3d.userMatrix.multLeft(rotMat);
}
this.drawScene();
};
handlers.axisend = 0;
handlers.y0zoom = 0;
handlers.zoom0 = 0;
handlers.zoomdown = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
handlers.y0zoom = y;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.zoom0 = Math.log(activeSub.par3d.zoom);
}
};
handlers.zoommove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.zoom = Math.exp(activeSub.zoom0 + (y-handlers.y0zoom)/this.canvas.height);
}
this.drawScene();
};
handlers.zoomend = 0;
handlers.y0fov = 0;
handlers.fovdown = function(x, y) {
handlers.y0fov = y;
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.fov0 = activeSub.par3d.FOV;
}
};
handlers.fovmove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.FOV = Math.max(1, Math.min(179, activeSub.fov0 +
180*(y-handlers.y0fov)/this.canvas.height));
}
this.drawScene();
};
handlers.fovend = 0;
handlers.selectingdown = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height, 
p = {x: 2.0*x/width - 1.0, y: 2.0*y/height - 1.0};
this.select.region = {p1: p, p2: p};
if (this.select.subscene && this.select.subscene != activeSubscene)
this.delFromSubscene(this.scene.brushId, this.select.subscene);
this.select.subscene = activeSubscene;
this.addToSubscene(this.scene.brushId, activeSubscene);
this.select.state = "changing";
if (typeof this.scene.brushId !== "undefined")
this.getObj(this.scene.brushId).initialized = false;
this.drawScene();
};
handlers.selectingmove = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height;
if (this.select.state === "inactive") 
return;
this.select.region.p2 = {x: 2.0*x/width - 1.0, y: 2.0*y/height - 1.0};
if (typeof this.scene.brushId !== "undefined")
this.getObj(this.scene.brushId).initialized = false;
this.drawScene();
};
handlers.selectingend = 0;
this.canvas.onmousedown = function ( ev ){
if (!ev.which) // Use w3c defns in preference to MS
switch (ev.button) {
case 0: ev.which = 1; break;
case 1:
case 4: ev.which = 2; break;
case 2: ev.which = 3;
}
drag = ["left", "middle", "right"][ev.which-1];
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height-coords.y;
activeSubscene = self.whichSubscene(coords);
var sub = self.getObj(activeSubscene), f;
handler = sub.par3d.mouseMode[drag];
switch (handler) {
case "xAxis":
handler = "axis";
handlers.axis = [1.0, 0.0, 0.0];
break;
case "yAxis":
handler = "axis";
handlers.axis = [0.0, 1.0, 0.0];
break;
case "zAxis":
handler = "axis";
handlers.axis = [0.0, 0.0, 1.0];
break;
}
f = handlers[handler + "down"];
if (f) {
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
ev.preventDefault();
} else
console.warn("Mouse handler '" + handler + "' is not implemented.");
};
this.canvas.onmouseup = function ( ev ){
if ( drag === 0 ) return;
var f = handlers[handler + "end"];
if (f) {
f.call(self);
ev.preventDefault();
}
drag = 0;
};
this.canvas.onmouseout = this.canvas.onmouseup;
this.canvas.onmousemove = function ( ev ) {
if ( drag === 0 ) return;
var f = handlers[handler + "move"];
if (f) {
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height - coords.y;
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
}
};
handlers.wheelHandler = function(ev) {
var del = 1.02, i;
if (ev.shiftKey) del = 1.002;
var ds = ((ev.detail || ev.wheelDelta) > 0) ? del : (1 / del);
if (typeof activeSubscene === "undefined")
activeSubscene = self.scene.rootSubscene;
var activeSub = self.getObj(activeSubscene),
activeProjection = self.getObj(self.useid(activeSub.id, "projection")),
l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = self.getObj(l[i]);
activeSub.par3d.zoom *= ds;
}
self.drawScene();
ev.preventDefault();
};
this.canvas.addEventListener("DOMMouseScroll", handlers.wheelHandler, false);
this.canvas.addEventListener("mousewheel", handlers.wheelHandler, false);
};
/**
* Find a particular subscene by inheritance
* @returns { number } id of subscene to use
* @param { number } subsceneid - child subscene
* @param { string } type - type of inheritance:  "projection" or "model"
*/
rglwidgetClass.prototype.useid = function(subsceneid, type) {
var sub = this.getObj(subsceneid);
if (sub.embeddings[type] === "inherit")
return(this.useid(sub.parent, type));
else
return subsceneid;
};
/**
* Check whether point is in viewport of subscene
* @returns {boolean}
* @param { Object } coords - screen coordinates of point
* @param { number } subsceneid - subscene to check
*/
rglwidgetClass.prototype.inViewport = function(coords, subsceneid) {
var viewport = this.getObj(subsceneid).par3d.viewport,
x0 = coords.x - viewport.x*this.canvas.width,
y0 = coords.y - viewport.y*this.canvas.height;
return 0 <= x0 && x0 <= viewport.width*this.canvas.width &&
0 <= y0 && y0 <= viewport.height*this.canvas.height;
};
/**
* Find which subscene contains a point
* @returns { number } subscene id
* @param { Object } coords - coordinates of point
*/
rglwidgetClass.prototype.whichSubscene = function(coords) {
var self = this,
recurse = function(subsceneid) {
var subscenes = self.getChildSubscenes(subsceneid), i, id;
for (i=0; i < subscenes.length; i++) {
id = recurse(subscenes[i]);
if (typeof(id) !== "undefined")
return(id);
}
if (self.inViewport(coords, subsceneid))
return(subsceneid);
else
return undefined;
},
rootid = this.scene.rootSubscene,
result = recurse(rootid);
if (typeof(result) === "undefined")
result = rootid;
return result;
};
/**
* Translate from window coordinates to viewport coordinates
* @returns { Object } translated coordinates
* @param { number } subsceneid - which subscene to use?
* @param { Object } coords - point to translate
*/
rglwidgetClass.prototype.translateCoords = function(subsceneid, coords) {
var viewport = this.getObj(subsceneid).par3d.viewport;
return {x: coords.x - viewport.x*this.canvas.width,
y: coords.y - viewport.y*this.canvas.height};
};
/**
* Initialize the sphere object
*/
rglwidgetClass.prototype.initSphere = function() {
var verts = this.scene.sphereVerts,
reuse = verts.reuse, result;
if (typeof reuse !== "undefined") {
var prev = document.getElementById(reuse).rglinstance.sphere;
result = {values: prev.values, vOffsets: prev.vOffsets, it: prev.it};
} else
result = {values: new Float32Array(this.flatten(this.cbind(this.transpose(verts.vb),
this.transpose(verts.texcoords)))),
it: new Uint16Array(this.flatten(this.transpose(verts.it))),
vOffsets: {vofs:0, cofs:-1, nofs:-1, radofs:-1, oofs:-1,
tofs:3, nextofs:-1, pointofs:-1, stride:5}};
result.sphereCount = result.it.length;
this.sphere = result;
};
/**
* Set the vertices in the selection box object
*/
rglwidgetClass.prototype.initSelection = function(id) {
if (typeof this.select.region === "undefined")
return;
var obj = this.getObj(id),
width = this.canvas.width,
height = this.canvas.height, 
p1 = this.select.region.p1,
p2 = this.select.region.p2;
obj.vertices = [[p1.x, p1.y, 0.0],
[p2.x, p1.y, 0.0],
[p2.x, p2.y, 0.0],
[p1.x, p2.y, 0.0],
[p1.x, p1.y, 0.0]];
};
/**
* Do the gl part of initializing the sphere
*/
rglwidgetClass.prototype.initSphereGL = function() {
var gl = this.gl || this.initGL(), sphere = this.sphere;
if (gl.isContextLost()) return;
sphere.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, sphere.buf);
gl.bufferData(gl.ARRAY_BUFFER, sphere.values, gl.STATIC_DRAW);
sphere.ibuf = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphere.ibuf);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, sphere.it, gl.STATIC_DRAW);
return;
};
/**
* Initialize the DOM object
* @param { Object } el - the DOM object
* @param { Object } x - the scene data sent by JSON from R
*/
rglwidgetClass.prototype.initialize = function(el, x) {
this.textureCanvas = document.createElement("canvas");
this.textureCanvas.style.display = "block";
this.scene = x;
this.normMatrix = new CanvasMatrix4();
this.saveMat = {};
this.distance = null;
this.posLoc = 0;
this.colLoc = 1;
if (el) {
el.rglinstance = this;
this.el = el;
this.webGLoptions = el.rglinstance.scene.webGLoptions;
this.initCanvas();
}
if (typeof Shiny !== "undefined") {
var self = this;
Shiny.addCustomMessageHandler("shinyGetPar3d",
function(message) {
var i, param, 
subscene = self.getObj(message.subscene),
parameters = [].concat(message.parameters),
result = {tag: message.tag, subscene: message.subscene};
if (typeof subscene !== "undefined") {
for (i = 0; i < parameters.length; i++) {
param = parameters[i];
result[param] = subscene.par3d[param];
};
} else {
console.log("subscene "+message.subscene+" undefined.")
}
Shiny.setInputValue("par3d:shinyPar3d", result, {priority: "event"});
});
Shiny.addCustomMessageHandler("shinySetPar3d",
function(message) {
var param = message.parameter, 
subscene = self.getObj(message.subscene);
if (typeof subscene !== "undefined") {
subscene.par3d[param] = message.value;
subscene.initialized = false;
self.drawScene();
} else {
console.log("subscene "+message.subscene+" undefined.")
}
})
}
};
/**
* Restart the WebGL canvas
*/
rglwidgetClass.prototype.restartCanvas = function() {
var newcanvas = document.createElement("canvas"),
self = this;
newcanvas.width = this.el.width;
newcanvas.height = this.el.height;
newcanvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
newcanvas.addEventListener("webglcontextlost",
this.onContextLost, false);
while (this.el.firstChild) {
this.el.removeChild(this.el.firstChild);
}
this.el.appendChild(newcanvas);
this.canvas = newcanvas;
this.setMouseHandlers();
if (this.gl) 
Object.keys(this.scene.objects).forEach(function(key){
self.getObj(parseInt(key, 10)).texture = undefined; 
});
this.gl = null;
};
/**
* Initialize the WebGL canvas
*/
rglwidgetClass.prototype.initCanvas = function() {
this.restartCanvas();
var objs = this.scene.objects,
self = this;
Object.keys(objs).forEach(function(key){
var id = parseInt(key, 10),
obj = self.getObj(id);
if (typeof obj.reuse !== "undefined")
self.copyObj(id, obj.reuse);
});
Object.keys(objs).forEach(function(key){
self.initSubscene(parseInt(key, 10));
});
this.setMouseHandlers();
this.initSphere();
this.onContextRestored = function(event) {
self.initGL();
self.drawScene();
};
this.onContextLost = function(event) {
if (!self.drawing)
this.gl = null;
event.preventDefault();
};
this.initGL0();
this.lazyLoadScene = function() {
if (typeof self.slide === "undefined")
self.slide = self.getSlide();
if (self.isInBrowserViewport()) {
if (!self.gl || self.gl.isContextLost())
self.initGL();
self.drawScene();
}
};
window.addEventListener("DOMContentLoaded", this.lazyLoadScene, false);
window.addEventListener("load", this.lazyLoadScene, false);
window.addEventListener("resize", this.lazyLoadScene, false);
window.addEventListener("scroll", this.lazyLoadScene, false);
this.slide = this.getSlide();
if (this.slide) {
if (typeof this.slide.rgl === "undefined")
this.slide.rgl = [this];
else
this.slide.rgl.push(this);
if (this.scene.context.rmarkdown) 
if (this.scene.context.rmarkdown === "ioslides_presentation") {
this.slide.setAttribute("slideenter", "this.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window);})");
} else if (this.scene.context.rmarkdown === "slidy_presentation") {
// This method would also work in ioslides, but it gets triggered
// something like 5 times per slide for every slide change, so
// you'd need a quicker function than lazyLoadScene.
var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver,
observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
self.slide.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window); });});});
observer.observe(this.slide, { attributes: true, attributeFilter:["class"] });
}
}
};
/**
* Start the writeWebGL scene. This is only used by writeWebGL; rglwidget has
no debug element and does the drawing in rglwidget.js.
*/
rglwidgetClass.prototype.start = function() {
if (typeof this.prefix !== "undefined") {
this.debugelement = document.getElementById(this.prefix + "debug");
this.debug("");
}
this.drag = 0;
this.drawScene();
};
/**
* Display a debug message
* @param { string } msg - The message to display
* @param { Object } [img] - Image to insert before message
*/
rglwidgetClass.prototype.debug = function(msg, img) {
if (typeof this.debugelement !== "undefined" && this.debugelement !== null) {
this.debugelement.innerHTML = msg;
if (typeof img !== "undefined") {
this.debugelement.insertBefore(img, this.debugelement.firstChild);
}
} else if (msg !== "")
alert(msg);
};
/**
* Get the snapshot image of this scene
* @returns { Object } The img DOM element
*/
rglwidgetClass.prototype.getSnapshot = function() {
var img;
if (typeof this.scene.snapshot !== "undefined") {
img = document.createElement("img");
img.src = this.scene.snapshot;
img.alt = "Snapshot";
}
return img;
};
/**
* Initial test for WebGL
*/
rglwidgetClass.prototype.initGL0 = function() {
if (!window.WebGLRenderingContext){
alert("Your browser does not support WebGL. See http://get.webgl.org");
return;
}
};
/**
* If we are in an ioslides or slidy presentation, get the
* DOM element of the current slide
* @returns { Object }
*/
rglwidgetClass.prototype.getSlide = function() {
var result = this.el, done = false;
while (result && !done && this.scene.context.rmarkdown) {
switch(this.scene.context.rmarkdown) {
case "ioslides_presentation":
if (result.tagName === "SLIDE") return result;
break;
case "slidy_presentation":
if (result.tagName === "DIV" && result.classList.contains("slide"))
return result;
break;
default: return null;
}
result = result.parentElement;
}
return null;
};
/**
* Is this scene visible in the browser?
* @returns { boolean }
*/
rglwidgetClass.prototype.isInBrowserViewport = function() {
var rect = this.canvas.getBoundingClientRect(),
windHeight = (window.innerHeight || document.documentElement.clientHeight),
windWidth = (window.innerWidth || document.documentElement.clientWidth);
if (this.scene.context && this.scene.context.rmarkdown !== null) {
if (this.slide)
return (this.scene.context.rmarkdown === "ioslides_presentation" &&
this.slide.classList.contains("current")) ||
(this.scene.context.rmarkdown === "slidy_presentation" &&
!this.slide.classList.contains("hidden"));
}
return (
rect.top >= -windHeight &&
rect.left >= -windWidth &&
rect.bottom <= 2*windHeight &&
rect.right <= 2*windWidth);
};
/**
* Initialize WebGL
* @returns { Object } the WebGL context
*/
rglwidgetClass.prototype.initGL = function() {
var self = this;
if (this.gl) {
if (!this.drawing && this.gl.isContextLost())
this.restartCanvas();
else
return this.gl;
}
// if (!this.isInBrowserViewport()) return; Return what??? At this point we know this.gl is null.
this.canvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
this.canvas.addEventListener("webglcontextlost",
this.onContextLost, false);
this.gl = this.canvas.getContext("webgl", this.webGLoptions) ||
this.canvas.getContext("experimental-webgl", this.webGLoptions);
this.index_uint = this.gl.getExtension("OES_element_index_uint");
var save = this.startDrawing();
this.initSphereGL();
Object.keys(this.scene.objects).forEach(function(key){
self.initObj(parseInt(key, 10));
});
this.stopDrawing(save);
return this.gl;
};
/**
* Resize the display to match element
* @param { Object } el - DOM element to match
*/
rglwidgetClass.prototype.resize = function(el) {
this.canvas.width = el.width;
this.canvas.height = el.height;
};
/**
* Draw the whole scene
*/
rglwidgetClass.prototype.drawScene = function() {
var gl = this.gl || this.initGL(),
wasDrawing = this.startDrawing();
if (!wasDrawing) {
if (this.select.state !== "inactive")
this.selectionChanged();
gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LEQUAL);
gl.clearDepth(1.0);
gl.clearColor(1,1,1,1);
gl.depthMask(true); // Must be true before clearing depth buffer
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
this.drawSubscene(this.scene.rootSubscene, true);
this.drawSubscene(this.scene.rootSubscene, false);
}
this.stopDrawing(wasDrawing);
};
/**
* Change the displayed subset
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The subset control data.
*/
rglwidgetClass.prototype.subsetSetter = function(el, control) {
if (typeof control.subscenes === "undefined" ||
control.subscenes === null)
control.subscenes = this.scene.rootSubscene;
var value = Math.round(control.value),
subscenes = [].concat(control.subscenes),
fullset = [].concat(control.fullset),
i, j, entries, subsceneid,
adds = [], deletes = [],
ismissing = function(x) {
return fullset.indexOf(x) < 0;
},
tointeger = function(x) {
return parseInt(x, 10);
};
if (isNaN(value))
value = control.value = 0;
if (control.accumulate)
for (i=0; i <= value; i++)
adds = adds.concat(control.subsets[i]);
else
adds = adds.concat(control.subsets[value]);
deletes = fullset.filter(function(x) { return adds.indexOf(x) < 0; });
for (i = 0; i < subscenes.length; i++) {
subsceneid = subscenes[i];
if (typeof this.getObj(subsceneid) === "undefined")
this.alertOnce("typeof object is undefined");
for (j = 0; j < adds.length; j++)
this.addToSubscene(adds[j], subsceneid);
for (j = 0; j < deletes.length; j++)
this.delFromSubscene(deletes[j], subsceneid);
}
};
/**
* Change the requested property
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The property setter control data.
*/
rglwidgetClass.prototype.propertySetter = function(el, control)  {
var value = control.value,
values = [].concat(control.values),
svals = [].concat(control.param),
direct = values[0] === null,
entries = [].concat(control.entries),
ncol = entries.length,
nrow = values.length/ncol,
properties = this.repeatToLen(control.properties, ncol),
objids = this.repeatToLen(control.objids, ncol),
property, objid = objids[0],
obj = this.getObj(objid),
propvals, i, v1, v2, p, entry, gl, needsBinding,
newprop, newid,
getPropvals = function() {
if (property === "userMatrix")
return obj.par3d.userMatrix.getAsArray();
else if (property === "scale" || property === "FOV" || property === "zoom")
return [].concat(obj.par3d[property]);
else
return [].concat(obj[property]);
};
putPropvals = function(newvals) {
if (newvals.length == 1)
newvals = newvals[0];
if (property === "userMatrix")
obj.par3d.userMatrix.load(newvals);
else if (property === "scale" || property === "FOV" || property === "zoom")
obj.par3d[property] = newvals;
else
obj[property] = newvals;
};
if (direct && typeof value === "undefined")
return;
if (control.interp) {
values = values.slice(0, ncol).concat(values).
concat(values.slice(ncol*(nrow-1), ncol*nrow));
svals = [-Infinity].concat(svals).concat(Infinity);
for (i = 1; i < svals.length; i++) {
if (value <= svals[i]) {
if (svals[i] === Infinity)
p = 1;
else
p = (svals[i] - value)/(svals[i] - svals[i-1]);
break;
}
}
} else if (!direct) {
value = Math.round(value);
}
for (j=0; j<entries.length; j++) {
entry = entries[j];
newprop = properties[j];
newid = objids[j];
if (newprop !== property || newid != objid) {
if (typeof property !== "undefined")
putPropvals(propvals);
property = newprop;
objid = newid;
obj = this.getObj(objid);
propvals = getPropvals();
}
if (control.interp) {
v1 = values[ncol*(i-1) + j];
v2 = values[ncol*i + j];
this.setElement(propvals, entry, p*v1 + (1-p)*v2);
} else if (!direct) {
this.setElement(propvals, entry, values[ncol*value + j]);
} else {
this.setElement(propvals, entry, value[j]);
}
}
putPropvals(propvals);
needsBinding = [];
for (j=0; j < entries.length; j++) {
if (properties[j] === "values" &&
needsBinding.indexOf(objids[j]) === -1) {
needsBinding.push(objids[j]);
}
}
for (j=0; j < needsBinding.length; j++) {
gl = this.gl || this.initGL();
obj = this.getObj(needsBinding[j]);
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertices
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The vertext setter control data.
*/
rglwidgetClass.prototype.vertexSetter = function(el, control)  {
var svals = [].concat(control.param),
j, k, p, a, propvals, stride, ofs, obj, entry,
attrib,
ofss    = {x:"vofs", y:"vofs", z:"vofs",
red:"cofs", green:"cofs", blue:"cofs",
alpha:"cofs", radii:"radofs",
nx:"nofs", ny:"nofs", nz:"nofs",
ox:"oofs", oy:"oofs", oz:"oofs",
ts:"tofs", tt:"tofs"},
pos     = {x:0, y:1, z:2,
red:0, green:1, blue:2,
alpha:3,radii:0,
nx:0, ny:1, nz:2,
ox:0, oy:1, oz:2,
ts:0, tt:1},
values = control.values,
direct = values === null,
ncol,
interp = control.interp,
vertices = [].concat(control.vertices),
attributes = [].concat(control.attributes),
value = control.value, newval, aliases, alias;
ncol = Math.max(vertices.length, attributes.length);
if (!ncol)
return;
vertices = this.repeatToLen(vertices, ncol);
attributes = this.repeatToLen(attributes, ncol);
if (direct)
interp = false;
/* JSON doesn't pass Infinity */
svals[0] = -Infinity;
svals[svals.length - 1] = Infinity;
for (j = 1; j < svals.length; j++) {
if (value <= svals[j]) {
if (interp) {
if (svals[j] === Infinity)
p = 1;
else
p = (svals[j] - value)/(svals[j] - svals[j-1]);
} else {
if (svals[j] - value > value - svals[j-1])
j = j - 1;
}
break;
}
}
obj = this.getObj(control.objid);
// First, make sure color attributes vary in original
if (typeof obj.vOffsets !== "undefined") {
varies = true;
for (k = 0; k < ncol; k++) {
attrib = attributes[k];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0) {
switch(attrib) {
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(control.objid);
}
propvals = obj.values;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
for (k=0; k<ncol; k++) {
if (direct) {
newval = value;
} else if (interp) {
newval = p*values[j-1][k] + (1-p)*values[j][k];
} else {
newval = values[j][k];
}       
attrib = attributes[k];
vertex = vertices[k];
alias = aliases[vertex];
if (obj.type === "planes" || obj.type === "clipplanes") {
ofs = ["nx", "ny", "nz", "offset"].indexOf(attrib);
if (ofs >= 0) {
if (ofs < 3) {
if (obj.normals[vertex][ofs] != newval) {  // Assume no aliases here...
obj.normals[vertex][ofs] = newval;
obj.initialized = false;
}
} else {
if (obj.offsets[vertex][0] != newval) {
obj.offsets[vertex][0] = newval;
obj.initialized = false;
}
}
continue;
}
}
// Not a plane setting...
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0)
this.alertOnce("Attribute '"+attrib+"' not found in object "+control.objid);
else {
stride = obj.vOffsets.stride;
ofs = ofs + pos[attrib];
entry = vertex*stride + ofs;
propvals[entry] = newval;
if (typeof alias !== "undefined")
for (a = 0; a < alias.length; a++)
propvals[alias[a]*stride + ofs] = newval;
}
}
if (typeof obj.buf !== "undefined") {
var gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, propvals, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertex properties by age
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The age setter control data.
*/
rglwidgetClass.prototype.ageSetter = function(el, control) {
var objids = [].concat(control.objids),
nobjs = objids.length,
time = control.value,
births = [].concat(control.births),
ages = [].concat(control.ages),
steps = births.length,
j = Array(steps),
p = Array(steps),
i, k, age, j0, propvals, stride, ofs, objid, obj,
attrib, dim, varies, alias, aliases, a, d,
attribs = ["colors", "alpha", "radii", "vertices",
"normals", "origins", "texcoords",
"x", "y", "z",
"red", "green", "blue"],
ofss    = ["cofs", "cofs", "radofs", "vofs",
"nofs", "oofs", "tofs",
"vofs", "vofs", "vofs",
"cofs", "cofs", "cofs"],
dims    = [3,1,1,3,
3,2,2,
1,1,1,
1,1,1],
pos     = [0,3,0,0,
0,0,0,
0,1,2,
0,1,2];
/* Infinity doesn't make it through JSON */
ages[0] = -Infinity;
ages[ages.length-1] = Infinity;
for (i = 0; i < steps; i++) {
if (births[i] !== null) {  // NA in R becomes null
age = time - births[i];
for (j0 = 1; age > ages[j0]; j0++);
if (ages[j0] == Infinity)
p[i] = 1;
else if (ages[j0] > ages[j0-1])
p[i] = (ages[j0] - age)/(ages[j0] - ages[j0-1]);
else
p[i] = 0;
j[i] = j0;
}
}
// First, make sure color attributes vary in original
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
varies = true;
if (typeof obj.vOffsets === "undefined")
continue;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs < 0) {
switch(attribs[k]) {
case "colors":
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(objid);
}
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
if (typeof obj.vOffsets === "undefined")
continue;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
propvals = obj.values;
stride = obj.vOffsets.stride;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs >= 0) {
dim = dims[k];
ofs = ofs + pos[k];
for (i = 0; i < steps; i++) {
alias = aliases[i];
if (births[i] !== null) {
for (d=0; d < dim; d++) {
propvals[i*stride + ofs + d] = p[i]*attrib[dim*(j[i]-1) + d] + (1-p[i])*attrib[dim*j[i] + d];
if (typeof alias !== "undefined")
for (a=0; a < alias.length; a++)
propvals[alias[a]*stride + ofs + d] = propvals[i*stride + ofs + d];
}
}
}
} else
this.alertOnce("\'"+attribs[k]+"\' property not found in object "+objid);
}
}
obj.values = propvals;
if (typeof obj.buf !== "undefined") {
gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
}
};
/**
* Bridge to old style control
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The bridge control data.
*/
rglwidgetClass.prototype.oldBridge = function(el, control) {
var attrname, global = window[control.prefix + "rgl"];
if (global)
for (attrname in global)
this[attrname] = global[attrname];
window[control.prefix + "rgl"] = this;
};
/**
* Set up a player control
* @param { Object } el - The player control element
* @param { Object } control - The player data.
*/
rglwidgetClass.prototype.Player = function(el, control) {
var
self = this,
components = [].concat(control.components),
buttonLabels = [].concat(control.buttonLabels),
Tick = function() { /* "this" will be a timer */
var i,
nominal = this.value,
slider = this.Slider,
labels = this.outputLabels,
output = this.Output,
step;
if (typeof slider !== "undefined" && nominal != slider.value)
slider.value = nominal;
if (typeof output !== "undefined") {
step = Math.round((nominal - output.sliderMin)/output.sliderStep);
if (labels !== null) {
output.innerHTML = labels[step];
} else {
step = step*output.sliderStep + output.sliderMin;
output.innerHTML = step.toPrecision(output.outputPrecision);
}
}
for (i=0; i < this.actions.length; i++) {
this.actions[i].value = nominal;
}
self.applyControls(el, this.actions, false);
self.drawScene();
},
OnSliderInput = function() { /* "this" will be the slider */
this.rgltimer.value = Number(this.value);
this.rgltimer.Tick();
},
addSlider = function(min, max, step, value) {
var slider = document.createElement("input");
slider.type = "range";
slider.min = min;
slider.max = max;
slider.step = step;
slider.value = value;
slider.oninput = OnSliderInput;
slider.sliderActions = control.actions;
slider.sliderScene = this;
slider.className = "rgl-slider";
slider.id = el.id + "-slider";
el.rgltimer.Slider = slider;
slider.rgltimer = el.rgltimer;
el.appendChild(slider);
},
addLabel = function(labels, min, step, precision) {
var output = document.createElement("output");
output.sliderMin = min;
output.sliderStep = step;
output.outputPrecision = precision;
output.className = "rgl-label";
output.id = el.id + "-label";
el.rgltimer.Output = output;
el.rgltimer.outputLabels = labels;
el.appendChild(output);
},
addButton = function(which, label, active) {
var button = document.createElement("input"),
onclicks = {Reverse: function() { this.rgltimer.reverse();},
Play: function() { this.rgltimer.play();
this.value = this.rgltimer.enabled ? this.inactiveValue : this.activeValue; },
Slower: function() { this.rgltimer.slower(); },
Faster: function() { this.rgltimer.faster(); },
Reset: function() { this.rgltimer.reset(); },
Step:  function() { this.rgltimer.step(); }
};
button.rgltimer = el.rgltimer;
button.type = "button";
button.value = label;
button.activeValue = label;
button.inactiveValue = active;
if (which === "Play")
button.rgltimer.PlayButton = button;
button.onclick = onclicks[which];
button.className = "rgl-button";
button.id = el.id + "-" + which;
el.appendChild(button);
};
if (typeof control.reinit !== "undefined" && control.reinit !== null) {
control.actions.reinit = control.reinit;
}
el.rgltimer = new rgltimerClass(Tick, control.start, control.interval, control.stop,
control.step, control.value, control.rate, control.loop, control.actions);
for (var i=0; i < components.length; i++) {
switch(components[i]) {
case "Slider": addSlider(control.start, control.stop,
control.step, control.value);
break;
case "Label": addLabel(control.labels, control.start,
control.step, control.precision);
break;
default:
addButton(components[i], buttonLabels[i], control.pause);
}
}
el.rgltimer.Tick();
};
/**
* Apply all registered controls
* @param { Object } el - DOM element of the control
* @param { Object } x - List of actions to apply
* @param { boolean } [draw=true] - Whether to redraw after applying
*/
rglwidgetClass.prototype.applyControls = function(el, x, draw) {
var self = this, reinit = x.reinit, i, control, type;
for (i = 0; i < x.length; i++) {
control = x[i];
type = control.type;
self[type](el, control);
}
if (typeof reinit !== "undefined" && reinit !== null) {
reinit = [].concat(reinit);
for (i = 0; i < reinit.length; i++)
self.getObj(reinit[i]).initialized = false;
}
if (typeof draw === "undefined" || draw)
self.drawScene();
};
/**
* Handler for scene change
* @param { Object } message - What sort of scene change to do?
*/
rglwidgetClass.prototype.sceneChangeHandler = function(message) {
var self = document.getElementById(message.elementId).rglinstance,
objs = message.objects, mat = message.material,
root = message.rootSubscene,
initSubs = message.initSubscenes,
redraw = message.redrawScene,
skipRedraw = message.skipRedraw,
deletes, subs, allsubs = [], i,j;
if (typeof message.delete !== "undefined") {
deletes = [].concat(message.delete);
if (typeof message.delfromSubscenes !== "undefined")
subs = [].concat(message.delfromSubscenes);
else
subs = [];
for (i = 0; i < deletes.length; i++) {
for (j = 0; j < subs.length; j++) {
self.delFromSubscene(deletes[i], subs[j]);
}
delete self.scene.objects[deletes[i]];
}
}
if (typeof objs !== "undefined") {
Object.keys(objs).forEach(function(key){
key = parseInt(key, 10);
self.scene.objects[key] = objs[key];
self.initObj(key);
var obj = self.getObj(key),
subs = [].concat(obj.inSubscenes), k;
allsubs = allsubs.concat(subs);
for (k = 0; k < subs.length; k++)
self.addToSubscene(key, subs[k]);
});
}
if (typeof mat !== "undefined") {
self.scene.material = mat;
}
if (typeof root !== "undefined") {
self.scene.rootSubscene = root;
}
if (typeof initSubs !== "undefined")
allsubs = allsubs.concat(initSubs);
allsubs = self.unique(allsubs);
for (i = 0; i < allsubs.length; i++) {
self.initSubscene(allsubs[i]);
}
if (typeof skipRedraw !== "undefined") {
root = self.getObj(self.scene.rootSubscene);
root.par3d.skipRedraw = skipRedraw;
}
if (redraw)
self.drawScene();
};
/**
* Set mouse mode for a subscene
* @param { string } mode - name of mode
* @param { number } button - button number (1 to 3)
* @param { number } subscene - subscene id number
* @param { number } stayActive - if truthy, don't clear brush
*/
rglwidgetClass.prototype.setMouseMode = function(mode, button, subscene, stayActive) {
var sub = this.getObj(subscene),
which = ["left", "right", "middle"][button - 1];
if (!stayActive && sub.par3d.mouseMode[which] === "selecting")
this.clearBrush(null);
sub.par3d.mouseMode[which] = mode;
};
/**
* The class of an rgl timer object
* @class
*/
/**
* Construct an rgltimerClass object
* @constructor
* @param { function } Tick - action when timer fires
* @param { number } startTime - nominal start time in seconds
* @param { number } interval - seconds between updates
* @param { number } stopTime - nominal stop time in seconds
* @param { number } stepSize - nominal step size
* @param { number } value - current nominal time
* @param { number } rate - nominal units per second
* @param { string } loop - "none", "cycle" or "oscillate"
* @param { Object } actions - list of actions
*/
rgltimerClass = function(Tick, startTime, interval, stopTime, stepSize, value, rate, loop, actions) {
this.enabled = false;
this.timerId = 0;
/** nominal start time in seconds */
this.startTime = startTime;   
/** current nominal time */      
this.value = value;
/** seconds between updates */                 
this.interval = interval;
/** nominal stop time */           
this.stopTime = stopTime;
/** nominal step size */           
this.stepSize = stepSize;
/** nominal units per second */           
this.rate = rate;
/** "none", "cycle", or "oscillate" */                   
this.loop = loop;
/** real world start time */                   
this.realStart = undefined;
/** multiplier for fast-forward or reverse */         
this.multiplier = 1;                
this.actions = actions;
this.Tick = Tick;
};
/**
* Start playing timer object
*/
rgltimerClass.prototype.play = function() {
if (this.enabled) {
this.enabled = false;
window.clearInterval(this.timerId);
this.timerId = 0;
return;
}
var tick = function(self) {
var now = new Date();
self.value = self.multiplier*self.rate*(now - self.realStart)/1000 + self.startTime;
self.forceToRange();
if (typeof self.Tick !== "undefined") {
self.Tick(self.value);
}
};
this.realStart = new Date() - 1000*(this.value - this.startTime)/this.rate/this.multiplier;
this.timerId = window.setInterval(tick, 1000*this.interval, this);
this.enabled = true;
};
/**
* Force value into legal range
*/
rgltimerClass.prototype.forceToRange = function() {
if (this.value > this.stopTime + this.stepSize/2 || this.value < this.startTime - this.stepSize/2) {
if (!this.loop) {
this.reset();
} else {
var cycle = this.stopTime - this.startTime + this.stepSize,
newval = (this.value - this.startTime) % cycle + this.startTime;
if (newval < this.startTime) {
newval += cycle;
}
this.realStart += (this.value - newval)*1000/this.multiplier/this.rate;
this.value = newval;
}
}
};
/**
* Reset to start values
*/
rgltimerClass.prototype.reset = function() {
this.value = this.startTime;
this.newmultiplier(1);
if (typeof this.Tick !== "undefined") {
this.Tick(this.value);
}
if (this.enabled)
this.play();  /* really pause... */
if (typeof this.PlayButton !== "undefined")
this.PlayButton.value = "Play";
};
/**
* Increase the multiplier to play faster
*/
rgltimerClass.prototype.faster = function() {
this.newmultiplier(Math.SQRT2*this.multiplier);
};
/**
* Decrease the multiplier to play slower
*/
rgltimerClass.prototype.slower = function() {
this.newmultiplier(this.multiplier/Math.SQRT2);
};
/**
* Change sign of multiplier to reverse direction
*/
rgltimerClass.prototype.reverse = function() {
this.newmultiplier(-this.multiplier);
};
/**
* Set multiplier for play speed
* @param { number } newmult - new value
*/
rgltimerClass.prototype.newmultiplier = function(newmult) {
if (newmult != this.multiplier) {
this.realStart += 1000*(this.value - this.startTime)/this.rate*(1/this.multiplier - 1/newmult);
this.multiplier = newmult;
}
};
/**
* Take one step
*/
rgltimerClass.prototype.step = function() {
this.value += this.rate*this.multiplier;
this.forceToRange();
if (typeof this.Tick !== "undefined")
this.Tick(this.value);
};</script>
<div id="unnamed_chunk_64div" class="rglWebGL">

</div>
<script type="text/javascript">
var unnamed_chunk_64div = document.getElementById("unnamed_chunk_64div"),
unnamed_chunk_64rgl = new rglwidgetClass();
unnamed_chunk_64div.width = 673;
unnamed_chunk_64div.height = 481;
unnamed_chunk_64rgl.initialize(unnamed_chunk_64div,
{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":false,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0]},"rootSubscene":6,"objects":{"13":{"id":13,"type":"clipplanes","offsets":[[-4.484],[0],[6.964544],[7.632072],[4.600406],[4.222685]],"normals":[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],"flags":1024},"14":{"id":14,"type":"lines","material":{"lit":false},"vertices":[[4.484,-6.964544,-4.600406],[4.484,-6.964544,-4.600406],[0,7.632072,4.222685],[0,7.632072,4.222685]],"colors":[[0,0,0,1]],"centers":[[4.484,-6.964544,-4.600406],[0,7.632072,4.222685]],"ignoreExtent":false,"flags":64},"16":{"id":16,"type":"text","material":{"lit":false},"vertices":[[2.242,-9.43867,-6.09592]],"colors":[[0,0,0,1]],"texts":[["Time"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[2.242,-9.43867,-6.09592]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"17":{"id":17,"type":"text","material":{"lit":false},"vertices":[[-0.760038,0.3337643,-6.09592]],"colors":[[0,0,0,1]],"texts":[["A1"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.760038,0.3337643,-6.09592]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"18":{"id":18,"type":"text","material":{"lit":false},"vertices":[[-0.760038,-9.43867,-0.1888604]],"colors":[[0,0,0,1]],"texts":[["A2"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.760038,-9.43867,-0.1888604]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":2064},"19":{"id":19,"type":"lines","material":{"lit":false},"vertices":[[4.484,0,0],[4.458,0.06732588,0.06732588]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[4.471,0.03366294,0.03366294]],"ignoreExtent":false,"flags":64},"20":{"id":20,"type":"lines","material":{"lit":false},"vertices":[[4.484,0,0],[3.931,-0.2723477,-0.2723477]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[4.2075,-0.1361739,-0.1361739]],"ignoreExtent":false,"flags":64},"21":{"id":21,"type":"lines","material":{"lit":false},"vertices":[[4.458,0.06732588,0.06732588],[3.842,0.8621703,0.8621703]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[4.15,0.4647481,0.4647481]],"ignoreExtent":false,"flags":64},"22":{"id":22,"type":"lines","material":{"lit":false},"vertices":[[4.458,0.06732588,0.06732588],[3.403,0.9128356,0.9128356]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[3.9305,0.4900807,0.4900807]],"ignoreExtent":false,"flags":64},"23":{"id":23,"type":"lines","material":{"lit":false},"vertices":[[3.931,-0.2723477,-0.2723477],[1.938,-1.87138,-1.87138]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.9345,-1.071864,-1.071864]],"ignoreExtent":false,"flags":64},"24":{"id":24,"type":"lines","material":{"lit":false},"vertices":[[3.931,-0.2723477,-0.2723477],[2.631,-0.9524575,-0.9524575]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[3.281,-0.6124027,-0.6124027]],"ignoreExtent":false,"flags":64},"25":{"id":25,"type":"lines","material":{"lit":false},"vertices":[[3.842,0.8621703,0.8621703],[1.512,-0.008575804,-0.008575804]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.677,0.4267973,0.4267973]],"ignoreExtent":false,"flags":64},"26":{"id":26,"type":"lines","material":{"lit":false},"vertices":[[3.842,0.8621703,0.8621703],[2.128,1.061111,1.061111]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.985,0.9616407,0.9616407]],"ignoreExtent":false,"flags":64},"27":{"id":27,"type":"lines","material":{"lit":false},"vertices":[[3.403,0.9128356,0.9128356],[1.1,-0.2001293,-0.2001293]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.2515,0.3563532,0.3563532]],"ignoreExtent":false,"flags":64},"28":{"id":28,"type":"lines","material":{"lit":false},"vertices":[[3.403,0.9128356,0.9128356],[0,-0.9699219,2.678205]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.7015,-0.02854317,1.795521]],"ignoreExtent":false,"flags":64},"29":{"id":29,"type":"lines","material":{"lit":false},"vertices":[[2.631,-0.9524575,-0.9524575],[2.462,-1.197698,-1.197698]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.5465,-1.075078,-1.075078]],"ignoreExtent":false,"flags":64},"30":{"id":30,"type":"lines","material":{"lit":false},"vertices":[[2.631,-0.9524575,-0.9524575],[2.554,-0.6161885,-0.6161885]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.5925,-0.784323,-0.784323]],"ignoreExtent":false,"flags":64},"31":{"id":31,"type":"lines","material":{"lit":false},"vertices":[[2.554,-0.6161885,-0.6161885],[2.368,-0.1343982,-0.1343982]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.461,-0.3752934,-0.3752934]],"ignoreExtent":false,"flags":64},"32":{"id":32,"type":"lines","material":{"lit":false},"vertices":[[2.554,-0.6161885,-0.6161885],[2.058,0.8386074,0.8386074]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.306,0.1112095,0.1112095]],"ignoreExtent":false,"flags":64},"33":{"id":33,"type":"lines","material":{"lit":false},"vertices":[[2.462,-1.197698,-1.197698],[1.511,-1.717768,-1.717768]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.9865,-1.457733,-1.457733]],"ignoreExtent":false,"flags":64},"34":{"id":34,"type":"lines","material":{"lit":false},"vertices":[[2.462,-1.197698,-1.197698],[1.173,0.7445399,0.7445399]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.8175,-0.2265792,-0.2265792]],"ignoreExtent":false,"flags":64},"35":{"id":35,"type":"lines","material":{"lit":false},"vertices":[[2.368,-0.1343982,-0.1343982],[1.637,1.401389,1.401389]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.0025,0.6334955,0.6334955]],"ignoreExtent":false,"flags":64},"36":{"id":36,"type":"lines","material":{"lit":false},"vertices":[[2.368,-0.1343982,-0.1343982],[2.238,-0.4375933,-0.4375933]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.303,-0.2859958,-0.2859958]],"ignoreExtent":false,"flags":64},"37":{"id":37,"type":"lines","material":{"lit":false},"vertices":[[2.238,-0.4375933,-0.4375933],[0,-0.4630892,1.624106]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.119,-0.4503413,0.5932565]],"ignoreExtent":false,"flags":64},"38":{"id":38,"type":"lines","material":{"lit":false},"vertices":[[2.238,-0.4375933,-0.4375933],[0,-6.128096,-0.7453241]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.119,-3.282845,-0.5914587]],"ignoreExtent":false,"flags":64},"39":{"id":39,"type":"lines","material":{"lit":false},"vertices":[[2.128,1.061111,1.061111],[1.893,1.612922,1.612922]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[2.0105,1.337016,1.337016]],"ignoreExtent":false,"flags":64},"40":{"id":40,"type":"lines","material":{"lit":false},"vertices":[[2.128,1.061111,1.061111],[0,-6.036874,-1.752302]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.064,-2.487882,-0.3455957]],"ignoreExtent":false,"flags":64},"41":{"id":41,"type":"lines","material":{"lit":false},"vertices":[[2.058,0.8386074,0.8386074],[0,-3.069349,1.434741]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.029,-1.115371,1.136674]],"ignoreExtent":false,"flags":64},"42":{"id":42,"type":"lines","material":{"lit":false},"vertices":[[2.058,0.8386074,0.8386074],[1.504,2.030588,2.030588]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.781,1.434598,1.434598]],"ignoreExtent":false,"flags":64},"43":{"id":43,"type":"lines","material":{"lit":false},"vertices":[[1.938,-1.87138,-1.87138],[1.882,-1.833968,-1.833968]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.91,-1.852674,-1.852674]],"ignoreExtent":false,"flags":64},"44":{"id":44,"type":"lines","material":{"lit":false},"vertices":[[1.938,-1.87138,-1.87138],[0.899,-0.7078319,-0.7078319]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.4185,-1.289606,-1.289606]],"ignoreExtent":false,"flags":64},"45":{"id":45,"type":"lines","material":{"lit":false},"vertices":[[1.893,1.612922,1.612922],[0.434,2.797396,2.797396]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.1635,2.205159,2.205159]],"ignoreExtent":false,"flags":64},"46":{"id":46,"type":"lines","material":{"lit":false},"vertices":[[1.893,1.612922,1.612922],[0,-4.180447,-1.381984]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.9465,-1.283762,0.1154688]],"ignoreExtent":false,"flags":64},"47":{"id":47,"type":"lines","material":{"lit":false},"vertices":[[1.882,-1.833968,-1.833968],[1.561,-2.356188,-2.356188]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.7215,-2.095078,-2.095078]],"ignoreExtent":false,"flags":64},"48":{"id":48,"type":"lines","material":{"lit":false},"vertices":[[1.882,-1.833968,-1.833968],[0.639,-2.797206,-2.797206]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.2605,-2.315587,-2.315587]],"ignoreExtent":false,"flags":64},"49":{"id":49,"type":"lines","material":{"lit":false},"vertices":[[1.637,1.401389,1.401389],[1.542,1.250292,1.250292]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.5895,1.325841,1.325841]],"ignoreExtent":false,"flags":64},"50":{"id":50,"type":"lines","material":{"lit":false},"vertices":[[1.637,1.401389,1.401389],[0,-3.394149,-1.40914]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.8185,-0.9963799,-0.003875136]],"ignoreExtent":false,"flags":64},"51":{"id":51,"type":"lines","material":{"lit":false},"vertices":[[1.561,-2.356188,-2.356188],[1.396,-2.084321,-2.084321]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.4785,-2.220254,-2.220254]],"ignoreExtent":false,"flags":64},"52":{"id":52,"type":"lines","material":{"lit":false},"vertices":[[1.561,-2.356188,-2.356188],[0.457,-2.97367,-2.97367]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.009,-2.664929,-2.664929]],"ignoreExtent":false,"flags":64},"53":{"id":53,"type":"lines","material":{"lit":false},"vertices":[[1.542,1.250292,1.250292],[0.21,3.711988,3.711988]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.876,2.48114,2.48114]],"ignoreExtent":false,"flags":64},"54":{"id":54,"type":"lines","material":{"lit":false},"vertices":[[1.542,1.250292,1.250292],[1.235,2.092828,2.092828]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.3885,1.67156,1.67156]],"ignoreExtent":false,"flags":64},"55":{"id":55,"type":"lines","material":{"lit":false},"vertices":[[1.512,-0.008575804,-0.008575804],[0.637,0.05733287,0.05733287]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.0745,0.02437853,0.02437853]],"ignoreExtent":false,"flags":64},"56":{"id":56,"type":"lines","material":{"lit":false},"vertices":[[1.512,-0.008575804,-0.008575804],[1.308,0.8548841,0.8548841]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.41,0.4231542,0.4231542]],"ignoreExtent":false,"flags":64},"57":{"id":57,"type":"lines","material":{"lit":false},"vertices":[[1.511,-1.717768,-1.717768],[1.508,-1.645316,-1.645316]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.5095,-1.681542,-1.681542]],"ignoreExtent":false,"flags":64},"58":{"id":58,"type":"lines","material":{"lit":false},"vertices":[[1.511,-1.717768,-1.717768],[0.78,-3.319057,-3.319057]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.1455,-2.518413,-2.518413]],"ignoreExtent":false,"flags":64},"59":{"id":59,"type":"lines","material":{"lit":false},"vertices":[[1.508,-1.645316,-1.645316],[0.894,-1.918738,-1.918738]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.201,-1.782027,-1.782027]],"ignoreExtent":false,"flags":64},"60":{"id":60,"type":"lines","material":{"lit":false},"vertices":[[1.508,-1.645316,-1.645316],[0,-3.392518,-3.243161]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.754,-2.518917,-2.444239]],"ignoreExtent":false,"flags":64},"61":{"id":61,"type":"lines","material":{"lit":false},"vertices":[[1.504,2.030588,2.030588],[0,6.737484,3.152343]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.752,4.384036,2.591465]],"ignoreExtent":false,"flags":64},"62":{"id":62,"type":"lines","material":{"lit":false},"vertices":[[1.504,2.030588,2.030588],[0.999,2.937973,2.937973]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.2515,2.484281,2.484281]],"ignoreExtent":false,"flags":64},"63":{"id":63,"type":"lines","material":{"lit":false},"vertices":[[1.396,-2.084321,-2.084321],[1.294,-1.443649,-1.443649]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.345,-1.763985,-1.763985]],"ignoreExtent":false,"flags":64},"64":{"id":64,"type":"lines","material":{"lit":false},"vertices":[[1.396,-2.084321,-2.084321],[1.325,-2.082283,-2.082283]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.3605,-2.083302,-2.083302]],"ignoreExtent":false,"flags":64},"65":{"id":65,"type":"lines","material":{"lit":false},"vertices":[[1.325,-2.082283,-2.082283],[1.192,-1.916309,-1.916309]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.2585,-1.999296,-1.999296]],"ignoreExtent":false,"flags":64},"66":{"id":66,"type":"lines","material":{"lit":false},"vertices":[[1.325,-2.082283,-2.082283],[0.012,-6.220768,-3.716516]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.6685,-4.151526,-2.8994]],"ignoreExtent":false,"flags":64},"67":{"id":67,"type":"lines","material":{"lit":false},"vertices":[[1.308,0.8548841,0.8548841],[1.078,0.8598077,0.8598077]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.193,0.8573459,0.8573459]],"ignoreExtent":false,"flags":64},"68":{"id":68,"type":"lines","material":{"lit":false},"vertices":[[1.308,0.8548841,0.8548841],[0.526,0.7256889,0.7256889]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.917,0.7902865,0.7902865]],"ignoreExtent":false,"flags":64},"69":{"id":69,"type":"lines","material":{"lit":false},"vertices":[[1.294,-1.443649,-1.443649],[1.19,-1.69794,-1.69794]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.242,-1.570794,-1.570794]],"ignoreExtent":false,"flags":64},"70":{"id":70,"type":"lines","material":{"lit":false},"vertices":[[1.294,-1.443649,-1.443649],[0.325,0.2591922,0.2591922]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.8095,-0.5922284,-0.5922284]],"ignoreExtent":false,"flags":64},"71":{"id":71,"type":"lines","material":{"lit":false},"vertices":[[1.235,2.092828,2.092828],[1.134,1.538526,1.538526]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.1845,1.815677,1.815677]],"ignoreExtent":false,"flags":64},"72":{"id":72,"type":"lines","material":{"lit":false},"vertices":[[1.235,2.092828,2.092828],[1.159,1.707343,1.707343]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.197,1.900085,1.900085]],"ignoreExtent":false,"flags":64},"73":{"id":73,"type":"lines","material":{"lit":false},"vertices":[[1.192,-1.916309,-1.916309],[0,1.997195,-0.2238393]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.596,0.04044312,-1.070074]],"ignoreExtent":false,"flags":64},"74":{"id":74,"type":"lines","material":{"lit":false},"vertices":[[1.192,-1.916309,-1.916309],[0.042,-0.8425383,-1.97205]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.617,-1.379424,-1.94418]],"ignoreExtent":false,"flags":64},"75":{"id":75,"type":"lines","material":{"lit":false},"vertices":[[1.19,-1.69794,-1.69794],[0.89,-1.841651,-1.841651]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.04,-1.769796,-1.769796]],"ignoreExtent":false,"flags":64},"76":{"id":76,"type":"lines","material":{"lit":false},"vertices":[[1.19,-1.69794,-1.69794],[1.122,-1.383281,-1.383281]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.156,-1.540611,-1.540611]],"ignoreExtent":false,"flags":64},"77":{"id":77,"type":"lines","material":{"lit":false},"vertices":[[1.173,0.7445399,0.7445399],[1.098,0.7956007,0.7956007]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.1355,0.7700703,0.7700703]],"ignoreExtent":false,"flags":64},"78":{"id":78,"type":"lines","material":{"lit":false},"vertices":[[1.173,0.7445399,0.7445399],[0.895,1.26615,1.26615]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.034,1.005345,1.005345]],"ignoreExtent":false,"flags":64},"79":{"id":79,"type":"lines","material":{"lit":false},"vertices":[[1.159,1.707343,1.707343],[0,5.628205,1.510694]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.5795,3.667774,1.609019]],"ignoreExtent":false,"flags":64},"80":{"id":80,"type":"lines","material":{"lit":false},"vertices":[[1.159,1.707343,1.707343],[0.212,2.050237,2.050237]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.6855,1.87879,1.87879]],"ignoreExtent":false,"flags":64},"81":{"id":81,"type":"lines","material":{"lit":false},"vertices":[[1.134,1.538526,1.538526],[0.064,1.269937,0.6291286]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.599,1.404231,1.083827]],"ignoreExtent":false,"flags":64},"82":{"id":82,"type":"lines","material":{"lit":false},"vertices":[[1.134,1.538526,1.538526],[0,1.386949,1.574805]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.567,1.462737,1.556666]],"ignoreExtent":false,"flags":64},"83":{"id":83,"type":"lines","material":{"lit":false},"vertices":[[1.122,-1.383281,-1.383281],[0.989,-1.99114,-1.99114]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[1.0555,-1.687211,-1.687211]],"ignoreExtent":false,"flags":64},"84":{"id":84,"type":"lines","material":{"lit":false},"vertices":[[1.122,-1.383281,-1.383281],[0,0.1568151,-1.10916]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.561,-0.6132331,-1.246221]],"ignoreExtent":false,"flags":64},"85":{"id":85,"type":"lines","material":{"lit":false},"vertices":[[1.1,-0.2001293,-0.2001293],[0.811,0.06837493,0.06837493]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.9555,-0.06587718,-0.06587718]],"ignoreExtent":false,"flags":64},"86":{"id":86,"type":"lines","material":{"lit":false},"vertices":[[1.1,-0.2001293,-0.2001293],[0.173,-2.494448,-0.07345479]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.6365,-1.347288,-0.136792]],"ignoreExtent":false,"flags":64},"87":{"id":87,"type":"lines","material":{"lit":false},"vertices":[[1.098,0.7956007,0.7956007],[0,0.6843851,1.259072]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.549,0.7399929,1.027336]],"ignoreExtent":false,"flags":64},"88":{"id":88,"type":"lines","material":{"lit":false},"vertices":[[1.098,0.7956007,0.7956007],[0.755,0.333267,0.333267]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.9265,0.5644338,0.5644338]],"ignoreExtent":false,"flags":64},"89":{"id":89,"type":"lines","material":{"lit":false},"vertices":[[1.078,0.8598077,0.8598077],[0,7.632072,3.426475]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.539,4.24594,2.143141]],"ignoreExtent":false,"flags":64},"90":{"id":90,"type":"lines","material":{"lit":false},"vertices":[[1.078,0.8598077,0.8598077],[0.75,0.9594178,0.9594178]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.914,0.9096128,0.9096128]],"ignoreExtent":false,"flags":64},"91":{"id":91,"type":"lines","material":{"lit":false},"vertices":[[0.999,2.937973,2.937973],[0.448,2.340364,2.340364]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.7235,2.639169,2.639169]],"ignoreExtent":false,"flags":64},"92":{"id":92,"type":"lines","material":{"lit":false},"vertices":[[0.999,2.937973,2.937973],[0.946,2.791111,2.791111]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.9725,2.864542,2.864542]],"ignoreExtent":false,"flags":64},"93":{"id":93,"type":"lines","material":{"lit":false},"vertices":[[0.989,-1.99114,-1.99114],[0,3.019013,-0.6318336]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4945,0.5139365,-1.311487]],"ignoreExtent":false,"flags":64},"94":{"id":94,"type":"lines","material":{"lit":false},"vertices":[[0.989,-1.99114,-1.99114],[0.773,-2.295547,-2.295547]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.881,-2.143344,-2.143344]],"ignoreExtent":false,"flags":64},"95":{"id":95,"type":"lines","material":{"lit":false},"vertices":[[0.946,2.791111,2.791111],[0,1.992012,2.665175]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.473,2.391562,2.728143]],"ignoreExtent":false,"flags":64},"96":{"id":96,"type":"lines","material":{"lit":false},"vertices":[[0.946,2.791111,2.791111],[0.645,2.541789,2.541789]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.7955,2.66645,2.66645]],"ignoreExtent":false,"flags":64},"97":{"id":97,"type":"lines","material":{"lit":false},"vertices":[[0.899,-0.7078319,-0.7078319],[0.169,0.3861709,-1.196633]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.534,-0.1608305,-0.9522324]],"ignoreExtent":false,"flags":64},"98":{"id":98,"type":"lines","material":{"lit":false},"vertices":[[0.899,-0.7078319,-0.7078319],[0.436,-0.3840696,-0.3840696]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.6675,-0.5459508,-0.5459508]],"ignoreExtent":false,"flags":64},"99":{"id":99,"type":"lines","material":{"lit":false},"vertices":[[0.895,1.26615,1.26615],[0,3.711467,1.018704]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4475,2.488808,1.142426]],"ignoreExtent":false,"flags":64},"100":{"id":100,"type":"lines","material":{"lit":false},"vertices":[[0.895,1.26615,1.26615],[0,7.431925,2.816747]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4475,4.349037,2.041448]],"ignoreExtent":false,"flags":64},"101":{"id":101,"type":"lines","material":{"lit":false},"vertices":[[0.894,-1.918738,-1.918738],[0,-0.08948585,-1.335165]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.447,-1.004112,-1.626951]],"ignoreExtent":false,"flags":64},"102":{"id":102,"type":"lines","material":{"lit":false},"vertices":[[0.894,-1.918738,-1.918738],[0.452,-1.939467,-1.939467]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.673,-1.929102,-1.929102]],"ignoreExtent":false,"flags":64},"103":{"id":103,"type":"lines","material":{"lit":false},"vertices":[[0.89,-1.841651,-1.841651],[0,-1.382429,-0.7154065]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.445,-1.61204,-1.278529]],"ignoreExtent":false,"flags":64},"104":{"id":104,"type":"lines","material":{"lit":false},"vertices":[[0.89,-1.841651,-1.841651],[0,-6.616096,-3.165633]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.445,-4.228874,-2.503642]],"ignoreExtent":false,"flags":64},"105":{"id":105,"type":"lines","material":{"lit":false},"vertices":[[0.811,0.06837493,0.06837493],[0,2.092955,-1.229244]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4055,1.080665,-0.5804347]],"ignoreExtent":false,"flags":64},"106":{"id":106,"type":"lines","material":{"lit":false},"vertices":[[0.811,0.06837493,0.06837493],[0.729,-0.2095284,-0.2095284]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.77,-0.07057673,-0.07057673]],"ignoreExtent":false,"flags":64},"107":{"id":107,"type":"lines","material":{"lit":false},"vertices":[[0.78,-3.319057,-3.319057],[0.283,-4.104396,-4.104396]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.5315,-3.711727,-3.711727]],"ignoreExtent":false,"flags":64},"108":{"id":108,"type":"lines","material":{"lit":false},"vertices":[[0.78,-3.319057,-3.319057],[0.757,-3.276184,-3.276184]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.7685,-3.297621,-3.297621]],"ignoreExtent":false,"flags":64},"109":{"id":109,"type":"lines","material":{"lit":false},"vertices":[[0.773,-2.295547,-2.295547],[0,-4.091965,-3.083482]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3865,-3.193756,-2.689515]],"ignoreExtent":false,"flags":64},"110":{"id":110,"type":"lines","material":{"lit":false},"vertices":[[0.773,-2.295547,-2.295547],[0.122,-0.4290352,-2.712379]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4475,-1.362291,-2.503963]],"ignoreExtent":false,"flags":64},"111":{"id":111,"type":"lines","material":{"lit":false},"vertices":[[0.757,-3.276184,-3.276184],[0.723,-3.165977,-3.165977]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.74,-3.22108,-3.22108]],"ignoreExtent":false,"flags":64},"112":{"id":112,"type":"lines","material":{"lit":false},"vertices":[[0.757,-3.276184,-3.276184],[0.706,-3.161741,-3.161741]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.7315,-3.218962,-3.218962]],"ignoreExtent":false,"flags":64},"113":{"id":113,"type":"lines","material":{"lit":false},"vertices":[[0.755,0.333267,0.333267],[0,0.4666821,0.2715151]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3775,0.3999745,0.3023911]],"ignoreExtent":false,"flags":64},"114":{"id":114,"type":"lines","material":{"lit":false},"vertices":[[0.755,0.333267,0.333267],[0,0.847694,1.122447]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3775,0.5904805,0.7278571]],"ignoreExtent":false,"flags":64},"115":{"id":115,"type":"lines","material":{"lit":false},"vertices":[[0.75,0.9594178,0.9594178],[0.267,0.8524064,0.8524064]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.5085,0.9059122,0.9059122]],"ignoreExtent":false,"flags":64},"116":{"id":116,"type":"lines","material":{"lit":false},"vertices":[[0.75,0.9594178,0.9594178],[0.446,0.7360907,0.7360907]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.598,0.8477542,0.8477542]],"ignoreExtent":false,"flags":64},"117":{"id":117,"type":"lines","material":{"lit":false},"vertices":[[0.729,-0.2095284,-0.2095284],[0.142,3.586318,1.23347]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4355,1.688395,0.5119706]],"ignoreExtent":false,"flags":64},"118":{"id":118,"type":"lines","material":{"lit":false},"vertices":[[0.729,-0.2095284,-0.2095284],[0.626,0.09955726,0.09955726]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.6775,-0.05498557,-0.05498557]],"ignoreExtent":false,"flags":64},"119":{"id":119,"type":"lines","material":{"lit":false},"vertices":[[0.723,-3.165977,-3.165977],[0,-5.553791,-4.403836]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3615,-4.359884,-3.784906]],"ignoreExtent":false,"flags":64},"120":{"id":120,"type":"lines","material":{"lit":false},"vertices":[[0.723,-3.165977,-3.165977],[0,-4.372218,-3.505356]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3615,-3.769097,-3.335666]],"ignoreExtent":false,"flags":64},"121":{"id":121,"type":"lines","material":{"lit":false},"vertices":[[0.706,-3.161741,-3.161741],[0,-6.964544,-3.2255]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.353,-5.063142,-3.19362]],"ignoreExtent":false,"flags":64},"122":{"id":122,"type":"lines","material":{"lit":false},"vertices":[[0.706,-3.161741,-3.161741],[0.552,-3.404307,-3.404307]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.6289999,-3.283024,-3.283024]],"ignoreExtent":false,"flags":64},"123":{"id":123,"type":"lines","material":{"lit":false},"vertices":[[0.645,2.541789,2.541789],[0,-1.017487,0.1293504]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3225,0.7621511,1.33557]],"ignoreExtent":false,"flags":64},"124":{"id":124,"type":"lines","material":{"lit":false},"vertices":[[0.645,2.541789,2.541789],[0.115,3.24755,4.222685]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.38,2.894669,3.382237]],"ignoreExtent":false,"flags":64},"125":{"id":125,"type":"lines","material":{"lit":false},"vertices":[[0.639,-2.797206,-2.797206],[0.303,-2.793622,-2.793622]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.471,-2.795414,-2.795414]],"ignoreExtent":false,"flags":64},"126":{"id":126,"type":"lines","material":{"lit":false},"vertices":[[0.639,-2.797206,-2.797206],[0,-6.019743,-2.754724]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3195,-4.408474,-2.775965]],"ignoreExtent":false,"flags":64},"127":{"id":127,"type":"lines","material":{"lit":false},"vertices":[[0.637,0.05733287,0.05733287],[0.167,-0.2362641,-0.320477]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.402,-0.08946563,-0.1315721]],"ignoreExtent":false,"flags":64},"128":{"id":128,"type":"lines","material":{"lit":false},"vertices":[[0.637,0.05733287,0.05733287],[0,-2.603672,0.2701023]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3185,-1.27317,0.1637176]],"ignoreExtent":false,"flags":64},"129":{"id":129,"type":"lines","material":{"lit":false},"vertices":[[0.626,0.09955726,0.09955726],[0,-0.7888075,0.4698165]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.313,-0.3446251,0.2846869]],"ignoreExtent":false,"flags":64},"130":{"id":130,"type":"lines","material":{"lit":false},"vertices":[[0.626,0.09955726,0.09955726],[0.168,0.2287071,1.527385]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.397,0.1641322,0.813471]],"ignoreExtent":false,"flags":64},"131":{"id":131,"type":"lines","material":{"lit":false},"vertices":[[0.552,-3.404307,-3.404307],[0.417,-3.234668,-3.234668]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4845,-3.319488,-3.319488]],"ignoreExtent":false,"flags":64},"132":{"id":132,"type":"lines","material":{"lit":false},"vertices":[[0.552,-3.404307,-3.404307],[0,-2.665156,-2.683425]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.276,-3.034731,-3.043866]],"ignoreExtent":false,"flags":64},"133":{"id":133,"type":"lines","material":{"lit":false},"vertices":[[0.526,0.7256889,0.7256889],[0.163,1.141642,1.066973]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3445,0.9336653,0.8963307]],"ignoreExtent":false,"flags":64},"134":{"id":134,"type":"lines","material":{"lit":false},"vertices":[[0.526,0.7256889,0.7256889],[0.419,0.1106157,0.1106157]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.4725,0.4181523,0.4181523]],"ignoreExtent":false,"flags":64},"135":{"id":135,"type":"lines","material":{"lit":false},"vertices":[[0.457,-2.97367,-2.97367],[0,2.080518,-0.9232759]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.2285,-0.4465762,-1.948473]],"ignoreExtent":false,"flags":64},"136":{"id":136,"type":"lines","material":{"lit":false},"vertices":[[0.457,-2.97367,-2.97367],[0,-0.6638213,-2.301628]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.2285,-1.818746,-2.637649]],"ignoreExtent":false,"flags":64},"137":{"id":137,"type":"lines","material":{"lit":false},"vertices":[[0.452,-1.939467,-1.939467],[0.22,-2.091398,-2.091398]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.336,-2.015432,-2.015432]],"ignoreExtent":false,"flags":64},"138":{"id":138,"type":"lines","material":{"lit":false},"vertices":[[0.452,-1.939467,-1.939467],[0,-0.06393337,-1.258641]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.226,-1.0017,-1.599054]],"ignoreExtent":false,"flags":64},"139":{"id":139,"type":"lines","material":{"lit":false},"vertices":[[0.448,2.340364,2.340364],[0,-1.274799,1.984674]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.224,0.5327825,2.162519]],"ignoreExtent":false,"flags":64},"140":{"id":140,"type":"lines","material":{"lit":false},"vertices":[[0.448,2.340364,2.340364],[0,5.855287,3.463085]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.224,4.097826,2.901725]],"ignoreExtent":false,"flags":64},"141":{"id":141,"type":"lines","material":{"lit":false},"vertices":[[0.446,0.7360907,0.7360907],[0.317,0.8260692,0.8260692]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3815,0.7810799,0.7810799]],"ignoreExtent":false,"flags":64},"142":{"id":142,"type":"lines","material":{"lit":false},"vertices":[[0.446,0.7360907,0.7360907],[0,2.527509,2.002785]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.223,1.6318,1.369438]],"ignoreExtent":false,"flags":64},"143":{"id":143,"type":"lines","material":{"lit":false},"vertices":[[0.436,-0.3840696,-0.3840696],[0,-2.155257,-1.084868]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.218,-1.269664,-0.7344689]],"ignoreExtent":false,"flags":64},"144":{"id":144,"type":"lines","material":{"lit":false},"vertices":[[0.436,-0.3840696,-0.3840696],[0.311,-0.3379384,-0.3379384]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3735,-0.361004,-0.361004]],"ignoreExtent":false,"flags":64},"145":{"id":145,"type":"lines","material":{"lit":false},"vertices":[[0.434,2.797396,2.797396],[0,-0.1134788,2.57974]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.217,1.341959,2.688568]],"ignoreExtent":false,"flags":64},"146":{"id":146,"type":"lines","material":{"lit":false},"vertices":[[0.434,2.797396,2.797396],[0,1.978263,2.542421]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.217,2.38783,2.669909]],"ignoreExtent":false,"flags":64},"147":{"id":147,"type":"lines","material":{"lit":false},"vertices":[[0.419,0.1106157,0.1106157],[0,2.476912,1.537724]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.2095,1.293764,0.82417]],"ignoreExtent":false,"flags":64},"148":{"id":148,"type":"lines","material":{"lit":false},"vertices":[[0.419,0.1106157,0.1106157],[0,0.5402639,0.1567734]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.2095,0.3254398,0.1336945]],"ignoreExtent":false,"flags":64},"149":{"id":149,"type":"lines","material":{"lit":false},"vertices":[[0.417,-3.234668,-3.234668],[0,-2.173754,-3.30185]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.2085,-2.704211,-3.268259]],"ignoreExtent":false,"flags":64},"150":{"id":150,"type":"lines","material":{"lit":false},"vertices":[[0.417,-3.234668,-3.234668],[0,-1.889396,-2.388861]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.2085,-2.562032,-2.811765]],"ignoreExtent":false,"flags":64},"151":{"id":151,"type":"lines","material":{"lit":false},"vertices":[[0.325,0.2591922,0.2591922],[0,0.09569731,-0.5430373]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1625,0.1774448,-0.1419225]],"ignoreExtent":false,"flags":64},"152":{"id":152,"type":"lines","material":{"lit":false},"vertices":[[0.325,0.2591922,0.2591922],[0,1.85441,0.06237597]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1625,1.056801,0.1607841]],"ignoreExtent":false,"flags":64},"153":{"id":153,"type":"lines","material":{"lit":false},"vertices":[[0.317,0.8260692,0.8260692],[0,3.116333,0.7164729]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1585,1.971201,0.771271]],"ignoreExtent":false,"flags":64},"154":{"id":154,"type":"lines","material":{"lit":false},"vertices":[[0.317,0.8260692,0.8260692],[0.314,0.8383839,0.8383839]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.3155,0.8322265,0.8322265]],"ignoreExtent":false,"flags":64},"155":{"id":155,"type":"lines","material":{"lit":false},"vertices":[[0.314,0.8383839,0.8383839],[0,3.512025,1.645867]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.157,2.175204,1.242125]],"ignoreExtent":false,"flags":64},"156":{"id":156,"type":"lines","material":{"lit":false},"vertices":[[0.314,0.8383839,0.8383839],[0,3.967651,0.5961429]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.157,2.403017,0.7172635]],"ignoreExtent":false,"flags":64},"157":{"id":157,"type":"lines","material":{"lit":false},"vertices":[[0.311,-0.3379384,-0.3379384],[0,-0.7776927,-0.7459488]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1555,-0.5578156,-0.5419436]],"ignoreExtent":false,"flags":64},"158":{"id":158,"type":"lines","material":{"lit":false},"vertices":[[0.311,-0.3379384,-0.3379384],[0.177,-0.1595342,-0.7960141]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.244,-0.2487363,-0.5669762]],"ignoreExtent":false,"flags":64},"159":{"id":159,"type":"lines","material":{"lit":false},"vertices":[[0.303,-2.793622,-2.793622],[0,-5.830169,-4.174438]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1515,-4.311895,-3.48403]],"ignoreExtent":false,"flags":64},"160":{"id":160,"type":"lines","material":{"lit":false},"vertices":[[0.303,-2.793622,-2.793622],[0,-2.631323,-3.209786]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1515,-2.712472,-3.001704]],"ignoreExtent":false,"flags":64},"161":{"id":161,"type":"lines","material":{"lit":false},"vertices":[[0.283,-4.104396,-4.104396],[0,-4.218099,-4.600406]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1415,-4.161248,-4.352401]],"ignoreExtent":false,"flags":64},"162":{"id":162,"type":"lines","material":{"lit":false},"vertices":[[0.283,-4.104396,-4.104396],[0,-4.763776,-4.404142]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1415,-4.434086,-4.254269]],"ignoreExtent":false,"flags":64},"163":{"id":163,"type":"lines","material":{"lit":false},"vertices":[[0.267,0.8524064,0.8524064],[0,1.135742,0.5643399]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1335,0.9940742,0.7083732]],"ignoreExtent":false,"flags":64},"164":{"id":164,"type":"lines","material":{"lit":false},"vertices":[[0.267,0.8524064,0.8524064],[0,-0.8324489,0.2640152]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1335,0.009978771,0.5582108]],"ignoreExtent":false,"flags":64},"165":{"id":165,"type":"lines","material":{"lit":false},"vertices":[[0.22,-2.091398,-2.091398],[0.194,-2.693003,-2.311611]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.207,-2.3922,-2.201504]],"ignoreExtent":false,"flags":64},"166":{"id":166,"type":"lines","material":{"lit":false},"vertices":[[0.22,-2.091398,-2.091398],[0,-4.670316,-2.976828]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.11,-3.380857,-2.534113]],"ignoreExtent":false,"flags":64},"167":{"id":167,"type":"lines","material":{"lit":false},"vertices":[[0.212,2.050237,2.050237],[0,4.992931,3.211205]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.106,3.521584,2.630721]],"ignoreExtent":false,"flags":64},"168":{"id":168,"type":"lines","material":{"lit":false},"vertices":[[0.212,2.050237,2.050237],[0,-0.2375324,0.7287571]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.106,0.9063523,1.389497]],"ignoreExtent":false,"flags":64},"169":{"id":169,"type":"lines","material":{"lit":false},"vertices":[[0.21,3.711988,3.711988],[0.082,4.169683,3.002969]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.146,3.940836,3.357479]],"ignoreExtent":false,"flags":64},"170":{"id":170,"type":"lines","material":{"lit":false},"vertices":[[0.21,3.711988,3.711988],[0,3.788133,3.986586]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.105,3.750061,3.849287]],"ignoreExtent":false,"flags":64},"171":{"id":171,"type":"lines","material":{"lit":false},"vertices":[[0.194,-2.693003,-2.311611],[0,-4.852428,-2.87995]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.097,-3.772715,-2.59578]],"ignoreExtent":false,"flags":64},"172":{"id":172,"type":"lines","material":{"lit":false},"vertices":[[0.194,-2.693003,-2.311611],[0,-4.337624,-3.162556]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.097,-3.515313,-2.737083]],"ignoreExtent":false,"flags":64},"173":{"id":173,"type":"lines","material":{"lit":false},"vertices":[[0.177,-0.1595342,-0.7960141],[0,-0.2898784,-0.8111697]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0885,-0.2247063,-0.8035919]],"ignoreExtent":false,"flags":64},"174":{"id":174,"type":"lines","material":{"lit":false},"vertices":[[0.177,-0.1595342,-0.7960141],[0,1.176449,-1.116921]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0885,0.5084574,-0.9564675]],"ignoreExtent":false,"flags":64},"175":{"id":175,"type":"lines","material":{"lit":false},"vertices":[[0.173,-2.494448,-0.07345479],[0.029,-3.618098,-0.362283]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.101,-3.056273,-0.2178689]],"ignoreExtent":false,"flags":64},"176":{"id":176,"type":"lines","material":{"lit":false},"vertices":[[0.173,-2.494448,-0.07345479],[0.043,-2.550095,-0.08115068]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.108,-2.522271,-0.07730274]],"ignoreExtent":false,"flags":64},"177":{"id":177,"type":"lines","material":{"lit":false},"vertices":[[0.169,0.3861709,-1.196633],[0,1.711371,-1.000445]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0845,1.048771,-1.098539]],"ignoreExtent":false,"flags":64},"178":{"id":178,"type":"lines","material":{"lit":false},"vertices":[[0.169,0.3861709,-1.196633],[0.033,-0.5636025,-1.120925]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.101,-0.08871582,-1.158779]],"ignoreExtent":false,"flags":64},"179":{"id":179,"type":"lines","material":{"lit":false},"vertices":[[0.168,0.2287071,1.527385],[0.123,0.9150881,1.569237]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.1455,0.5718976,1.548311]],"ignoreExtent":false,"flags":64},"180":{"id":180,"type":"lines","material":{"lit":false},"vertices":[[0.168,0.2287071,1.527385],[0.104,-1.061356,1.226164]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.136,-0.4163243,1.376774]],"ignoreExtent":false,"flags":64},"181":{"id":181,"type":"lines","material":{"lit":false},"vertices":[[0.167,-0.2362641,-0.320477],[0.155,-0.3377357,-0.361003]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.161,-0.2869999,-0.34074]],"ignoreExtent":false,"flags":64},"182":{"id":182,"type":"lines","material":{"lit":false},"vertices":[[0.167,-0.2362641,-0.320477],[0.063,-0.5351093,-0.392952]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.115,-0.3856867,-0.3567145]],"ignoreExtent":false,"flags":64},"183":{"id":183,"type":"lines","material":{"lit":false},"vertices":[[0.163,1.141642,1.066973],[0,1.573269,1.677388]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0815,1.357455,1.37218]],"ignoreExtent":false,"flags":64},"184":{"id":184,"type":"lines","material":{"lit":false},"vertices":[[0.163,1.141642,1.066973],[0.079,1.62072,1.311051]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.121,1.381181,1.189012]],"ignoreExtent":false,"flags":64},"185":{"id":185,"type":"lines","material":{"lit":false},"vertices":[[0.155,-0.3377357,-0.361003],[0,1.487661,-0.6489011]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0775,0.5749628,-0.5049521]],"ignoreExtent":false,"flags":64},"186":{"id":186,"type":"lines","material":{"lit":false},"vertices":[[0.155,-0.3377357,-0.361003],[0,-0.6928352,-0.7025682]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0775,-0.5152854,-0.5317856]],"ignoreExtent":false,"flags":64},"187":{"id":187,"type":"lines","material":{"lit":false},"vertices":[[0.142,3.586318,1.23347],[0,2.618243,0.3453549]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.071,3.102281,0.7894123]],"ignoreExtent":false,"flags":64},"188":{"id":188,"type":"lines","material":{"lit":false},"vertices":[[0.142,3.586318,1.23347],[0,3.877725,1.017132]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.071,3.732022,1.125301]],"ignoreExtent":false,"flags":64},"189":{"id":189,"type":"lines","material":{"lit":false},"vertices":[[0.123,0.9150881,1.569237],[0,1.829094,1.13098]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0615,1.372091,1.350108]],"ignoreExtent":false,"flags":64},"190":{"id":190,"type":"lines","material":{"lit":false},"vertices":[[0.123,0.9150881,1.569237],[0,-0.7013294,0.9695206]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0615,0.1068794,1.269379]],"ignoreExtent":false,"flags":64},"191":{"id":191,"type":"lines","material":{"lit":false},"vertices":[[0.122,-0.4290352,-2.712379],[0,-1.328925,-2.731004]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.061,-0.8789803,-2.721692]],"ignoreExtent":false,"flags":64},"192":{"id":192,"type":"lines","material":{"lit":false},"vertices":[[0.122,-0.4290352,-2.712379],[0,-2.183966,-2.799024]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.061,-1.3065,-2.755702]],"ignoreExtent":false,"flags":64},"193":{"id":193,"type":"lines","material":{"lit":false},"vertices":[[0.115,3.24755,4.222685],[0,4.703793,4.192995]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0575,3.975671,4.20784]],"ignoreExtent":false,"flags":64},"194":{"id":194,"type":"lines","material":{"lit":false},"vertices":[[0.115,3.24755,4.222685],[0,0.5227233,2.81664]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0575,1.885136,3.519663]],"ignoreExtent":false,"flags":64},"195":{"id":195,"type":"lines","material":{"lit":false},"vertices":[[0.104,-1.061356,1.226164],[0,-2.208764,0.9361843]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.052,-1.63506,1.081174]],"ignoreExtent":false,"flags":64},"196":{"id":196,"type":"lines","material":{"lit":false},"vertices":[[0.104,-1.061356,1.226164],[0,-2.158579,0.6152171]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.052,-1.609967,0.9206905]],"ignoreExtent":false,"flags":64},"197":{"id":197,"type":"lines","material":{"lit":false},"vertices":[[0.082,4.169683,3.002969],[0,4.105128,3.002519]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.041,4.137406,3.002744]],"ignoreExtent":false,"flags":64},"198":{"id":198,"type":"lines","material":{"lit":false},"vertices":[[0.082,4.169683,3.002969],[0,2.988943,2.952293]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.041,3.579313,2.977631]],"ignoreExtent":false,"flags":64},"199":{"id":199,"type":"lines","material":{"lit":false},"vertices":[[0.079,1.62072,1.311051],[0,0.6865098,0.9845443]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0395,1.153615,1.147798]],"ignoreExtent":false,"flags":64},"200":{"id":200,"type":"lines","material":{"lit":false},"vertices":[[0.079,1.62072,1.311051],[0,1.027481,0.7169932]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0395,1.3241,1.014022]],"ignoreExtent":false,"flags":64},"201":{"id":201,"type":"lines","material":{"lit":false},"vertices":[[0.064,1.269937,0.6291286],[0,1.759057,0.6231423]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.032,1.514497,0.6261355]],"ignoreExtent":false,"flags":64},"202":{"id":202,"type":"lines","material":{"lit":false},"vertices":[[0.064,1.269937,0.6291286],[0,1.596252,0.5122174]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.032,1.433094,0.570673]],"ignoreExtent":false,"flags":64},"203":{"id":203,"type":"lines","material":{"lit":false},"vertices":[[0.063,-0.5351093,-0.392952],[0,-0.5743418,-0.3200433]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0315,-0.5547255,-0.3564976]],"ignoreExtent":false,"flags":64},"204":{"id":204,"type":"lines","material":{"lit":false},"vertices":[[0.063,-0.5351093,-0.392952],[0,0.1370534,-0.08135985]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0315,-0.1990279,-0.2371559]],"ignoreExtent":false,"flags":64},"205":{"id":205,"type":"lines","material":{"lit":false},"vertices":[[0.043,-2.550095,-0.08115068],[0,-2.449131,-0.3611342]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0215,-2.499613,-0.2211424]],"ignoreExtent":false,"flags":64},"206":{"id":206,"type":"lines","material":{"lit":false},"vertices":[[0.043,-2.550095,-0.08115068],[0,-2.024778,-0.01461924]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0215,-2.287436,-0.04788496]],"ignoreExtent":false,"flags":64},"207":{"id":207,"type":"lines","material":{"lit":false},"vertices":[[0.042,-0.8425383,-1.97205],[0,-0.2929833,-1.764894]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.021,-0.5677608,-1.868472]],"ignoreExtent":false,"flags":64},"208":{"id":208,"type":"lines","material":{"lit":false},"vertices":[[0.042,-0.8425383,-1.97205],[0,-1.076568,-1.696464]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.021,-0.9595529,-1.834257]],"ignoreExtent":false,"flags":64},"209":{"id":209,"type":"lines","material":{"lit":false},"vertices":[[0.033,-0.5636025,-1.120925],[0,-1.021917,-1.244395]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0165,-0.7927595,-1.18266]],"ignoreExtent":false,"flags":64},"210":{"id":210,"type":"lines","material":{"lit":false},"vertices":[[0.033,-0.5636025,-1.120925],[0,-0.3024203,-0.5641401]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0165,-0.4330114,-0.8425323]],"ignoreExtent":false,"flags":64},"211":{"id":211,"type":"lines","material":{"lit":false},"vertices":[[0.029,-3.618098,-0.362283],[0,-2.83958,0.08890121]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0145,-3.228839,-0.1366909]],"ignoreExtent":false,"flags":64},"212":{"id":212,"type":"lines","material":{"lit":false},"vertices":[[0.029,-3.618098,-0.362283],[0,-3.02781,-0.1450533]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.0145,-3.322954,-0.2536681]],"ignoreExtent":false,"flags":64},"213":{"id":213,"type":"lines","material":{"lit":false},"vertices":[[0.012,-6.220768,-3.716516],[0,-5.931702,-3.543741]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.006,-6.076235,-3.630128]],"ignoreExtent":false,"flags":64},"214":{"id":214,"type":"lines","material":{"lit":false},"vertices":[[0.012,-6.220768,-3.716516],[0,-6.598486,-3.95359]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0.006,-6.409627,-3.835053]],"ignoreExtent":false,"flags":64},"215":{"id":215,"type":"lines","material":{"lit":false},"vertices":[[0,-0.3024203,-0.5641401],[0,-0.3017627,-0.5707092]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0,-0.3020915,-0.5674247]],"ignoreExtent":false,"flags":64},"216":{"id":216,"type":"lines","material":{"lit":false},"vertices":[[0,-0.3024203,-0.5641401],[0,-0.3141389,-0.5641704]],"colors":[[0.7450981,0.7450981,0.7450981,1]],"centers":[[0,-0.3082796,-0.5641552]],"ignoreExtent":false,"flags":64},"217":{"id":217,"type":"points","material":{"lit":false},"vertices":[[4.484,0,0],[4.458,0.06732588,0.06732588],[3.931,-0.2723477,-0.2723477],[3.842,0.8621703,0.8621703],[3.403,0.9128356,0.9128356],[1.938,-1.87138,-1.87138],[2.631,-0.9524575,-0.9524575],[1.512,-0.008575804,-0.008575804],[2.128,1.061111,1.061111],[1.1,-0.2001293,-0.2001293],[0,-0.9699219,2.678205],[2.462,-1.197698,-1.197698],[2.554,-0.6161885,-0.6161885],[2.368,-0.1343982,-0.1343982],[2.058,0.8386074,0.8386074],[1.511,-1.717768,-1.717768],[1.173,0.7445399,0.7445399],[1.637,1.401389,1.401389],[2.238,-0.4375933,-0.4375933],[0,-0.4630892,1.624106],[0,-6.128096,-0.7453241],[1.893,1.612922,1.612922],[0,-6.036874,-1.752302],[0,-3.069349,1.434741],[1.504,2.030588,2.030588],[1.882,-1.833968,-1.833968],[0.899,-0.7078319,-0.7078319],[0.434,2.797396,2.797396],[0,-4.180447,-1.381984],[1.561,-2.356188,-2.356188],[0.639,-2.797206,-2.797206],[1.542,1.250292,1.250292],[0,-3.394149,-1.40914],[1.396,-2.084321,-2.084321],[0.457,-2.97367,-2.97367],[0.21,3.711988,3.711988],[1.235,2.092828,2.092828],[0.637,0.05733287,0.05733287],[1.308,0.8548841,0.8548841],[1.508,-1.645316,-1.645316],[0.78,-3.319057,-3.319057],[0.894,-1.918738,-1.918738],[0,-3.392518,-3.243161],[0,6.737484,3.152343],[0.999,2.937973,2.937973],[1.294,-1.443649,-1.443649],[1.325,-2.082283,-2.082283],[1.192,-1.916309,-1.916309],[0.012,-6.220768,-3.716516],[1.078,0.8598077,0.8598077],[0.526,0.7256889,0.7256889],[1.19,-1.69794,-1.69794],[0.325,0.2591922,0.2591922],[1.134,1.538526,1.538526],[1.159,1.707343,1.707343],[0,1.997195,-0.2238393],[0.042,-0.8425383,-1.97205],[0.89,-1.841651,-1.841651],[1.122,-1.383281,-1.383281],[1.098,0.7956007,0.7956007],[0.895,1.26615,1.26615],[0,5.628205,1.510694],[0.212,2.050237,2.050237],[0.064,1.269937,0.6291286],[0,1.386949,1.574805],[0.989,-1.99114,-1.99114],[0,0.1568151,-1.10916],[0.811,0.06837493,0.06837493],[0.173,-2.494448,-0.07345479],[0,0.6843851,1.259072],[0.755,0.333267,0.333267],[0,7.632072,3.426475],[0.75,0.9594178,0.9594178],[0.448,2.340364,2.340364],[0.946,2.791111,2.791111],[0,3.019013,-0.6318336],[0.773,-2.295547,-2.295547],[0,1.992012,2.665175],[0.645,2.541789,2.541789],[0.169,0.3861709,-1.196633],[0.436,-0.3840696,-0.3840696],[0,3.711467,1.018704],[0,7.431925,2.816747],[0,-0.08948585,-1.335165],[0.452,-1.939467,-1.939467],[0,-1.382429,-0.7154065],[0,-6.616096,-3.165633],[0,2.092955,-1.229244],[0.729,-0.2095284,-0.2095284],[0.283,-4.104396,-4.104396],[0.757,-3.276184,-3.276184],[0,-4.091965,-3.083482],[0.122,-0.4290352,-2.712379],[0.723,-3.165977,-3.165977],[0.706,-3.161741,-3.161741],[0,0.4666821,0.2715151],[0,0.847694,1.122447],[0.267,0.8524064,0.8524064],[0.446,0.7360907,0.7360907],[0.142,3.586318,1.23347],[0.626,0.09955726,0.09955726],[0,-5.553791,-4.403836],[0,-4.372218,-3.505356],[0,-6.964544,-3.2255],[0.552,-3.404307,-3.404307],[0,-1.017487,0.1293504],[0.115,3.24755,4.222685],[0.303,-2.793622,-2.793622],[0,-6.019743,-2.754724],[0.167,-0.2362641,-0.320477],[0,-2.603672,0.2701023],[0,-0.7888075,0.4698165],[0.168,0.2287071,1.527385],[0.417,-3.234668,-3.234668],[0,-2.665156,-2.683425],[0.163,1.141642,1.066973],[0.419,0.1106157,0.1106157],[0,2.080518,-0.9232759],[0,-0.6638213,-2.301628],[0.22,-2.091398,-2.091398],[0,-0.06393337,-1.258641],[0,-1.274799,1.984674],[0,5.855287,3.463085],[0.317,0.8260692,0.8260692],[0,2.527509,2.002785],[0,-2.155257,-1.084868],[0.311,-0.3379384,-0.3379384],[0,-0.1134788,2.57974],[0,1.978263,2.542421],[0,2.476912,1.537724],[0,0.5402639,0.1567734],[0,-2.173754,-3.30185],[0,-1.889396,-2.388861],[0,0.09569731,-0.5430373],[0,1.85441,0.06237597],[0,3.116333,0.7164729],[0.314,0.8383839,0.8383839],[0,3.512025,1.645867],[0,3.967651,0.5961429],[0,-0.7776927,-0.7459488],[0.177,-0.1595342,-0.7960141],[0,-5.830169,-4.174438],[0,-2.631323,-3.209786],[0,-4.218099,-4.600406],[0,-4.763776,-4.404142],[0,1.135742,0.5643399],[0,-0.8324489,0.2640152],[0.194,-2.693003,-2.311611],[0,-4.670316,-2.976828],[0,4.992931,3.211205],[0,-0.2375324,0.7287571],[0.082,4.169683,3.002969],[0,3.788133,3.986586],[0,-4.852428,-2.87995],[0,-4.337624,-3.162556],[0,-0.2898784,-0.8111697],[0,1.176449,-1.116921],[0.029,-3.618098,-0.362283],[0.043,-2.550095,-0.08115068],[0,1.711371,-1.000445],[0.033,-0.5636025,-1.120925],[0.123,0.9150881,1.569237],[0.104,-1.061356,1.226164],[0.155,-0.3377357,-0.361003],[0.063,-0.5351093,-0.392952],[0,1.573269,1.677388],[0.079,1.62072,1.311051],[0,1.487661,-0.6489011],[0,-0.6928352,-0.7025682],[0,2.618243,0.3453549],[0,3.877725,1.017132],[0,1.829094,1.13098],[0,-0.7013294,0.9695206],[0,-1.328925,-2.731004],[0,-2.183966,-2.799024],[0,4.703793,4.192995],[0,0.5227233,2.81664],[0,-2.208764,0.9361843],[0,-2.158579,0.6152171],[0,4.105128,3.002519],[0,2.988943,2.952293],[0,0.6865098,0.9845443],[0,1.027481,0.7169932],[0,1.759057,0.6231423],[0,1.596252,0.5122174],[0,-0.5743418,-0.3200433],[0,0.1370534,-0.08135985],[0,-2.449131,-0.3611342],[0,-2.024778,-0.01461924],[0,-0.2929833,-1.764894],[0,-1.076568,-1.696464],[0,-1.021917,-1.244395],[0,-0.3024203,-0.5641401],[0,-2.83958,0.08890121],[0,-3.02781,-0.1450533],[0,-5.931702,-3.543741],[0,-6.598486,-3.95359],[0,-0.3017627,-0.5707092],[0,-0.3141389,-0.5641704]],"colors":[[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[1,0.6470588,0,1],[0,0,1,1],[1,0.6470588,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1]],"centers":[[4.484,0,0],[4.458,0.06732588,0.06732588],[3.931,-0.2723477,-0.2723477],[3.842,0.8621703,0.8621703],[3.403,0.9128356,0.9128356],[1.938,-1.87138,-1.87138],[2.631,-0.9524575,-0.9524575],[1.512,-0.008575804,-0.008575804],[2.128,1.061111,1.061111],[1.1,-0.2001293,-0.2001293],[0,-0.9699219,2.678205],[2.462,-1.197698,-1.197698],[2.554,-0.6161885,-0.6161885],[2.368,-0.1343982,-0.1343982],[2.058,0.8386074,0.8386074],[1.511,-1.717768,-1.717768],[1.173,0.7445399,0.7445399],[1.637,1.401389,1.401389],[2.238,-0.4375933,-0.4375933],[0,-0.4630892,1.624106],[0,-6.128096,-0.7453241],[1.893,1.612922,1.612922],[0,-6.036874,-1.752302],[0,-3.069349,1.434741],[1.504,2.030588,2.030588],[1.882,-1.833968,-1.833968],[0.899,-0.7078319,-0.7078319],[0.434,2.797396,2.797396],[0,-4.180447,-1.381984],[1.561,-2.356188,-2.356188],[0.639,-2.797206,-2.797206],[1.542,1.250292,1.250292],[0,-3.394149,-1.40914],[1.396,-2.084321,-2.084321],[0.457,-2.97367,-2.97367],[0.21,3.711988,3.711988],[1.235,2.092828,2.092828],[0.637,0.05733287,0.05733287],[1.308,0.8548841,0.8548841],[1.508,-1.645316,-1.645316],[0.78,-3.319057,-3.319057],[0.894,-1.918738,-1.918738],[0,-3.392518,-3.243161],[0,6.737484,3.152343],[0.999,2.937973,2.937973],[1.294,-1.443649,-1.443649],[1.325,-2.082283,-2.082283],[1.192,-1.916309,-1.916309],[0.012,-6.220768,-3.716516],[1.078,0.8598077,0.8598077],[0.526,0.7256889,0.7256889],[1.19,-1.69794,-1.69794],[0.325,0.2591922,0.2591922],[1.134,1.538526,1.538526],[1.159,1.707343,1.707343],[0,1.997195,-0.2238393],[0.042,-0.8425383,-1.97205],[0.89,-1.841651,-1.841651],[1.122,-1.383281,-1.383281],[1.098,0.7956007,0.7956007],[0.895,1.26615,1.26615],[0,5.628205,1.510694],[0.212,2.050237,2.050237],[0.064,1.269937,0.6291286],[0,1.386949,1.574805],[0.989,-1.99114,-1.99114],[0,0.1568151,-1.10916],[0.811,0.06837493,0.06837493],[0.173,-2.494448,-0.07345479],[0,0.6843851,1.259072],[0.755,0.333267,0.333267],[0,7.632072,3.426475],[0.75,0.9594178,0.9594178],[0.448,2.340364,2.340364],[0.946,2.791111,2.791111],[0,3.019013,-0.6318336],[0.773,-2.295547,-2.295547],[0,1.992012,2.665175],[0.645,2.541789,2.541789],[0.169,0.3861709,-1.196633],[0.436,-0.3840696,-0.3840696],[0,3.711467,1.018704],[0,7.431925,2.816747],[0,-0.08948585,-1.335165],[0.452,-1.939467,-1.939467],[0,-1.382429,-0.7154065],[0,-6.616096,-3.165633],[0,2.092955,-1.229244],[0.729,-0.2095284,-0.2095284],[0.283,-4.104396,-4.104396],[0.757,-3.276184,-3.276184],[0,-4.091965,-3.083482],[0.122,-0.4290352,-2.712379],[0.723,-3.165977,-3.165977],[0.706,-3.161741,-3.161741],[0,0.4666821,0.2715151],[0,0.847694,1.122447],[0.267,0.8524064,0.8524064],[0.446,0.7360907,0.7360907],[0.142,3.586318,1.23347],[0.626,0.09955726,0.09955726],[0,-5.553791,-4.403836],[0,-4.372218,-3.505356],[0,-6.964544,-3.2255],[0.552,-3.404307,-3.404307],[0,-1.017487,0.1293504],[0.115,3.24755,4.222685],[0.303,-2.793622,-2.793622],[0,-6.019743,-2.754724],[0.167,-0.2362641,-0.320477],[0,-2.603672,0.2701023],[0,-0.7888075,0.4698165],[0.168,0.2287071,1.527385],[0.417,-3.234668,-3.234668],[0,-2.665156,-2.683425],[0.163,1.141642,1.066973],[0.419,0.1106157,0.1106157],[0,2.080518,-0.9232759],[0,-0.6638213,-2.301628],[0.22,-2.091398,-2.091398],[0,-0.06393337,-1.258641],[0,-1.274799,1.984674],[0,5.855287,3.463085],[0.317,0.8260692,0.8260692],[0,2.527509,2.002785],[0,-2.155257,-1.084868],[0.311,-0.3379384,-0.3379384],[0,-0.1134788,2.57974],[0,1.978263,2.542421],[0,2.476912,1.537724],[0,0.5402639,0.1567734],[0,-2.173754,-3.30185],[0,-1.889396,-2.388861],[0,0.09569731,-0.5430373],[0,1.85441,0.06237597],[0,3.116333,0.7164729],[0.314,0.8383839,0.8383839],[0,3.512025,1.645867],[0,3.967651,0.5961429],[0,-0.7776927,-0.7459488],[0.177,-0.1595342,-0.7960141],[0,-5.830169,-4.174438],[0,-2.631323,-3.209786],[0,-4.218099,-4.600406],[0,-4.763776,-4.404142],[0,1.135742,0.5643399],[0,-0.8324489,0.2640152],[0.194,-2.693003,-2.311611],[0,-4.670316,-2.976828],[0,4.992931,3.211205],[0,-0.2375324,0.7287571],[0.082,4.169683,3.002969],[0,3.788133,3.986586],[0,-4.852428,-2.87995],[0,-4.337624,-3.162556],[0,-0.2898784,-0.8111697],[0,1.176449,-1.116921],[0.029,-3.618098,-0.362283],[0.043,-2.550095,-0.08115068],[0,1.711371,-1.000445],[0.033,-0.5636025,-1.120925],[0.123,0.9150881,1.569237],[0.104,-1.061356,1.226164],[0.155,-0.3377357,-0.361003],[0.063,-0.5351093,-0.392952],[0,1.573269,1.677388],[0.079,1.62072,1.311051],[0,1.487661,-0.6489011],[0,-0.6928352,-0.7025682],[0,2.618243,0.3453549],[0,3.877725,1.017132],[0,1.829094,1.13098],[0,-0.7013294,0.9695206],[0,-1.328925,-2.731004],[0,-2.183966,-2.799024],[0,4.703793,4.192995],[0,0.5227233,2.81664],[0,-2.208764,0.9361843],[0,-2.158579,0.6152171],[0,4.105128,3.002519],[0,2.988943,2.952293],[0,0.6865098,0.9845443],[0,1.027481,0.7169932],[0,1.759057,0.6231423],[0,1.596252,0.5122174],[0,-0.5743418,-0.3200433],[0,0.1370534,-0.08135985],[0,-2.449131,-0.3611342],[0,-2.024778,-0.01461924],[0,-0.2929833,-1.764894],[0,-1.076568,-1.696464],[0,-1.021917,-1.244395],[0,-0.3024203,-0.5641401],[0,-2.83958,0.08890121],[0,-3.02781,-0.1450533],[0,-5.931702,-3.543741],[0,-6.598486,-3.95359],[0,-0.3017627,-0.5707092],[0,-0.3141389,-0.5641704]],"ignoreExtent":false,"flags":4096},"10":{"id":10,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"9":{"id":9,"type":"background","material":{"fog":true},"colors":[[0.2980392,0.2980392,0.2980392,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"11":{"id":11,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"15":{"id":15,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":[[0,"NA","NA"],[1,"NA","NA"],[2,"NA","NA"],[3,"NA","NA"],[4,"NA","NA"],["NA",-5,"NA"],["NA",0,"NA"],["NA",5,"NA"],["NA","NA",-4],["NA","NA",-2],["NA","NA",0],["NA","NA",2],["NA","NA",4]],"colors":[[0,0,0,1]],"draw_front":true,"newIds":[226,227,228,229,230,231,232,233]},"12":{"id":12,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":6,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,43.15453],"modelMatrix":[[2.270722,0,0,-5.090959],[0,0.2385773,1.084413,0.125174],[0,-0.6554857,0.394694,-42.86121],[0,0,0,1]],"projMatrix":[[2.665751,0,0,0],[0,3.732051,0,0],[0,0,-3.863703,-155.5671],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201,0.9396926,0],[0,-0.9396926,0.3420201,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[2.270722,0.6975533,1.154008],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[3.402823e+38,-3.402823e+38,3.402823e+38,-3.402823e+38,3.402823e+38,-3.402823e+38],"windowRect":[20,65,692,545],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rgl/fonts/FreeSans.ttf","maxClipPlanes":6,"glVersion":2.1,"activeSubscene":0},"embeddings":{"viewport":"inherit","projection":"inherit","model":"inherit","mouse":"inherit"},"objects":[13,10],"parent":6,"subscenes":[],"flags":1536},"6":{"id":6,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":6,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,43.15453],"modelMatrix":[[2.270722,0,0,-5.090959],[0,0.2385773,1.084413,0.125174],[0,-0.6554857,0.394694,-42.86121],[0,0,0,1]],"projMatrix":[[2.665751,0,0,0],[0,3.732051,0,0],[0,0,-3.863703,-155.5671],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201,0.9396926,0],[0,-0.9396926,0.3420201,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[2.270722,0.6975533,1.154008],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[0,4.484,-6.964544,7.632072,-4.600406,4.222685],"windowRect":[20,65,692,545],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rgl/fonts/FreeSans.ttf","maxClipPlanes":6,"glVersion":2.1,"activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[11,15,14,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,10,12,226,227,228,229,230,231,232,233],"subscenes":12,"flags":7760},"226":{"id":226,"type":"lines","material":{"lit":false},"vertices":[[0,-7.183493,-4.732752],[4,-7.183493,-4.732752],[0,-7.183493,-4.732752],[0,-7.559356,-4.959947],[1,-7.183493,-4.732752],[1,-7.559356,-4.959947],[2,-7.183493,-4.732752],[2,-7.559356,-4.959947],[3,-7.183493,-4.732752],[3,-7.559356,-4.959947],[4,-7.183493,-4.732752],[4,-7.559356,-4.959947]],"colors":[[0,0,0,1]],"centers":[[2,-7.183493,-4.732752],[0,-7.371425,-4.84635],[1,-7.371425,-4.84635],[2,-7.371425,-4.84635],[3,-7.371425,-4.84635],[4,-7.371425,-4.84635]],"ignoreExtent":true,"origId":15,"flags":64},"227":{"id":227,"type":"text","material":{"lit":false},"vertices":[[0,-8.311082,-5.414336],[1,-8.311082,-5.414336],[2,-8.311082,-5.414336],[3,-8.311082,-5.414336],[4,-8.311082,-5.414336]],"colors":[[0,0,0,1]],"texts":[["0"],["1"],["2"],["3"],["4"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-8.311082,-5.414336],[1,-8.311082,-5.414336],[2,-8.311082,-5.414336],[3,-8.311082,-5.414336],[4,-8.311082,-5.414336]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":15,"flags":2064},"228":{"id":228,"type":"lines","material":{"lit":false},"vertices":[[-0.015,-5,-4.732752],[-0.015,5,-4.732752],[-0.015,-5,-4.732752],[-0.04075,-5,-4.959947],[-0.015,0,-4.732752],[-0.04075,0,-4.959947],[-0.015,5,-4.732752],[-0.04075,5,-4.959947]],"colors":[[0,0,0,1]],"centers":[[-0.015,0,-4.732752],[-0.027875,-5,-4.84635],[-0.027875,0,-4.84635],[-0.027875,5,-4.84635]],"ignoreExtent":true,"origId":15,"flags":64},"229":{"id":229,"type":"text","material":{"lit":false},"vertices":[[-0.09225,-5,-5.414336],[-0.09225,0,-5.414336],[-0.09225,5,-5.414336]],"colors":[[0,0,0,1]],"texts":[["-5"],["0"],["5"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.09225,-5,-5.414336],[-0.09225,0,-5.414336],[-0.09225,5,-5.414336]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":15,"flags":2064},"230":{"id":230,"type":"lines","material":{"lit":false},"vertices":[[-0.015,-7.183493,-4],[-0.015,-7.183493,4],[-0.015,-7.183493,-4],[-0.04075,-7.559356,-4],[-0.015,-7.183493,-2],[-0.04075,-7.559356,-2],[-0.015,-7.183493,0],[-0.04075,-7.559356,0],[-0.015,-7.183493,2],[-0.04075,-7.559356,2],[-0.015,-7.183493,4],[-0.04075,-7.559356,4]],"colors":[[0,0,0,1]],"centers":[[-0.015,-7.183493,0],[-0.027875,-7.371425,-4],[-0.027875,-7.371425,-2],[-0.027875,-7.371425,0],[-0.027875,-7.371425,2],[-0.027875,-7.371425,4]],"ignoreExtent":true,"origId":15,"flags":64},"231":{"id":231,"type":"text","material":{"lit":false},"vertices":[[-0.09225,-8.311082,-4],[-0.09225,-8.311082,-2],[-0.09225,-8.311082,0],[-0.09225,-8.311082,2],[-0.09225,-8.311082,4]],"colors":[[0,0,0,1]],"texts":[["-4"],["-2"],["0"],["2"],["4"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.09225,-8.311082,-4],[-0.09225,-8.311082,-2],[-0.09225,-8.311082,0],[-0.09225,-8.311082,2],[-0.09225,-8.311082,4]],"family":[["sans"]],"font":[[1]],"ignoreExtent":true,"origId":15,"flags":2064},"232":{"id":232,"type":"lines","material":{"lit":false},"vertices":[[0,-6.964544,-4.600406],[0,-6.964544,-4.600406],[1,7.632072,4.222685],[1,7.632072,4.222685]],"colors":[[0,0,0,1]],"centers":[[0,-6.964544,-4.600406],[1,7.632072,4.222685]],"ignoreExtent":false,"origId":15,"flags":64},"233":{"id":233,"type":"lines","material":{"lit":false},"vertices":[[-0.015,-7.183493,-4.732752],[-0.015,7.851022,-4.732752],[-0.015,-7.183493,4.355031],[-0.015,7.851022,4.355031],[-0.015,-7.183493,-4.732752],[-0.015,-7.183493,4.355031],[-0.015,7.851022,-4.732752],[-0.015,7.851022,4.355031],[-0.015,-7.183493,-4.732752],[1.015,-7.183493,-4.732752],[-0.015,-7.183493,4.355031],[1.015,-7.183493,4.355031],[-0.015,7.851022,-4.732752],[1.015,7.851022,-4.732752],[-0.015,7.851022,4.355031],[1.015,7.851022,4.355031],[1.015,-7.183493,-4.732752],[1.015,7.851022,-4.732752],[1.015,-7.183493,4.355031],[1.015,7.851022,4.355031],[1.015,-7.183493,-4.732752],[1.015,-7.183493,4.355031],[1.015,7.851022,-4.732752],[1.015,7.851022,4.355031]],"colors":[[0,0,0,1]],"centers":[[-0.015,0.3337643,-4.732752],[-0.015,0.3337643,4.355031],[-0.015,-7.183493,-0.1888604],[-0.015,7.851022,-0.1888604],[0.5,-7.183493,-4.732752],[0.5,-7.183493,4.355031],[0.5,7.851022,-4.732752],[0.5,7.851022,4.355031],[1.015,0.3337643,-4.732752],[1.015,0.3337643,4.355031],[1.015,-7.183493,-0.1888604],[1.015,7.851022,-0.1888604]],"ignoreExtent":true,"origId":15,"flags":64}},"snapshot":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAHgCAIAAAD17khjAAAAHXRFWHRTb2Z0d2FyZQBSL1JHTCBwYWNrYWdlL2xpYnBuZ7GveO8AACAASURBVHic7b0PbFzllf89TkpDgxqitpRRs6JukKISoowqrVqrKYuXAlbVVm7fdt9IS7v2S6s1v9/yU1Syyqjdaj28aTfdRQxUXXVW22zMqmQcYOsk8MZJY5JhiRoHUuySYDtVyDhAxZguqUVxGFSSzHvunPHx4/tv7ty5/+b6+9HIjO/M3LnjDPdzz/Oc55xEBQAAAACxIxH2AQAAAADAeyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBg9bm5MmTv/jFL6ampsI9jN/+9rfj4+MhHsDly5efe+65oaGh48ePv/fee6Ecw7vvvvvf//3fdAwvvvhiKAeggw5jdHQ07KMAIDQgeNCqzM3Nff7zn29ra1u1alUikbjnnnuuXLkS1sF88Ytf3Lp1a1jvfu7cufXr19MfYfXq1fQHWbdu3ZkzZwI+BrqwSCaT9O7XXnstHclf/uVfXrx4MeBjUCmVStddd91dd90V4jEAEC4QPGhVtm3bRmp/4YUX6P6ePXtIKvl8PuBjoIuMY8eObdmyhd49RMF3dnauXbt2YmKC7p89e5bup1KpIA/g8uXLdFVx6623vvnmm/Qr/U1WrFjR398f5DGo0KXeHXfcQf8oEDxYykDwoCW5dOnSRz7ykXQ6LVturxLwYQwODn64yrJly8IS/B/+8Acy2a5du2TLzp07acurr74a2DG8/PLL9I5Hjx6VLZ///OdJsYEdgI4HHniArnI2btwIwYOlDAQPWpIzZ86QUQ4dOiRbtm/fTgF9WMdz4403hiX4119/va+vjwJ32fLoo4/SH2dmZiawY7hw4cLevXv/+Mc/ypYNGzaEJdcXXnhh5cqVo6OjmzZtguDBUgaCBy3JyMgIOYwHpZlHHnmEtrz11luhHE+IgtdBriW5kttCeXeS6z/90z/dfvvtH/vYx9R/ncCYm5tbt24dXe3RfQgeLHEgeNCSPPnkk6TzYrEoW3gansLZUI4nIoIfHBxcs2bN2rVrz58/H8oB0GVWKpW65pprbr31VvVfJzDuvvvuW2655dKlSxUIHix5IHjQkhw+fJh0rq6O27VrF22hAC6U4wld8C+//HJnZ+eKFSvuu+++t99+O8QjqVTTAj7zmc8EnOhHDA0NrV69+pVXXuFfIXiwxIHgQUsyMTFBOn/66adlyw9+8AMKHMM6nnAFf+LEiWuvvfYLX/hCWIE7XV6o+RDEv/3bv9E/kDorHwD0T9DW1rZ8HjoA/nX//v1BHgYAEQGCBy3J5cuXr7vuuvvvv1+2dHV13XnnnWEdT4iCv3Llyk033UShaohlAH7+85+TTf/nf/5HtvzLv/zLsmXL3n333SAP48yZMwcVbr755ttuu43uvPHGG0EeBgARAYIHrQoJ9frrr3/ttdfo/i9/+UuK1R5//PGwDiZEwVP4TnL97ne/+7PFvPPOO4Edw4ULFz7wgQ/8zd/8DRe3+e1vf/vxj3/8S1/6UmAHYAqG6MESB4IHrQq5pLOzc+XKlevWraNg8d577w3xYEIU/MDAQMKMUqkU5GE88cQTq1atuvrqq7me3Wc/+9mwEh4FCB4scSB40MJcuXJldHR0cHAwIsXPlzh/+MMfDh069Nhjj42NjYV9LAAACB4AAACIIxA8AAAAEEMgeAAAACCGQPAAAABADIHgAQAAgBgCwQMAAAAxBIIHLU+hCo5heno6k8mEewwEjgGAiADBg5YnUyXcYxgYGOjt7Q33GEjw7e3t4R4DkUiEf1ahvwP9NcI+CgBCJvz/FQFokigInsL3zs7OcI8BghcgeAAqEDyIAVGIniF4IQqCj8IxABA6+N8AtDwQPBMFwUfhGCoQPABV8L8BaHlI8KHLFYKPzjFUIHgAquB/A9DyREGuUTiGKMg1CsdQgeABqIL/DUDLEwW5RuEYoiDXKBxDBYIHoAr+NwAtD+SKY4jaMQAQBSB40PJE4YSOY8AxABA1IHjQ8kThhI5jwDEAEDUgeNDyROGEjmPAMQAQNSB40PJE4YSOY4jOMUQhJwOAKADBgxZmYGCA69QmEolMqPT29pLYcAwxOwb6goX9HQfAPRA8aFXo5Bu610G8oS9Y6E0CAXANBA9alc7OTjr/oqcI8An6atEXLPQZBwBcA8GDloTL06JpGPAPziegr5l/A/Uvvvji6OioTzsHAIIHLQmdeQuFAv8M+1hAPGHB89fMj/2XSqXrrrvurrvu8mPnAFQgeNCKSHcZ+gnBA5+QbHw/gvgrV67ccccdiUQCggf+AcGD1kMCdwge+IcI3o8g/oEHHli7du3GjRsheOAfEDxoMdTu7xA88A+1DbG3QfwLL7ywcuXK0dHRTZs2QfDAPyB40GKo8+5keqxUBj5BXy1OsuN0TrlvJJPJON/t3NzcunXrtm/fTvcheOArEDxoJdTwvQLBAz/hCL4wD92n71vBjIaWctx999233HLLpUuXKhA88BkIHrQSusIjEDzwD93VpCdVeIeGhlavXv3KK6/wrxA88BUIHrQMmWoVUr5PIRPduNxYuEcF4or6fWN6qzSzz61bt7a1tS2fhy5Y+df9+/c3d7AAmADBg5ZB6tZR0J5IaLf29gEIHviE8fKx+SD+zJkzBxVuvvnm2267je688cYbzR0sACZA8KA1UMMpOseS3bu6SmR8CB74hOn4UPNBvAqG6IGvQPCgNVDLznd2VpLJcjY7lkrNeni2BUDFNMODg3ivCiRD8MBXIHjQAujCJjq7kuM3by7n8/n0vZsrM4XwDg3EFqsUTm+DeAD8A4IHLYBV17jZM3sruxPabaQz8IMCMcdK8N4G8QD4BwQPog6dZy0n2ve1l/ck6aY5fm460MMCccdmEaYxwR6ACALBg0jDPbktHx7pnDyQLu7v0QQPgKfYFEKWRnOBHhAADYLTIog0xvC9uvy9wpHV9EuF3APp0uG+yWdyoRweiDH2nQ50ZXAAiCAQPIgupuE7r5GjG51d6fybz+dzOS2jvq+vhKJ2wEPsY3QE8SD6QPAguhhbeFH4znavVrnRTrJHjx6l+8lkOZ8/3tFRDulIQQypm0mntpsDIIJA8CCiUGxkDN95gRwLnkL2sbGxXC5H91OpWTJ9Oj0ZyqGCWFJX8AjiQcSB4EFEserATadc2pzJVMrl8vEquVyZHJ/NjpHjZ2dnAz9SEE+crIVDEA+iDAQPoghFRU6Kfk9OTmazQ+T4YrFIaifB0/0ADg8sBeyWb8yDIB5EGQgeRBGr8F2FTqr5/PFkskw3dvzYmBbE051AjhHEHCeCryCIBxEGggeRw2H43ttbIZ2nUrN0Hs7lyuR1LYIfyZPsy091oO4NaBKHgqcg3n5BHQBhAcGDyOEkfCdGR0vp9CS3nOGza/nNKU3wI/nJA+nKKNYoA/fUqbC0GATxIJpA8CBaOD9XUsiey012dQ2OjY3VwqeZQnlPsri/R8u2e+EhPw8TxJxGW78jiAcRBIIH0cL5iXJycrJUKnV0HMznj1MQz/Xuys+nK7sTxSP9yLYDzdCo4B3OKwEQJBA8iBANDXVqc+1lbYFcV5c2Vs9nV7I+T8bzHR+PFcQaEnajo+4I4kHUgOBBhGjoFEkWr1Qr1yaTZV4gxyvj6SfZHRn1oBlcCB5BPIgaEDyICg2F76VSiSxe0a4Jetvbp3O5yaPz0EY2PT0HjgfucCH4iuP8UACCAYIHUaGhgiGcYVctW5uhV01NaUYn5XNtOwniEccDd7hrFocgHkQKCB5EgkYXGpG/u7pK823lptVStRS4k9dZ9hzE069wPGgI191gEcSD6ADBg0jQaL1PkncyqXWJleZy5HtyeW1BfLksqXYSyqNMPXCOa8E3mn4PgH9A8CB8XJxMuUss/UwmpxKJAreL1TWbofsybs9hPRwPHOJa8BUE8SAyQPAgfBoN3znDbnq6Qs7esmVLb2+ms7PCgqctumdy5h1tlxx7j48exJFMFXevRRAPIgIED0KGTqONhkrFYpFT6OlOT08Pn4jZ4rogXtLpuRsNHA8c0ozgK1qjhN5mXg6AJ0DwIGQSiUTdrts6uIZdpSr4bDZLZ1KO6cncPO+uPll96Pg8cDywp0nBI4gHUQCCB2HiInyvzNewq1Rn2fP5fO/XOyl2Z+XzjLv6ZI7a6ZmcbSeO9+ojgFhCX8sm59F7q3h0OAC4AYIHYeIifK9UR+MpOqJbOl0u/EdPZXdCq29TbR/HkbpuURxn2NFDfB1QaywLxwNrmhc8B/Euvt4AeAUED0LDXYhDhlZXxw3+cMfxkXxxv6Z5eYJVEC8P8Ra2viefBcSM5gVfQRAPwgaCB6HhLnwnSafTkyL44SeGSfCa3ffVpjw5UtetiOMgnu7IYD6vlefkOw8+DIgXnix1QxAPwgWCB+HgOriZnJwcHS11dmpD9Dt2aKvgxnOpykhnZaYgz+EV8OqrxPpqIr3Uw0EoD3R41RoOQTwIEQgehADFNO7C94qSYSe1a3Rr3yvzOjem0/MzZZUdP5Pu85Q8QnkgeCV4DuLRRhaEAgQPQqCZVcKcYUdBEduaI3Lj03i6XReXq0G8jOHL1QDn2DcWys9NV84NuPsgIMp4OLSuFsW7fPnyc889NzQ0RN+09957z5P9A2AFBA+ChsN3d69VM+x4hpTT5o3P5O264F6G7nWJeOz4YpUGQvnRXm3un26jGIONGx4KXoL4c+fOrV+/nr78q1evbmtrW7du3ZkzZzx5CwBMgeBB0HR2droO39UMO94HnT2z2axpkXkee9c9JPl3uhZz4ni+4ySULz/VUdzfUxrqkgR+EBu8TY7jIJ6++WvXrp2YmKAtZ8+epfupVMqrtwDACE5MIFAojnEdvleqzu7r07rESpUwFjwnxuuQ6nXqRgnijWVr1fT7uqH8QpX7Q9nikX7XnwhEE9c5IqbQrm644Qba565du2Tjzp07acurr77q1bsAoAOCB4HS5OojVrLuxNvT02NlYq5Ov/Do3HTlVEYLu+cr3eoS8VTHyzo6XSiv5eWdHJ48kJ58Jlf61Y7yRA795uNHM5ehpjz88MMf+9jHKHCXLY8++ii9y8zMjLdvBIAAwYPgaDJ8r1Qz7IwbU6mUMZGeIVVzEF+TNE+Z705wzG26Yl4X2XPuvfib7lDIzjsp70ny2jwZ3m/mo4FIQV/UjAOcX63q0ukvXLiwYcOGTZs2+XT8AFQgeBAkTYbvss5NRzKZtKk7yxnyWr+Z8wcp7NZ8P5KnOxzEG1fMVwyO5zr2XMFeG5M/NkSOpz1omj+VkZfA8XHCc8FXqjPx9L8A3RkcHFyzZs3atWvPnz/v1wcAAIIHgcHJ805Omlak0+m+vj7jdgqMenp66FHTV23ZsqVHIf1/J/u+0UV3aFf8ErmjexVt171Wt5/M/5XI/K9O3eFZHQZoIXp7e+lL5cduyesdHR0rVqy477773n777bD/pwQxB4IHAcHhSzPnRyt90nWD6UO0RXxMT+DO8fIQb9HRV4V3pb6c7/NDdIfEb3OQplchoLVo8mLUlG9/+9vLli3buHEjAncQDBA8CAgZn3SN1dI1CrZyuZw6PC6D6ly+hhfEc3cZ/lXG2znPzrS5HCfhy2tl/zyqbzUaLz3rmvmkIFz86OZ+5cqVm266ae3atc2XuAfAIRA8CIhCodCk4Mm1mYxW30aXRc9T+5wux3nvRxXY63SHRa6ql+fmK/NWZm2Xq3CNerkU0B2JJNibrr83zd0DLUTz31UjJ06cSCQSN9xww9///d//TOGdd97x9o0AECB4EBBNnjTVGnYUXHFbdy2nfWwsn8+LzknYHJSz1+XlvF23Lk4tc8v59rNPpEqH+0TtHKYbV9OpLzcN5eH4lsYPwdM1aMIMDPYA/4DgQUA0Oey5d+9sT09RusTmcpMieJaxrKAzrVEjifG6sFuC+Mq5AW1pezU3fvKZHF8ryDP5vYxHZdNzFo5vXfwQPIPusSBIIHgQEM0Ink62ona+ySg6ybWvr4/CIzY3z7Kb7oSnxnXr4kT8xRMD2pT8/h5t8du5ATE375abztnMu/N8v7EkTsPda0AEUNvDeAsED4IEggcB4VrwhYLe7rSbbLZWN75S7U3HgrcvLitq1yXB8dy8lo53KDv7RKqyb+Egaf+8+J73bLPS3SqUh+NbEQgexAMIHgSHuzJ2dD7UCV5ayTHpdDqbzS4qSWuB2i6Wk+lY3ixmTf/VynRGWPM8N2/zLqahPBzfcvgneM8r4AJgA75tIDhcn90oiKfzLd0kghdIt/l8ns7IVnXuVOg5kyeHK+cGZPKebc2dY+qmO6nJ9jbPMYbyPHgAx7cKmWpRGj/2DMGDIMG3DQRH8+OT9GqJ3Vm3BFcRMS06q2e+g/vsEynV6Cx4hwlxHJHLmjqr5/CxqTXt4fhWgb9RfuwZggdBgm8bCA4PJyDVKJlPx+qaN0v2tRf392hNYnYn2Li8eWweh+/O76UunTd9ji6Uh+NbBZ8E70f9HABsgOBBcKjdtFwjwbFskdOxVeUZYfKZXK0XXDWTjrPtuGKdcQVd3cPg57PF1TV1xqMVr6tXFSCycNqm57uF4EHAQPAgODo7O90JXsJ+00x1SYmyX3fObeW0/m90m9P2KDlxMhPvPIivKNlzEqxbaV497Fo2H4gwPgnev+X1AJgCwYPgcCd4Cs45sS6XmzQVsAjephyN1Qo3XkyvPq2h0jTqqDuvqePpeWO+nlwEyB3n7wICBoIH8QCCB8HRaD94Ctwlc55uHR0ms9fV50zTjivVZHXjFQDH2VYZ8lzUVqTeaBBfMYy665bO654soTyn8Tf0RiAwfBK8f6vvADAFggfB0eh5U7U73fjcyIn0MhBAkb08asyzq1WYtw7KeaWcuNZdfVnTiFzT/LGh2eFumRGQt5DxfNMS9yB0XM8l2QPBg4CB4EFw0NmtoeRktUJtNjs2NKRNovf1lVKpWa51w0XuurpK+fzxXG6ydHZUqzV7boBfzgvnbGwtXWTU2nbu8uDMG9JUl+Rpq/KGu3XRvFTOgeMjCAQP4gEED4Kj0dVHUsOOTM9D36RJMj15kYxOvh8eniS7k++TyfLgYInXv7FQuQCt/Zo0eYIu9HfXJEbveIradyfGDmUnD6TLT3XI4LwckpTT1+rj0mGP4tQfFTxZ7mHEv+X1AJgCwYPgcHGC0y2bZ+VzyE5Gl4J09OvYsSFuB3d8JE83tR88eZfbzKi70qraKT5WB8wd1cwxQ5/lN9pLB6CVuH9tvLJ4cH7hyqNae6d2aWJRKBcEjE8V4yF4EDAQPAgOT4Yo6cSbTpcpfB8fn+WTMJ2Lk8mkFt9XO8LZoMpeN3qvm33XNaRxCCtcHK9dMpwcLp0d1WXhLVpTdyrDgb46uQDCxSfB+5S7B4AVEDwIDg/nIFOpWYra29u1aXipH8IVZzk+5vF86RBjCq+dM02hdx3Eq0vyJHvfeLmw0I52JD/7RKr8VIeWkYfm8dEAggfxAIIHweHVOmA6SXLaXVdXKZPRBJ9IJNispjlrdX3Pi9d5bZuY2F0QX1Fq7akr7E2L1KpL52WVvIt3BN7iU8V4CB4EDAQPgsMrwXPyPAmegng+YSaTSVa1E0FypG7vey5v57ocjRSrly3mafaLD4nf2t07Ag/xSfA+JecDYAUED4LDw0peFLhv2TLLHeFmZ2fz+TynzTt5rS5J3j6+Z0+rI/kO4bhcXuVkhb2TdrQgACB4EA8geBAc3jbbEB0SqVRqeHjYyZryupPr3HtGxtiNI/mcpmf/LpwNoJO6k3l9fgm/l007WuArPgnep6l9AKyA4EFweN5NS2rF0G4piHcSZDuZWVez7biWrWl8b7UArzI3XTwxwFcbutl3J9Xr2PE8qADNB49/Pd8geBAwEDwIDk9OnXSGzGS0wrRkSgl2abdOxue5cm3dp6mRt64GjtV4vsi+PJGrFbAb6ZSXqA1pnDSldd6nDniOf4JPJBIQPAgSCB4ESpODn1K8NpsdS6drVWbJfzwHX/flzhPj1eF0m7Db6HsuXVca6tJq18yXoFebzjnsZ6NWzIXmg6RQKPgneD92C4AV+MKBQGnmHMer45LJMtud7lM4xCLkbDtNqOcG1M4uKjy57vztxOtWi9xM36L0qx3keC6lxwl6HNmrOfkOrzN0ifcLS+d5LR990pFOrU4O8BT/mrpC8CBg8IUDgdLMNCQJnuyezx/v6SnSbcuW2hA6h86TJ4drY+P72k1rvvLKN+dvp3q9gc5vc9Njx4ZI83QMHN/LVIJuAV7dKwbTNva1fT6Tk042qH/nLT4Jnqs1eL5bAGzAFw4ESjOCHx/XZtC7ukp0U21N97PZLJeE0wq+kvPM4tqGwndGhtOdBvFz05XR3tJQl+kognSXkdQBie+t9my5uG6mQB+WdqJ9XnSp8RSfer75N7UPgBUQPAgU10uBq4vdj3OjWLoNDpZ4pJodnM/nyfG1UP5AuvSbwdJieNlbqR6zi+Hxf97OMp61Z7i71hpuxDIE5IF3vmLggQF735teW8y+Nk4XNHQloV3WVDvZAK/wSfD+jfwDYAUEDwKlUcFnMhT0a91lSHKbN5fV9vDke4pfOWrnsJgdyQvndJhuNDJmhrosnt/CFO2haoZdbZrAGm5Io1sWrxvPt5q/r0ife/L6TMFd93pgAwQPYgMEDwKlIcFzVh3fqk1lNNlze3iS3+APd8g89ODDfSJ4YwqbfZnYush0gK7DrLp/zn0rP5+uHZJt7ps0nbNJC7CZv6f76qB9k58O6PBJ8LRbCB4EDAQPAqWhfhsUvovgdS/SmsFXw3cKmjXB/7CrtkqtanddUOuwRr0V6qp0dUZc5tTVFjXa7LtFGr9unxygmy+LrzaJV4cBpMKdWkBXyuy47osDjPjUtZ2+9l/60pd+8YtfTE1Neb5zAEyB4EGgNCR4CdmNyUkHD5aHH8lNHkhr4exw99DQUD6fF/nxgDxPq3sS4ErsztP5ovZmysxJqV39svhzA2T32ly+MhLAVXpY5FbxvU2+HnCIH4Kfm5tbv359IpFYtWoV/bznnnuuXLni7VsAYASCB4HS6NmTHG+adD/9XIFid014Q13lpzoG7tNK1XKczdZkx6v+k6Q2SaZzfhgSu7NlveoHI3H5ovh7psAr6bUM+fklcLwaUC2Yo9tPo/n5wAo/BL9t27YVK1Z8+ctfpvt79uwhx9PX1du3AMAIBA8CxcXZkwTf2akF8errZl8b54R5mYan++JgNpzkz1eqCuSseAl8+SJAXCjitzKiNpw+kqd3mTw57KQUnUN4/F/VtpZEcGyovCdJmufLCLY7X5HYZNXJjL5Nvh58XxfPu7ZfunTpIx/5yKZNm+Sbf3sVD98CAFMgeBAoLgTf27so1Y5eTb6ncL22Cnx3grxLP8vPp2U0Xqa36xZ+F/Hza43i52w43sJXEqxeD0vG0jFMPpMrP9VR2ddOd+TqQbrOOMyqs1o0D983hOeCP3PmDIXsd9xxh3zzt2/fvmrVKg/fAgBTIHgQKC5SlKX+PN127Chxqdqenqp0OaQ+kCbp7n30IWkMw3c4o97FQXI+HcfKPLCvGbE6WjD7RIreq3S4z8MgXmNfO+9cu1hRUOfd1cMzVriTh+oW5LHxvScfpdWh72d7e3unAxzucGRkhAT/la98Ra4bHnnkEdry1ltv+fUZAKgCwYNAcSF4SbXbvLnc31/k2J0FXwvTq4Xfh4eHK9XYnUPYsflW8S4OUpa9LZLoTIEcXKstc2aveYE51+xrr9l998L/kmqmve7plhXuqgff0MWH0fc8brFku9qQuSnULtTDeUHGJ598knT+ta99TQTP0/Cvv/66Tx8BAAaCB4HiutxHoVAL4imCZ7sTJHv2PZHNZmXNWKU6V81JZ85FZb7sTeXcgFaJ9jeDPPLvYYUZumLgUrtqVp0cvOmYvE2wbhXfOwG+d11s0YrDhw+Tzj/96U+L4Hft2kVb5ubmPHwXAIxA8CBQXAteXRPf1VWSFeEseLLj4MN97F2esZbZdCfhbKPL3jjE9yqIr+XQLa44q1twb+psq4Q7m/jexbEtNd97LviJiQnSeSqVkt3+4Ac/uOaaazx8CwBMgeBBoLgW/PT0guDT6Uk1dmfBF/f3cCK92IjFaZ9npyW4VcfAGw15ZRjfxWfRHYAuh65i1k/WytlWCXf0zOKRfs/7yS4F3zfTD8mUy5cvX3fddatXrxbBd3V13XnnnR6+BQCmQPAgUJrpqaWG72R3LkdPP0tDXXQ7uhhuDCOrw417M59obwTeeTO5aabarsZiBwAAIABJREFUtipLZzomb5lwV80YKO9JalmBEznXR2hPLH3vueCJrVu3Ll++fHR0lO7/8pe/bGtre/zxx719CwCMQPAgUFwLniN47gfPY+90p7+/ODw8yZnt3HKGH5KytXJfrFN/ot0xUlTH9R6c250xHZM3D+6r/WSPj+S1mjnzfxO+oOHFBbz0n/4Uuk56Tdb0jYHv/RD8xYsXr7766g984APr1q1btmzZvffe6+3+ATAFggeBQqfORMLlt44dTyG7GIuD2uLpAkXwXJdeV7BdurMY3V9nFfipjLZ0jW62heVtVqzVxehyJ7syTZI3BvfcT7ZW0J6i+fmn8bp/qfnDI/xqGz0PrwZa1Pd+CL6ijT8lKIIfHBx88cUXPd85AKZA8CBoXAueF8STKnK5STEQ3alUXcL94KVMDU+9i92PzteXtVkFLiF++fxBumIo7u/RrhteeMj+qGoXGQ063uhyPgwnr+XaO7qNanBfu0+XJvNqd0HdqwH5+9tfDcwq1Pc9HfNor7d5A43i+vsZym4BsAHfORA07s50vEyuq6vEGXacmCa1aMgTtFsZe+cG8Ood45g8C0xm4o8akPFtKXdjVcu2Vlz2/EG7D6CMBBhd7tzuFethAxawVOcNjPI8DV0N6P7mNd9XOwSW9yS1xrsu4GsaB938bIDgQWzAdw4EjbshUB6fJ7U/9H8eIgdQbF2pVl/nkXZSSD6f57XvXL+W0+7oJ6mX8+RFJGoHGjYlh5vioVrZ2mrHl+NKsXqruF/LYrNvA19tEKeNlp8b4J2oDzZkd8Z03r1Wv+9QVguC59fTRw31akAG/Bf9A43kVevXHRvgvWm7Jq/zv4IyK+ECP0zcTG4pAK6B4EHQuJ7jHB+frc0rz9v0qNLova+vjyWhxX97ktx+hmRP91W7i07oJ7/WJu1OPGQcWGbN8HZ+O77skMnsSQU6DD4S+qmzu9H3DjHOu3M7HD6YJiUXDPyXlz+sNlz/7BZO/pd/I1a4ejVgHBuQKwNeKqn9BdwO8vtkYggehAIED4LGdSEROqcPP5Lj7jJ0Eh/PdauBb39/v5zoa+1nSO3cdHVuWgbzdVJnuzisbyM16iXiZAmRVLSutfOarx3DfOjJgqfnaGP+1nbXDXSrY92CLiFOlzkon10L4snxkRQ8/wHlioqvkxYeVsbYZQKFNW/cD+dYLLrwqo7wa134ThfcHZ5PJnZd/gGAZoDgQdC4FjydxDs2THGDGfY3xanliZyaJ6+d8Y8NsU05bl4QydlRbWCfQttTGe3+4T7tCVVDmGbJqSPJ4lddnrnU1eGBZT42zs7T9i+cGODu9XRsurjTajhaHZEWdGlrEgEz2kFXl79zA56m/6G8xBisO1yPp9M8/yuo0yuL3E+B+2gvfSVqIyuNL/mD4EGcgOBB0DgUvDqKT/fTaa0EPVe56fvGaO9faLPa7G8JZMfHxyfnu8TWStTNT6JrdiS7z/d71aq+8/3CZp59F2eoC+1MMc0ROzqflCc3zbLP5FjMbHQWNrvZtYF0lOfbyS9smpsuvzllsjI+cNjNarDe6CFJuK/+tY/XawHM8KsafUefTOyixxIAzQPBg6Bx0m+bK89TKEVXAtJmhhfB0yk+mSwf7N8sdmeLZLNZOjsfrZaWk5lyEYPm7ap3eRB70Zj24tBZHQxQ42Zd6Cxu5rfTKsmfG9AiyHO1Kw9tHqGaV89tafhVbGIPE91lCEFnsuBz6QV1bUKjRQKMA+9qmM6+txpxMd1bowcAwYM4AcGDoHEieDF6R0d5aGiMvM6FaY3zzRJMDw0NHa1WqGVkfldmfMnuUvOuMtJZy0cb1Z92VT/VLXVnkiI3N81FcoqnC8eV5jf8oPi4ob+YFWIvY8Iduy2wFu8m6XINNvHTvdzeylJDsK685V/T4WAJBA/iBAQPgiZTxeYJal+ZzZvL4+OzqZR24/Cdfvb0FOmhgX+d5udzVEeCl9O9UXi1geKR/KJJa+u1ZHWDRSfRIS/bUy07adbc3R06fxur2Hrb0NYUjrb5YoiHTJy8yjw/ztUAvlzJ2fubD9LJ4flk4rrfeQD8AIIHQePkZEePt7fXhugrVeV3dZU4iE8my2R3dRKfRZvNZtWBAZ1vJKLlFK2jjpvEiEXUXG5dXG71Qn5HuQ6QJrZNzo5bRedFQxVbHsxo5r1M391FsM6vssuPa+54rJLt1ac5cTwED+IEBA+CxsXJjsRNak+nNT3oTr8cudL27u5uVfDG+FWmwFnPDeW4ybI6mdqvKyeZF2cfS+zuPNK1OhKbBDrd4LZxJMP1m0rdXydD6BUlP0438O5T6p8TzTsZrvdJ8E6mpQDwHAgeBI2Lc+joqBa+k+DppjtPykJ243WDUYTF+WKuaiad88PgiwbG/oXG8XM+yIpyneECe7tXzCYOmsm2a2htm31+XDDwVYV9/oT9cD19hSB4EBsgeBA0dKZrNI+JzsgPPTRLQfzevYtsIbF4xWxgwOg2Sc7iTDdZguVE8/xeMthuM/s7trj0LF8WyBh1xezKwwm0h7rzAhXDRUDdawLjy52vbXORHxcATvInrB7yaSwdggehAMGDoGkoUZnOiqR2Lit7tNo4ToW9wgYynpr5PG4s2M4T8DKGL7PsNrPypsPypsPCCzVnqqgzBfJ8F1G1Q7vLk9WBaCfZdmqwzpG3abDuVX5cMNgk21sN1/skeNfFnQBoBggeBI1zwXN/WLr19lY4P463cwpeLldWc+VMT83GLDN1Al4NbdmCphPzOmfrUJfV6ZbAyQp49fkSHDufGneS06dDl1RvmvCvS3yz8rR/+XHBYJNsz38l9S/jU6gNwYNQgOBB0DivBiqL5ejpYko6/dKWZLKczS7yrunUvnHCW5bJFec7yKlPXhixP5WpjHTST4eVUiRYFGGY2p1Rp+TrYrMfe2RGoLI4pq9biCbg/LhgsMrC0w3X+yR41w2WAGgGCB4EjXPBqxE8mUYtadfTU5QhYh5vt8rd081Aq0XlOIDjhrNlpZ158cSA9KzTWsE6gJfAVZR40V7hrO26S/Vc272yOOFOKtqaButRyI8LBlPNq8P1EDyIExA8CBrngqdTYiaj3UiEudwkvYjVnk5P5vPH6abWjc/n80NDQ1LEZuzYUOlwX/mpDq3xjKFu/NH58vXyUyJazW2K4I2l7ozoJrl5vpzHtG0S3OrWYmvG7hUlpVykru5N8uPUJwRW+S5cTJPt+RKtv78fggexAYIHIZBINPbFozNvV1eJY3e6wzVri4urxI+Pj/f19Unj9tnhbmktIxPY6kR+ZT7d3USic9Na0znuql5tXWqDqd2d1E4Xx5g63nUdOuPaNrrDQxT8YVsiPy4AjP86tGV4eNiPGv6NfuEB8AR87UAINHS+o8iHhCSD81zuhiNjNWdKzd3Tto90Suf44umCrE9Tg1QeuDYv90Zer6f2iiHItsp1N83zkiR/Y+kbY91Ze8oWTdZl8FkG3vnzOt/zUkBNtt+8eTNF8M0MnJgCwYNQwNcOhACd75yPWJKrSOps92SyrGs5I+qi2GvHjh0czdOrZl94iMN3crxEw8aFdpzv5u6ErtN53ZVsxglgVru6RL7SSGka06qxpvlxxfkqts2U2Yk3fBGWz+f5z9hoGzp7IHgQCvjagRBwOCVJT+F5982bywMD2mQ859aR78n09LOrq8Rj8uaz7CP5yWdytQVsz+RKv9ox++wW47vURunpgqARjHZ3WE9Gt6xOdCsJ/PZ21xWi4UsEJ/lxUoLGjwL1saGjo6NQKEg2RkOrGa1wnnQCgLdA8CAE6HznZFlwb+9C2jzdz+VqqeDd3bO8TG5wcNF4ezKZ5PCXx/BV03MneFEgS67W4v21ce4kq824G+EW74tpslpcRZkAVpPt+TLFqsIMW1yS4SVX32F+nCTVm9b/AQxfeuqmNrS/rdnXwCEQPAgLCB6EgMO6HxSyi+D5lkppM9YU2bPvVa3KaVQm2jmzTLM4Be7V+Xht0P75tIxj16L/al/5Ws687iQ+2lvbvtj9TdpdReYIpNGc2FcdgddNSbjur8qH2kyB+nijji1Jsn1pqMv0a+AQn3rMA1AXCB6EgEPB05mWTow8Si+CF6vRQxTH0/n34MFy9cnTiUTCfIi7mhVf3N+jiXxG/77liRw9RCfxyQPpyWdyHNzzgHbpcB89RPE9PUqBPqf16TL1mrF7haV7bEhCcw6yJUxXkww8yXiX8L3Jw44rxslybUCFl1SYXgI6AIIHYQHBgxCg811Dq4254g23hJfXifJlojSVSlkGpuT4cwPszsrimWwewyeRa6PlR/oluJdV8iR+crBuAb36q0zZyuD/wiWCwuw8PLRQO7CZAl1A0FuQRYx79mMZG0elrpfhxRvzbDgZyOEg3nCNaI9PLWgBqAsED0Kg0XphFO1THE+CJ53zfDwF95JU39dXYsdbTWAzuolVVaLaKXukkzPyyvOt39nQkyeHtfnX+bF09S1kSluq4PHoN1N7+TxjCvoAfX6CgA6Ajc4Z3XwMzSd5GZED8zBRPB6YRvCzr43TlZ/2z7G/x0UQD8GDsIDgQQjQ+a6hnl26UXrOWCLrU2Q/MFBkUdH5lyJ4XXK+biEZW21R8tTiJ7NxRXuqzlnSaq67u7pvupn14ulCeU+yFh0uXnlvVT69eXiigf8UflxAtC4ieP0SRPlnclD7SIdO8JcvX37uueeGhoZot++9956HBw+ADggehEBDTTnVEvRk92x2TA2HpEoJ/Uyn05ICPWboUK4PzQ1d5qRgLW+xWpsudd2dh7+6tW3F+T43tUsEighHe00HfuWYdXVVm0fb84mB8lMdLsac48rU1FR3d7exXlCN6iyPi92q3/Zz586tX7+eLiNWr17d1ta2bt26M2fOeHHsAJgAwYMQaEjwshq+WsZOG5PXPYHPyDymrZM6oxaSU1/F/pZLBLUJTUUJ36WRDMOx76LWc4whsFMvNcaUJuvGTD175Lqkbvn6xtjXvhCVLmHUfyYpdOPh/tVve2dn59q1aycmJuj+2bNn6X4qlfLwvQBQgeBBCDQ6K0mO50I3PIrOG3WROv3s7+/P5XKq/yQuN5UiW18XGZfOjs4Od1Noy6VvdMlobHf5VS4OanlYpMzzB3XBus4W7pbVcWYcz/d7Nm6/O6F14uFVgksPteIQ/5MVCgU/FqxLxskf/vAHit137dolD+3cuZO2vPrqq56/KQAVCB6EgkPBczc5NRuPI+z5YOs4R+3sOTpBp9PpgwcPcqysnruNe1Y1qX9CtYg929re7sLsa+OloS5eLT37RMqmymkzRWbU0QVVTq7H7bXj3N9Djqe/4dLpI1c0FPeVR3k924ADGnpTEfzrr7/e19dHgbs89Oijj5LgZ2ZmvPl4ACwGggch4HBlsPSD37y5rJZizWbHePvQ0HwoPDctldpkhZtV+piMeFeU2fGFh+cFT6pWZSx2lzBaVQWvlbdvL1u3WH1d1BbvlXrd6uypzTtU/25q5kF8mCnU1q+fyujKA1v9rehrSbrtdUBDvV+t1oxcuHBhw4YNmzZtcvXxAKgPBA9CwKHgJbcumSyLF8fHtTy7VGqWIvhCoXqmnm/tmsvleDJea9F2crh8/qBuh6raBZ01tUSqxU1mZdGaOs2vryV3KqMdhvVkdvN2l/0YdW7arc5+J+oCAV4BGLMC9eXn08X9PZxkIOsP7V/i03o207JOg4ODa9asWbt27fnz5z1/RwAYCB6EQKMRPJ91ebietERq7+kp0k8tTH8+LUVI9v6/qR07dmjBKEVvvHGk9i482E4it6r0vigyfnOK0+JkMZtM07oztK6rbJOYjDoo251MzxuTAGodd1q/tt2iQfiRvNZiwLD+0ArPBX/kyJHly5e3tbUtW7Zs27ZtvPHll1+mL/+KFSvuu+++t99+28O3A0AHBA9CwGH7DZ6DpyfyjWVP1ucJeO4Nv1AnfHei9y8SdI7WUtz3JOnMPnlAi+G0XjLEoWwtXfyUSfa+RMBidCkNy8vfm/mw3tqdEY1ZPWQzPW9cIlhRkhs8PMggUasYLRQ5oMs7+hd3vLbNc8FfvHhxamqKIvWnn37697//PW05ceLEtdde+4UvfAGBOwgACB6EgPP+WtxQLpksy3C99rrdiemH23P/O811ZGuV4EY6ebJTs3V1I5eXr5Wf25Okm3Y1sK+dC88V55vNqEPu7EWRsZVEneOH3QU+YKsxeXV6XnsORbGnMuWJnNV0Ow/Ut1a2Hf876koTuv5r+zRELw1srly5ctNNN9111110x/N3AcAIBA9CwKHgpZucZNXRrfv2cR56JWH39BSHfj5UG4adKWQymXQ6XevBur9HW+p2Zm/NW4f7KIjXlXk3DrnzsDyPfjffco3t7mupOHvHV9Rx+wPp2h/KOg2wtuQv2vAnklRKrk7Igy5N/qkbKs/gHBE8he+JROK73/3uzxbzzjvveP6mAFQgeBAW5l09FNQCdl1dpYcemuUp+cL3O6W2q9bonRw8U+BJ1r1796rBnEyi8xatkczhPlI+x3zGUjNSwYbvNGl3XrnezB4c4mSQYPY17apIKyGg5CUY4eS7aGbbyazE8fneemppQk+uonwSvHzVBwYGEma01qgJaCEgeBAODgXPCfOb//Lg7LNbBv5xQBuiv256+uFa+07N9NVFUDJUq2a5y6Sy9HmTnesWmPEcvBidd9XMuHpgdmf0CwGU7Qsld4701y6MzLIQBOk15+fxNoCuHI2sazBdENEkfgsegIDBNw+Eg4xb2kAnWxJ89+3jkkZHpqdonm7F/T3c2ovXszH5fD6dTotZpcycVJa1UaAYXcbVXXdMb35s3wWq4xd5XaJbLqVua3eGr4f8PmAb1Cs2XTka06rDXtFok0Mn0JccggdhgW8eCAcngq/wgq5nt4jgR/+9j5RPN86e40llyZqmszM5XrUyD9Hzfaswl30sw7+65zfq+Obz8lyj9stpZtRay6gfyWvrD131VnGNscyc+hF8VTvjk+D9KH8LgBMgeBAOptU/jGiKfW0hgk//PwfT6VpVu8J/aGPOw48sFJ/XLQBjW6gbjY5XG8mwINkivJScF485N2XzM/cuMNZU92ASXer1WmfkeYVxcl33BPuGAh7ih+B9qm8PgBMgeBAOTgRPEf7w8OToaKl4ujD7wkPTL03TfQ6y8/njFMfzT+2ppzLlpzpo++bNm/m1Ym5d6zY1LldLzav3dcp06PiA7W46Oa1ud7/ruWlSe626vm+N5qyOX8W+oYDncCF6b/fpsKYTAH4AwYNwqCt4sjuXsunqKpHFDx4sS0Y9T5nzQ9oSuN8Mai1eDmWL+3sy/0s7meqaxOgCcYnjZaPpejZJxKtVtj9/sFYqx2zg2qoPjec48WLFwfK5Oox0aqX4R/LeRvD8JzWdXNfRfCsdFzgcVWoIumKA4EFYQPAgHOoOh9KDnEXPWXVSyY4D96MK2mK5+V4vA//YabpsTJfWrhZ1qbvMjGd/uVSONutvCGoDsLs6ju2wYq50mHXzftWMvLFjQ56k09tPrhuf6cmidhf4JHg/iucA4AQIHoRDXcFzBE867+kpkuDZ7qmU1mkmmSzTFrpPYb3mvJF8bQHYvvaOjg6rFW7SRoxXe3OMaLoqTLK4VS1xREs3LXtfwVe767zeaDirm55olCan89WDt+nhpj7Zw0XtLnCY+NkQEDwIEQgehIOTNcd0suWceXI5F6wlAdB97jrDp+LaeO9InoLOqakpXRa9ithOjM6vLVXRVa6VpvILezs3UBrq0urAnByWPTSjTxvUkNeF13W7sulPX/e1LubydYv06o4BREHtjB+Cpy85BA/CAoIH4eCwqAjJiSJ4GZznaD6XW9CAtInj+fLu7m6bvdGTpZGM9JWRLbSHujaScW8/ZohVr7u2suluXeepObyCkTIDzr1eUfIJgsmhq4tPgvejeA4AToDgQTg4PPFRVD08PNneXuFUO6ltJ3lL0medfo7+e9fAfQsT5MaRdilby9XLWV2NDkSzk3hk3pOib2pxdQ+9bnwLF3vWpSua7ladXHd+PH4vancBBA9iBgQPwsHh3CSbb/Pm2uB8Mqk1g6dbLjcpkWVtCfWh7OwTqcJ/9FiNtHMwykPWunn6huQn4XulueBYPl2jdnSHTYdZ+1dpFzGvjRt3pa68b2iHklLQ0JEEgB8l5/xYWw+AQyB4EA4NCZ6U0N9fpKi9u3uW177v2LGwgG2hu0x1pVzp7KgxqpZUOI74dSXqnE9Uy4CBxP0uxpl1dVgdvsoT3Cyf46I3+9rLb041OgivwrMb0VQ7A8GDmAHBg3BwVABkpsD11EqH+3jD9HRlcLCkZbNXx8aLSi9w2jh5ID36713G3UgJGqlyY2wG48TxYnf+VVcjr666QvS6SmOOPzdQa+pT/VdwlwcXyqJ2F0DwIGZA8CAcHAl+tFeK1Gqyp1c9VuCaNrxoTRZMs7HIH+l0WrrJsYmNdud9G6fe7ReV8TS/LmzVOd40lNdllTv9A/mJkw6zTPn8Qakx0GhpevWDR6c9nRU+FY33Y209AA6B4EE4OBK8VESn25yW/zTQ10uyIeVoAeWvdqjVZFkhdI6empriWFmax3B6vOmwvE7nVg1mbIyom4SWUN68pVtkcD5iUfrNoPYP4aANnfrCEOvVuMMnwdM+IXgQFhA8CAdH59O5aU0t89VhSfC9fzEweSBd3N+jRfDVqJ2FKrG1mggtiXWSyCZhPWPaS8a40T7e1SWoc364ZOxHWW/2jnce5ev2GZFF7Y3in+A9z8wHwCEQPAgHF+dTCoQSiQrJY/CHO9TRcnXNlYyIquu7JH++uLhrmelkfGWx4514jg9AzYeXKw9uRd/QxwwSmxa6jdpdVbunxxgQPnWFgeBBiEDwIBzcCT6VmuVC9LqMLZ4gp43pdJqH6MXQpuPwalhv6iQ2nKn+dbuSDDLWuemjUXaerMLXxkuqiQ6NtsWL5qL2RvFJ8H4k7gHgEHz5QGg0dO7j8J0L3ezdO8vdYiQ+lph7YGBAHbGvW4iNZc96lrCeH+JleFavKhpaullFwy0RyhdP1xYslPckJ08OO3xVlBe1NwoED+IHvnwgNBo693E3OW4ux0Oe7HixCyfHbd68mXO7GIfikfYzHLyyj3nPalBet1WrjeMjHsqXzx/USghwtryDfDoeI4nyJ2oUn7rCQPAgRPDlA6HhfHoyk9EEz7Xo6YQpL+KZb5EuW3l8fFwy75zrR63yxpqX6rbqW9Qt8GKzID6CofyiS5b9PbWmfNWBeitaZVF7o/gheJ8S9wBwCAQPQsOh4Omsy4PzyWS5s7OirjmSVW1SgLanp4fO1Fy3TgaQnQhVgm913bw6T8+m52Q9h7syfSgKobx5wzcK3G2Xw8VV7QwED+IHBA9Cw2ENEB6c55vxekBm36VybT6fV8fVnQuVB+r5yWoLdt45291qxZ1xVzYTBPxo8GvE3S3Nb8VF7S7wQ/A+zesD4BAIHoSGQ8FnMjW7W50qeTKeJTQ0NGScG5a42cZPcolg2oJdFbY0qZPZeu0i4M0pbb1+tWa7+hL71fPBhPK6ErnOJd26i9pd4EfbNwgehAsED0LDoeC1AnYDFZtzr0Tb9DObzdJp2lSf3DDetI6s2vDUWMJWnmkUtqy44/Q03Rx27SWvjWuFeuamrfbpR2SstqB1cRmxpNTO+CF4nxL3AHAIBA9Cw0UfDpI9nYTV8zBPmfPoOs/By2la5uDVkjhS17aotGDn+XX1VabTzHZB+bkBcry2PO+JlJqkptmRS+1SZG+WvOZtKG+8XnG3h9CzBIKHvo0QPIgZEDwIDReCl/l4Pm1K6rv0gKcIXj2livCkupz4T3LsTcN6q/F8y4fmpseODR0fyRdPLP5E1W5s5H4tuB+1PNc3lA9o+nL5XM4XBxp3EoN6Na7xo+2bleBffPHF0dFRb98LACMQPAiNRgdFKXwntXd1lVKpWTI9D7lXKovu5PN54ylV9KnOQ3OcahWs29Sw44eMJubqOvpXzU1PHkjXIvt63dgaDZ3V4rvGvAHncNH+Jat2xg/Bm37D6Z/puuuuu+uuu7x9LwCMQPAgNBoVPGfbkeB7eopbtszq7M7QffU0rcsvUw1atwobL383fciof16RX5mvt6MegPYWJwYovnfyGZ2E8nXr7ThH3Y/rncSDYAR/5cqVO+64I5FIQPAgACB4EBoNCZ7OvbJYrr+/yH7V2b0yX1+WthctWrCLQWUBvVXcbJ8GrxbGIWSmX5ejx2E9D+w7/KQVi1DeQ69X4r6o3QV+NG43zus/8MADa9eu3bhxIwQPAgCCB6HRUAqSLJZLpbS+Mpy+rrO7utTNNBOe4ahaJuYr1jXmbCbjK4rL1SNRXa5Ohx+3as42N63VljGUl1EzBE2K0rhFXQrf5K5iBgmevpCFejTUGk43KvDCCy+sXLlydHR006ZNEDwIAAgehAad+5yvEqbzant7ze662W5VWnQKPm7bBY7z7Y2xu1Uor4vUdbuSZXVqHMxL44xzB+bD4LK4bnEKnnjdq77yS3DlW0PQV7G9vb2zHg1F+arg5+bm1q1bt337droPwYNggOBBaDRaBmRqqiyFY9l5xvot7G9OCDcddVcbyVeU1HE2NMff6sJ0JzXp+B0Xto50sra16jfzcCKb+kLt0uB04fhIvtbiZaRTSujo+srXrdJjD9TuBD8at6sXBHffffctt9xy6dKlCgQPggKCB6HRkOBZveQ/rlunKXAkbzQWnaOz2axMe+vy3XR21+2cJWoM5e0n46WOXu3JFm3Z5HiKSv/4WnY992l9qsNm8bq7telLdlG7C7wV/JEjR5YvX97W1rZs2bJt27YNDQ2tXr36lVde4UcheBAMEDwIDRK881YcXPFNs+JInm6TB9Klw32zr43rvEvn6J6eHhl1l8CXh/Ttq8eZSWCSAAAgAElEQVTLivmKIZvdZP3bPFJEb6FsnAi+ui5O6tqq8+j8Em3YYHeCPkttoN6WhkL5Jb6o3QXeCv7ixYtTU1Nr1qx5+umnf//732/dupVkv3yeRCLBv+7fv9+rdwTACAQPQqNury0636bTZc6Z55FzTdLD3eRCkih5UVa3szsJCpUogmd3chFZ9rrDnDJdyLvo/ukC3YxPVt+9NhN/KkPhOB2hUep8R/WutoLuUNY4B29F7crg7Kh29WBRGg+L2l3gR+N2uWg4c+bMQYWbb775tttuoztvvPGG528KgADBg9AwCp77vtNPEW0+f5wC8lRqdu/eeUnPTdfauih1Y3honQfwu7q6OIteytuJgHkYgKfn+QqAB/N1B6ZOzMv9WircqQx7WvYp6fqSnG+V8c6pf+qlRm1injxt24LdeHh0AVGrgHsqI38HPgCo3R2+Cl4HhuhBMEDwIDTo3KeeVXUr3YktW2ZlaZzzZV20T3mybkUcXwHwKnnWv1rhjp/JVwZqpXot+D7Sf3wkz44fOzYkc/98JSG+55eYDqFLrC9bjBl/TpkpaMMDh7K1iYBqoXutUC4WtTeBH4K32icED4IBggdhYiV4XlvES+OSycZESPscGhpikfPEeW0y/s0pm2Kx6hiA7gpAq5xTbSTDNmWRi7DZ8SJ1bVSA8+b2tXMHOXU6X03Ws0ncszlIeV9yfG1QgW/16uACe4IUPADBgO8fCBM6A8oYJv23s1OzOw/bFwrar3TL5xdid95oX/6uvb2dV8MvWr8+2lsT4ciivP3yYmYVSvPUqtYfytYi+ENZljpH7boxAIr1a2vk6MnV8fxFM+5VKjbL4i0QtdfmDs6Oap9IPpTSoxa4oG46iDsgeBAu+P4tIR588MHNmzfv27dPt/3y5cvPPfccRb1kjvfeey/IQ7JJXZZoXl1JJxttKuDRPoeHh9XBcIK8y8nqdDuqcHwxY4vh4XptoP5QViLm8ptTpV/toABd+1Xp8l67Rjh/kNvHcba/rkgOT7rbFM8xoq5i55cvGoc/ldEuWRC+N4cfgvfpogEA50DwSwXyxKpVqyik+NznPqduP3fu3Pr162n76tWr29ra1q1bd+bMmcCOiqNt43ZuHMc3OUnSE3k+vqenaCP4XC7H4+oVtcjdSJ4MbYzg61KTsWT28dJ2KT9n3NvcdPn5NL2XzP2rD8qCeydvrVvqZr8cHzRDQys2HQLBg9CB4JcKjz32GFn829/+NllcCm5UqsW21q5dOzExQffPnj1L91OpVGBHZVP7U4rPq49TNJ9MlrPZsfFxg+eqwTQZMZvNHjx4UILyWkKcRcl3e8yXv89Nc46baYt3Lqejlr+t1cWrpsprgh/Jz57Za/++xiZv7jPygAMaLaoY1j4BaAgIfqnw5S9/+VOf+tTvfvc7EvyPfvQj2U7W37Vrl/y6c+dO2vLqq68Gc1T2xb2Ng/e0hZ4+OmooNU/mrs6O0/b+/n7JaW/m2KycqiXfHRuqpdEpM99qexj1+drQ+ny5utnhbsl7N31HSchXx+Fhd7+B4EEsgeCXBBcuXLjqqqsefPBBun/LLbds3LhRHurr66PAXX599NFHSfAzMzPBHJjrHp36UvNVu08eSJNKSfADAwN79+4l3dZtDmYDvZx2om6ZmpqijcPDw9ov/9+A+hCL2aodGR2eNmg/X3aef04/t/Bk2jPvIZfLHTx4UPemtF13JMBbMpmM88aGDmmoWSIAfgDBLwl++tOfLl++/PXXX6f7P/nJT0jhL730kvFpdB2wYcOGTZs2BXZgun6azllUan5umjPbecyc24Jt3rw5n8/XbQ5mRTabpQsFdUtHh1YrfseOHbpn0nZ68tDQEL2j1d6GH0lzph5P5LPse79ee3lPTw9fHBj30N3dTR9zy5Ytrj8IcI63320IHoQOBL8kIGffeeedfL9UKi1btux73/ue7jmDg4Nr1qxZu3bt+fPnAzswOgNm7Be9WSPL3GW1Oo+Zy9I718Paxix3q2K3CyXlramV0D9+vDyRq6UCjHRqfeSqkwg2heecV9gFTeJHQhwED0IHgo8/dPJqa2uj89et81x99dWf+MQn5Akvv/wyhS8rVqy477773n777SCPLVPF9cvZnaWhLm18/uRwZXGPeXc558bEOtMWL7qS8jZHKPXwdTvk1fP2hwG7B0an29kiK5r8bgPQPBB8/Nm+fTuF7N///vf75/n617/O9Vzp0RMnTlx77bVf+MIXggzcBecnQYrJ6Ynqc2tJbdWJ7dpCuNOFHVW4Ug1Xo2voeDgHvpZ1X02g4+EB9Tmyeq2ufWXJu5pUr7al4V9ND8N4SQF8xXMfQ/AgdCD4+PPJT37ytttuU7fMzMwsX7783nvvpfs33XTTXXfddeXKlVCOzXlyU3v7ohI3sii8eGKgVi/2QJq8m06nh4eH1SLzajUbtXyN2m+GWZjXnynUerTvSepidKk5Y3+0fHhcBY+XyfELa0vmFu9Q53ib1rTAPwpeJ727zi8BwCsg+Jjz61//moL1nTt36raT8j/60Y9eunSJHv3ud7/7s8W88847wRyew3lKrnuTSs2m05NkejGxWhBeKyG3uPYtP62i1KPVFaCVjnPq1QBXnp99IlVb2za/EE7XId4GufiQNfH80+qFNcdXl+mXzo7C7qHg+TQ8BA9CB4KPOd/5zndWrFhhHEwmi5MLDx06lDAjsKZkzsMmLnGTzx8fHCxpDi6Vao1ZqyXqikf6SZ90PtVV/3Y+Dc+mr/BA+okBrRwNC75aP0dXUt4GWbPOdxy+avbZLTJm4ORogR94Ow0PwYPQgeBBmDgXPIXldLYcHa3ZncWpjXjPd1QrFzYbxwP0y+UtqPVlnw++tZl7rvE+U5CGs04OkqXOM/RORvLlVdyOVr2kAMHj7ay551l7ADQKBA/CpKGJz717ZymCT6cns9mxWg7dyWGO4Ll7G5e4UV/Cgb79bmXOm0fUZfRCcuIcjgHwyzlqdzhPL3XriqcLC01mQUh4Ow0PwYPQgeBBmDif+CR9kt1TqVmuRV/rmkqh/EieO7VTBJ/P56emptRXyTS8FTKirlsLp5aUr4suh86+Wdwir6sT8+cG0BQuXLydhrfplAhAMEDwwHfeeOONwcU8//zz/JDDUyoH2Vu2zHIifUdHWQbqtSHxk8OVUxmK3bu6uoxmrS17s4Bz3dW2b1Yl5U1Rbc3Pt8qBt/Q6iBIeht0QPAgdCB74zu7du3VJfN/61rf4ISeCl0XhPA2fyVQKhaKa9M5m5VKv+nbptnl2UmNOnuBwFVxFWQ2vtn81doWB11sLD6fhIXgQOhA88J37779//fr1byu8++678qgu712HMSAW33MWvRSD46RlHpNXPVqsYtyzbmE679C4Tt3qkFjYUi6XkYsJeL1F8XAa3v6LDUAA4CsIfOeb3/xmd3e31aM250GdPhkJuGtr1ufjdVkBr0uskwx5Fd0Uu8NkOmMdOnXPUlgeXm9dPJyGh+BB6OArCHzns5/97He+852RkZGHH374scce05W7N45kctN38fRAlUxmmiKr7u7ZgYEC/To4OCgp67w6Ts6nUkVOfjXWlpeBdCcl5dUcOrkIkHXzFcTr8cKTaXj6SkPwIHTwFQS+89GPfnTlypUf+tCHNm7ceNVVV61Zs2ZiYkIe1QmeLE4nRgqiduyoGTqTySQSBU6vq940nWezWe6ePjQ01NPTQydldQW8bqBeHTnngX0uRFM3mU7MrdM2D+brSumhMUw8oO9S89PwfrSnA6BRIHjgL+TFDRs2bNu27U9/+hP9ev78+RtvvJFienmCLmASkaunR/o1mSz39BS5Fr2sOKcwnT3d3d2tWwGvdprhJHl5Fc/K2yfTSQ6d8Tky9y/xuru2dSCaeDINTzuB4EHoQPAgaHbu3JlIJGZmZvhXVfBcc15tKsMb6VRJgk+nJ8nx9FxSr5peR5rP5/O6cX51oF7mzjlkt0+mU3PodNvVcXjZri6xAzHAk+Db89Y1ALgAggdBc/jwYRL86dOn+VddBE+aphOjboiUNpLvc7mFdqtcEZYfpZen0+nar3PTWjG4akk46Ukjw/LmxeFPZfj53OhF9wTV68ag376mDWhRmp+GHxgYgOBB6EDwwF+OHDnS0dGhrk3/8Y9//L73ve+tt97iXxvtySHT3hKCywp4bZx8tJdsXRrq4u6xRw0UFzP7wkP0fC4TWzrcpy5y45er4/C6Ffbo6xpXmp+Gd9gmEQBfgeCBv1y4cOGDH/zgV7/61T/+8Y/060svvXTDDTd84xvfkCc0KniZApdgmvfAui39agfZfexQln4eH8lLuM8Rf9EAV7ot7u/hYrc6r/P+TWfZjTVtQGxofoAdggdRAIIHvvPkk0+uXr36/e9///XXX9/W1vaVr3xFXSnXaO0wsa8Mj3MePoXX2kq2Y0N0I2GT40nVvJFXuBnn1GuL2n+1g55PEb/pAL6VyJFYF2Oan4aH4EEUgOBBEFD4fuDAgccff5wieN1DDQmeV59Leh3JOJ/Pp1Ipzp6TJvEc3/NG1rba8lUWy3FnWPOJ+flnWtkdiXXxpslpeG87zwLgDggehExDp0L2tKTXiaplLpyFzT+5lCwnzJcO92lpd091qCvX7T3NIb7R7k5a0IJWp8lpeAgeRAEIHoSM88FMrlwr0mVV9/f353I5DsHVFeoVNQlubrq8J1nc36O5/0DaSfxtZXck1i0RmkyDbzSzBAA/gOBByDgXPIk5l5vk/HlZy84T8OryOWn/KqPrxdMFyaTT0uzrYWV3WXfn4mOC1qLJaXgIHkQBCB6EjMOM5Yce0laxp9OTarsXIplMqoE7V6jluXN6DqtauxSYyPFi98pMwf6NTDvcMJh6X1KQ4F1Pw0PwIApA8CBknAieTpWk9nxeC9DpJ6fH0/aDBw/m83lWe22ZXDV8l2i+0YDbZn4dNW2WGs1Mw3vSsQaAJoHgQcg4EXwup0Xk2ewYab6joywWl1y5StXNnF0vaXR128Tp0BR+KFs5N6CVw1sMpt6XIM1MwzcT/QPgFRA8CBknk52cFU+C7+vTAndJns9ms7xwThbC8WS8tJNxHsFr+yG7704YR/JR02Zp0sw0vLEJMgDBA8GDkHFyGiW/jo7WAnS1pLzaA14Cen5IasiPHRvSgnLbqXctYe/Y0OwTKXJ8TfOnMuqjsPvSxHUgDsGDKADBg5CpK3gO34eHJ7nWrLSZkfR7yaTjOXiCO73WittwUE430rwZY/Ms1Kvf3yOCR2LdUqazs9NdrhxdekLwIHQgeBA+EoibwsnznGGnDrmT3XO5nJpSZ6wyO3tmL/eS0ZxtWCAnQ/0LzeJOF2aHu2sXBKO9SKxb4mQyGXfT8PZfaQCCAd9CED5WZ8NMptLRUe7pKZLgyb7cDJ4hN0t9m0r1IsDcxHPTWheZPcmxQ1leQScvV0vasd1re+Bus9WbdlkAljCup+EheBAF8C0E4WM6YdnbS2dJ7ZZMlknwXV0luk/PYjeTknt6eviZdWrHkuNPZcoTOX4VD+CrapcqeLXnj3TyNUFN84aMerCkIFU3Og3ffK8aADwBggfhYyr4zs6a4OlGdqdQnk6zHHbTT3UCnmva2L+FXBaw1LWB/ZH85MlhWUC/8NS56fJTHVrafLVJPAS/xHGxoh2CBxEBggfhY3oOpQ0ieDpbsp65PG1lvlKYJM/b7FxG4+mn1nWmuly+1gB+T5LtLkP3FVkU9+wWbazeIi8PLB1cTMM3304eAE+A4EH4mAqeQnoO4pPJcj5//PjiFe0c9HNnOWkup0Oa0/A8vZi+FppXBa9b4G5VhR4sWVyE4xA8iAgQPAgfneBJ7b292i2dLmezY2T3rq6SbrFSIpHgtW1GH4vI1Up2bO7ak09lWPBjh7KwO6hLo9PwzvsnAeArEDzwkpMnT/7iF7+Ymppq6FW6zhwy+06xe39/kYfo1Tl6enJPTw8P16vj87rReNluUtXu3MDYsSF1WZ1xrB4AptFpeAgeRAQIHnjD3Nzc5z//+ba2tlWrVlHEc88991y5csXha3WCl6l3Tps31gt56KGHOC1OxuelXaxuKbxaA0eVN0f/8qtNBzkAMplMQ8KG4EFEgOCBN2zbto3U/sILL9D9PXv2kOPz+bzD12aqKL/W7G7aykutDM/y5ujcmEjP1ueqdrrtqt1RzQbYQ+F7Q9Pwuu8zAGEBwQMPuHTp0kc+8pF0Oi1bbq/i8OXGE6Jp4M6QjFOplBSh043GMxy400PGJfK6RXHcq8bhcYKlyfT0dEOlZyF4EBEgeOABZ86coTPgoUOHZMv27dspoHf4cj4hFhxAMs5XMR2QZzhwJ5Eb5a2baNcN1ANgRUPT8L29vRA8iAIQPPCAkZEREvzExIRseeSRR2jLW2+95eTlPGfZaUZ7eyaRKNAtmexIp9MUspPdR0dHK9XxeV3szsvieVbeaHdd11deYtfkBwdLhIam4XU5JQCEBQQPPODJJ58knavxNE/Dv/76605ebpOUpBazY6PzCnjj2LsE7hWL0Fzt+ooecaAhGpqGh+BBRIDggQccPnyYdK6ujtu1axdtmZubc/Jyq8Ig09ML6+Uk+OY2HhR8S1adGrhXLEJz2sjP58n7uqVtAVBpaBredZNZALwFggceMDExQae/p59+Wrb84Ac/uOaaaxy+3KbyF2fUZ7O14FtiffI9j8+rgXvFIjQX5bPdUcoGuMD5NLyL8vUA+AEEDzzg8uXL11133f333y9burq67rzzTocvtx//VJ3N6UvcEU4XuFuF5rIKTjcHD0BDOM+NN22eBEDwQPDAG7Zu3Xr99de/9tprdP+Xv/xlW1vb448/7vC1NuW+dYvU6WmcS68rUmtld1kUx03nYHfgGufT8BA8iAgQPPCGixcvdnZ2rly5ct26dcuWLbv33nudv9ZK8ORjXa5cIpHgQFzdzqG8Ud6yKA5F5kHz8DS8k2dC8CAiQPDAM65cuTI6Ojo4OPjiiy829ELTU6exOPzAwEB/fz/ZXc2hsxp4l+2wO/AKh5PrDq8DAPAbfBFBJFDPib29WneZnp6iamUehNeNzNsMvHMyHYrMAw9xOA0PwYOIgC8iiASyBonsLmvfJVjiVPlUKrV3715pH2cTmvN8vHGtPADN4HAaHoIHEQFfRBAJZNpSOs3QbWBgIXCvVM+b0j7O3u78NNgdeIuTaXibjFEAAgaCB5FABE8/uB88nSTVNe68Ap5/1TWMUSmeLrDgYXfgB3Wn4SF4EB0geBAJ5LzJETydIdPpyWx2TGY8ye59fX1Hjx61mVaffXbL8ZF8eU+y9JvBoA4cLC3qTsPbVG0CIGAgeBAJWPBSm5bL07LpGYqK0um0Tf+32dfGte6x+3squxOVUad9QQBoiLr+huBBdIDgQSQwCr6rq0RBvMx4JhIJCtyt7M6L4hYEfwrNOoEv1B2Bt+mcBEDAQPAgEkgDLhmi7+sr5XKTPN1JD3H4bvVyekhbL3dmrxa7w+7AT+yn4SF4EB0geBAJjB021UVu7G+rFnC6xfEA+Ir9NDwED6IDBA8igfGkKXVq6SeF79I+ToWL1MLuIEjsZ9md96QBwG8geBAJ9KfFuenKvvbK7kTpcF+xWOzq6jK2eKeAXleUHoAAsJ+Gh+BBdIDgQSSgc+Kigc3RXi1Xrnob+OfebDarG58n68PuICxspuGNk00AhAUEDyKBfubyVKY01DV2KEuC7/16p5SnrcwXpactKDIPwsImTIfgQXSA4IFnPPjgg5s3b963b5/po7/97W/Hx8etXquf15ybLh3um3wmR6bv6+uT8XnuLsNg3h2Ehc00PAQPogMED7yBAutVq1YlEonPfe5zpk/44he/uHXrVquXG8+YxSp0J5/Ps8t5WB52B6FjMw3vsKUsAAEAwQNveOyxx8ju3/72t9va2l555RXZPjc3d+zYsS1bttCjDQmeovZSqURBP+mcl8XzsLzNejkAAsNK5BA8iA4QPPCGL3/5y5/61Kd+97vfkeB/9KMfyfbBwcEPV1m2bJmN4I0hES9+y+UmuZ5dMlnO57UVccZ0egCCx2oaXtomARA6EDzwgAsXLlx11VUPPvgg3b/llls2btxofM6NN97YqODT6XJ/f5GL0tOtp6eItHkQEaym4SF4EB0geOABP/3pT5cvX/7666/T/Z/85CeJROKll17SPce54On02NtbEa/zLZWaHRqC3UFUsJqGh+BBdIDggQds2rTpzjvv5PulUmnZsmXf+973dM+xF3yl2k6G75DdVbXTWfShhywbwAMQFqbT7fI1BiB08F0EjnjjjTcGF/P888/zQxSvtLW1UeBy6zxXX331Jz7xCd0enAu+s3OR4DdvLiNtHkQQ02l4CB5EB3wXgSN2796dWMy3vvUtfmj79u0Usn//+9/vn+frX/86d3dV91BX8DK2ST8oalcbwx88qK9CD0DoGKfh6QsMwYPogO8icMT999+/fv36txXeffddfuiTn/zkbbfdpj55ZmZm+fLl9957r7rRueArVccXCguOR3cuEEGM0/B1u8UDECQQPHDEN7/5ze7ubuP2X//61xSy7Ny5U7edlP/Rj3700qVLsqWu4HUzmgMDBRE8mneAaKL70tJ9CB5EBwgeOOKzn/3sd77znZGRkYcffvixxx6jCJ6308YVK1YYJ8h/9rOfkfgPHTokWxoX/EBnZ4Zid9gdRBbdNLx9J1kAAgaCB46gcHzlypUf+tCHNm7ceNVVV61Zs2ZiYqLRndDpL2MNhT69vb3yK50oUdMbRByd0SF4ECkgeFCfcrm8YcOGbdu2/elPf6Jfz58/T+E4xfSN7md6etq54BOJBNYTg4ijm3TXN0UEIFQgeGDCkSNHls9DXjc+YefOnSTgmZkZD99UbcNFd5CNDFoCdWoJggeRAudQYMLFixen5vn9739vfMLhw4dJwKdPn/bwTTl85/s4UYJWQZ2Gx/cWRAoIHtSHAvqOjg61h9uPf/zj973vfW+99ZaH76KeKNFUG7QK6ry7VQcaAEIBggf1uXDhwgc/+MGvfvWrf/zjH+nXl1566YYbbvjGN77h7buoJ0dMwINWQZ2Gh+BBpIDggSOefPLJ1atXv//977/++uvb2tq+8pWvyEo5r5DhTQqJMAEPWgiZhsfIE4gUOI0Cp1D4fuDAgccff9zYKc4TRPCYyAStBQmeA3cIHkQKCB5EBZnLxFkStBb46oJoAsGDqCBnSXTUBq2FTMObNpAFICwgeBAVWPCYgAetCH91IXgQKXAmBVGBwyBMwINWhKfhMfgEIgUED6ICCx6zmKAV4fAdggeRAoIHUYEFj1MkaEX424v6DSBSQPAgQiSqhH0UALiBBR/2UQCwAL6OIELQ+RET8KBF6ezshOBBpMDXEUQIioEymcw0AC0IJ9mF/f8QAAtA8CBC8CkSgBYFhehBpIDgAQAAgBgCwQMAAAAxBIIHAAAAYggEDwAAAMQQCB4AAACIIRA8AAAAEEMgeAAAACCGQPAAAABADIHgAQAAgBgCwQMAAAAxBIIHAAAAYggEDwAAAMQQCB4AAACIIRA8AAAAEEMgeAAAACCGQPAAAABADIHgAQAAgBgCwQMAAAAxBIIHAAAAYggEDwAAAMQQCB4AAACIIRA8AAAAEEMgeAAAACCGQPAAAABADIHgAQAAgBgCwQMAAAAxBIIHAAAAYggEDwAAAMQQCB4AAACIIRA8AAAAEEMgeAAAACCGQPAAAABADIHgAQAAgBgCwQMAAAAxBIIHAAAAYggEDwAAAMQQCB4AAACIIRA8AAAAEEMgeAAAACCGQPAAAABADIHgAQAAgBgCwQMAAAAxBIIHAAAAYggEDwAAAMQQCB6AluTHP/7xZguGhobuvvvukZGRsI8RABAmEDwALcm//uu/3jXPtdde+/GPf1x+3bdvH23J5XJhHyMAIEwgeABanptvvpkCd3XLpUuXrly5EtbxAACiAAQPQMtjFPzPf/7zqakpvr9nz56XX365UCj83d/93datWycmJsj9jz/+eF9f3/e+973p6Wl51RtvvPHP//zP99xzzw9/+MPf/e53QX4EAIDnQPAAtDxGwX/4wx+WIfqPf/zjt99++/r168ncN9xww6pVq772ta99+tOf/tu//dtrrrmGtvzpT3+ip42OjtJDtKu//uu/bm9vp/snT54M4cMAADwCggeg5akr+A0bNly8eJHuT05OJhKJO++889KlS/Tr4OAg/UobKaZft25dd3c3by+Xy5/5zGf+/M//PPCPAgDwDAgegJanruD/8R//ke+/9957ZPT//M//5F/Z9+Pj42NjY3RHDdn37NlDWy5cuBDIJwAAeA8ED0DLU1fwO3bs4Pss+CeeeIJ/nZqaYsH/13/9F9355Cc/efM8n/jEJzi4D/KDAAA8BIIHoOVpXvBPPfUU3dm/f39hMW+//XaQHwQA4CEQPAAtT/OCP3v2LN05cuSI7OHZZ5/9h3/4h0AOHwDgCxA8AC1P84Kn+7feemsqleLVcdPT0zfeeONf/dVfBfcZAABeA8ED0PJ4IniS+k033fS+973vz/7sz5YvX/7pT396ZmYmwA8BAPAYCB4AUOPSpUvPPPPM7t27jx8/jkJ4ALQ6EDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIghEDwAAAAQQyB4AAAAIIZA8AAAAEAMgeABAACAGALBAwAAADEEggcAAABiCAQPAAAAxBAIHgAAAIgh/0lSOqkAAAAFSURBVD+wz0vz30XcEQAAAABJRU5ErkJggg==","width":673,"height":481,"sphereVerts":{"vb":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1],[0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0]],"it":[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270],[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288],[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271]],"material":[],"normals":null,"texcoords":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1]],"meshColor":"vertices"},"context":{"shiny":false,"rmarkdown":"bookdown::gitbook"},"crosstalk":{"key":[],"group":[],"id":[],"options":[]}});
unnamed_chunk_64rgl.prefix = "unnamed_chunk_64";
</script>
<p id="unnamed_chunk_64debug">
You must enable Javascript to view this page properly.
</p>
<script>unnamed_chunk_64rgl.start();</script>
</div>
<div id="event-for-changing-a-modifier" class="section level3">
<h3><span class="header-section-number">5.3.7</span> Event for changing a modifier</h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="co">## Set the parameters</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb100-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb100-4" data-line-number="4"></a>
<a class="sourceLine" id="cb100-5" data-line-number="5"><span class="co">## Using a default trait and modifier object</span></a>
<a class="sourceLine" id="cb100-6" data-line-number="6">modifiers &lt;-<span class="st"> </span><span class="kw">make.modifiers</span>()</a>
<a class="sourceLine" id="cb100-7" data-line-number="7">traits &lt;-<span class="st"> </span><span class="kw">make.traits</span>()</a>
<a class="sourceLine" id="cb100-8" data-line-number="8"></a>
<a class="sourceLine" id="cb100-9" data-line-number="9"><span class="co">## New condition and new modifier (increasing speciation if trait is negative)</span></a>
<a class="sourceLine" id="cb100-10" data-line-number="10">new.condition &lt;-<span class="st"> </span><span class="cf">function</span>(trait.values, lineage) {</a>
<a class="sourceLine" id="cb100-11" data-line-number="11">    <span class="kw">return</span>(<span class="kw">parent.traits</span>(trait.values, lineage) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb100-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb100-13" data-line-number="13">new.modify    &lt;-<span class="st"> </span><span class="cf">function</span>(x, trait.values, lineage) {</a>
<a class="sourceLine" id="cb100-14" data-line-number="14">  <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb100-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb100-16" data-line-number="16"></a>
<a class="sourceLine" id="cb100-17" data-line-number="17"><span class="co">## Update the modifier</span></a>
<a class="sourceLine" id="cb100-18" data-line-number="18">change_speciation &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb100-19" data-line-number="19">    <span class="dt">condition    =</span> <span class="kw">time.condition</span>(<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb100-20" data-line-number="20">    <span class="dt">target       =</span> <span class="st">&quot;modifiers&quot;</span>,</a>
<a class="sourceLine" id="cb100-21" data-line-number="21">    <span class="dt">modification =</span> <span class="kw">update.modifiers</span>(<span class="dt">speciation =</span> speciation,</a>
<a class="sourceLine" id="cb100-22" data-line-number="22">                                    <span class="dt">condition  =</span> new.condition,</a>
<a class="sourceLine" id="cb100-23" data-line-number="23">                                    <span class="dt">modify     =</span> new.modify))</a>
<a class="sourceLine" id="cb100-24" data-line-number="24"></a>
<a class="sourceLine" id="cb100-25" data-line-number="25"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb100-26" data-line-number="26">no_event &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb100-27" data-line-number="27">                 <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb100-28" data-line-number="28">                 <span class="dt">traits    =</span> traits,</a>
<a class="sourceLine" id="cb100-29" data-line-number="29">                 <span class="dt">modifiers =</span> modifiers)</a>
<a class="sourceLine" id="cb100-30" data-line-number="30"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb100-31" data-line-number="31">change_spec &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb100-32" data-line-number="32">                    <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb100-33" data-line-number="33">                    <span class="dt">traits    =</span> traits,</a>
<a class="sourceLine" id="cb100-34" data-line-number="34">                    <span class="dt">modifiers =</span> modifiers,</a>
<a class="sourceLine" id="cb100-35" data-line-number="35">                    <span class="dt">events    =</span> change_speciation)</a>
<a class="sourceLine" id="cb100-36" data-line-number="36"></a>
<a class="sourceLine" id="cb100-37" data-line-number="37"><span class="co">## Visualise the results</span></a>
<a class="sourceLine" id="cb100-38" data-line-number="38"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb100-39" data-line-number="39"><span class="kw">plot</span>(no_event, <span class="dt">main =</span> <span class="st">&quot;No event&quot;</span>)</a>
<a class="sourceLine" id="cb100-40" data-line-number="40"><span class="kw">plot</span>(change_spec, <span class="dt">main =</span> <span class="st">&quot;Increase extinction for negative</span><span class="ch">\n</span><span class="st">traits after time 3&quot;</span>)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
<div id="changing-branch-length-when-reaching-n-taxa" class="section level3">
<h3><span class="header-section-number">5.3.8</span> Changing branch length when reaching n taxa</h3>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="co">## Parameters</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">extinction =</span> <span class="dv">0</span>, <span class="dt">speciation =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb101-3" data-line-number="3">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.taxa =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">modifiers &lt;-<span class="st"> </span><span class="kw">make.modifiers</span>()</a>
<a class="sourceLine" id="cb101-5" data-line-number="5">traits &lt;-<span class="st"> </span><span class="kw">make.traits</span>()</a>
<a class="sourceLine" id="cb101-6" data-line-number="6"></a>
<a class="sourceLine" id="cb101-7" data-line-number="7"><span class="co">## multiplying branch length 100 folds</span></a>
<a class="sourceLine" id="cb101-8" data-line-number="8">new.modify &lt;-<span class="st"> </span><span class="cf">function</span>(x, trait.values, lineage) {</a>
<a class="sourceLine" id="cb101-9" data-line-number="9">  <span class="kw">return</span>(x <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb101-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb101-11" data-line-number="11"></a>
<a class="sourceLine" id="cb101-12" data-line-number="12"><span class="co">## Event for increasing branch length after reaching 30 taxa</span></a>
<a class="sourceLine" id="cb101-13" data-line-number="13">increase_brlen &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb101-14" data-line-number="14">                  <span class="dt">condition    =</span> <span class="kw">taxa.condition</span>(<span class="dv">30</span>),</a>
<a class="sourceLine" id="cb101-15" data-line-number="15">                  <span class="dt">target       =</span> <span class="st">&quot;modifiers&quot;</span>,</a>
<a class="sourceLine" id="cb101-16" data-line-number="16">                  <span class="dt">modification =</span> <span class="kw">update.modifiers</span>(</a>
<a class="sourceLine" id="cb101-17" data-line-number="17">                                    <span class="dt">branch.length =</span> branch.length,</a>
<a class="sourceLine" id="cb101-18" data-line-number="18">                                    <span class="dt">modify =</span> new.modify))</a>
<a class="sourceLine" id="cb101-19" data-line-number="19"></a>
<a class="sourceLine" id="cb101-20" data-line-number="20"><span class="co">## Run the simulations</span></a>
<a class="sourceLine" id="cb101-21" data-line-number="21"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb101-22" data-line-number="22">no_event &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb101-23" data-line-number="23">                 <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb101-24" data-line-number="24">                 <span class="dt">traits    =</span> traits,</a>
<a class="sourceLine" id="cb101-25" data-line-number="25">                 <span class="dt">modifiers =</span> modifiers)</a>
<a class="sourceLine" id="cb101-26" data-line-number="26"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb101-27" data-line-number="27">increased_brlen &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb101-28" data-line-number="28">                        <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb101-29" data-line-number="29">                        <span class="dt">traits    =</span> traits,</a>
<a class="sourceLine" id="cb101-30" data-line-number="30">                        <span class="dt">modifiers =</span> modifiers,</a>
<a class="sourceLine" id="cb101-31" data-line-number="31">                        <span class="dt">events    =</span> increase_brlen)</a>
<a class="sourceLine" id="cb101-32" data-line-number="32"></a>
<a class="sourceLine" id="cb101-33" data-line-number="33"><span class="co">## Visualise the results</span></a>
<a class="sourceLine" id="cb101-34" data-line-number="34"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb101-35" data-line-number="35"><span class="kw">plot</span>(no_event, <span class="dt">main =</span> <span class="st">&quot;No event&quot;</span>)</a>
<a class="sourceLine" id="cb101-36" data-line-number="36"><span class="kw">plot</span>(increased_brlen, <span class="dt">main =</span> <span class="st">&quot;Increase branch length</span><span class="ch">\n</span><span class="st">after 30 taxa&quot;</span>)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
</div>
<div id="founding-event-a-subtree-with-no-fossils" class="section level3">
<h3><span class="header-section-number">5.3.9</span> Founding event: a subtree with no fossils</h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="co">## Set up parameters</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb102-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">speciation =</span> <span class="dv">1</span>, <span class="dt">extinction =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb102-4" data-line-number="4"></a>
<a class="sourceLine" id="cb102-5" data-line-number="5"><span class="co">## Events that generate a new process (founding effects)</span></a>
<a class="sourceLine" id="cb102-6" data-line-number="6">founding_event &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb102-7" data-line-number="7">                  <span class="dt">condition    =</span> <span class="kw">taxa.condition</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb102-8" data-line-number="8">                  <span class="dt">target       =</span> <span class="st">&quot;founding&quot;</span>,</a>
<a class="sourceLine" id="cb102-9" data-line-number="9">                  <span class="dt">modification =</span> <span class="kw">founding.event</span>(</a>
<a class="sourceLine" id="cb102-10" data-line-number="10">                                    <span class="dt">bd.params =</span> <span class="kw">list</span>(<span class="dt">speciation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb102-11" data-line-number="11">                                                     <span class="dt">extinction =</span> <span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb102-12" data-line-number="12">                  <span class="dt">additional.args =</span> <span class="kw">list</span>(<span class="dt">prefix =</span> <span class="st">&quot;founding_&quot;</span>))</a>
<a class="sourceLine" id="cb102-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb102-14" data-line-number="14"><span class="co">## Simulations</span></a>
<a class="sourceLine" id="cb102-15" data-line-number="15"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb102-16" data-line-number="16">founding_tree &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb102-17" data-line-number="17">                      <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb102-18" data-line-number="18">                      <span class="dt">events    =</span> founding_event)</a>
<a class="sourceLine" id="cb102-19" data-line-number="19"><span class="kw">plot</span>(founding_tree, <span class="dt">cex =</span> <span class="fl">0.4</span>)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
</div>
<div id="founding-event-with-traits" class="section level3">
<h3><span class="header-section-number">5.3.10</span> Founding event with traits</h3>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="co">## Set up parameters</span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2">stop.rule &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">max.time =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb103-3" data-line-number="3">bd.params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">speciation =</span> <span class="dv">1</span>, <span class="dt">extinction =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">traits    &lt;-<span class="st"> </span><span class="kw">make.traits</span>()</a>
<a class="sourceLine" id="cb103-5" data-line-number="5"></a>
<a class="sourceLine" id="cb103-6" data-line-number="6"><span class="co">## Events that generate a new process (founding effects)</span></a>
<a class="sourceLine" id="cb103-7" data-line-number="7">founding_event &lt;-<span class="st"> </span><span class="kw">make.events</span>(</a>
<a class="sourceLine" id="cb103-8" data-line-number="8">                  <span class="dt">condition    =</span> <span class="kw">taxa.condition</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb103-9" data-line-number="9">                  <span class="dt">target       =</span> <span class="st">&quot;founding&quot;</span>,</a>
<a class="sourceLine" id="cb103-10" data-line-number="10">                  <span class="dt">modification =</span> <span class="kw">founding.event</span>(</a>
<a class="sourceLine" id="cb103-11" data-line-number="11">                                    <span class="dt">bd.params =</span> <span class="kw">list</span>(<span class="dt">speciation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb103-12" data-line-number="12">                                                     <span class="dt">extinction =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb103-13" data-line-number="13">                                    <span class="dt">traits =</span> <span class="kw">make.traits</span>(<span class="dt">process =</span> OU.process)),</a>
<a class="sourceLine" id="cb103-14" data-line-number="14">                  <span class="dt">additional.args =</span> <span class="kw">list</span>(<span class="dt">prefix =</span> <span class="st">&quot;founding_&quot;</span>))</a>
<a class="sourceLine" id="cb103-15" data-line-number="15"></a>
<a class="sourceLine" id="cb103-16" data-line-number="16"><span class="co">## Simulating the tree</span></a>
<a class="sourceLine" id="cb103-17" data-line-number="17"><span class="kw">set.seed</span>(<span class="dv">19</span>)</a>
<a class="sourceLine" id="cb103-18" data-line-number="18">founding_tree &lt;-<span class="st"> </span><span class="kw">dads</span>(<span class="dt">bd.params =</span> bd.params,</a>
<a class="sourceLine" id="cb103-19" data-line-number="19">                      <span class="dt">stop.rule =</span> stop.rule,</a>
<a class="sourceLine" id="cb103-20" data-line-number="20">                      <span class="dt">traits    =</span> <span class="kw">make.traits</span>(),</a>
<a class="sourceLine" id="cb103-21" data-line-number="21">                      <span class="dt">events    =</span> founding_event)</a>
<a class="sourceLine" id="cb103-22" data-line-number="22"><span class="kw">plot</span>(founding_tree)</a></code></pre></div>
<p><img src="dads_manual_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="makemodifiers.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TGuillerme/dads/inst/gitbook/edit/master/04_make.events.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
